(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"+m22":function(e,t){angular.module("castifyExt.connect.bgConnectService",["castifyExt.connect.appPermissions","cf2.connectedAppsService","castifyExt.connect.appRecorder","castifyExt.simpleBgServicePublisher","castifyExt.bgSyncManager","castifyExt.bgFiles","w69b.chromeTabs","w69b.chromeWindows","w69b.asyncResponse","w69b.chromeRuntime","w69b.spawn","w69b.uritool","w69b.promiseTool"]).factory("bgConnectService",["cf2ConnectedAppsService","appPermissions","$q","chromeTabs","spawn","uritool","simpleBgServicePublisher","chromeRuntime","asyncResponse","$log","chromeWindows","promiseTool","bgSyncManager","appRecorder","bgFiles",function(e,t,n,r,o,i,a,c,s,u,l,d,f,p,h){var g={},m=new Map,b=null;function v(e,t,n){for(var r of m.values())r.app.id===t&&r.sender.send(e,n)}function y(e){return b&&b.appId===e.id}g.share=function(a,c,s){return o((function*(){yield f.requestSyncLocal(c);var p=t.allowAccess(a,c);if(!s){var h=yield e.getConnectedAppInfoById(a);if(!(s=h&&h.shareUrl))return u.warn("connect.share() called for app without shareUrl",h),n.reject("no_share_url")}yield p;var g=[c];if(!(yield function(e,t){return o((function*(){function n(e){return d.withTimeout((function(){return e.sendWithResponse("shareFiles",t)}),5e3)}for(var o of m.entries()){var i=o[0],a=o[1];if(a.app.id===e){var c,s=a.sender;try{c=yield n(s)}catch(p){u.debug("connect: shareFiles handler rejected with",p),c=!1}if(c){var f=i.sender.tab;return u.debug("connect: shareFiles handled directly, focusing",f),r.update(f.id,{active:!0}),l.update(f.windowId,{focused:!0}),!0}}}return!1}))}(a,g))){var b=JSON.stringify({ids:g}),v=s+"?"+i.encodeQuery({state:b});return r.create({url:v})}}))};var w={};function _(e){"connectFrame"===e.name&&e.onMessage.addListener((function t(n){if("connect"===n.type){var r=n.data,o=s.createSender((function(t){e.postMessage(t)})),i=s.createRespond(e.postMessage.bind(e));e.onMessage.addListener((function(t){if(!o.handleResult(t)&&w.hasOwnProperty(t.type)){var n=w[t.type](r,t.data,e.sender);i(n,t)}})),e.onDisconnect.addListener((function(){var t=m.get(e);t&&y(t.app)&&(u.debug("connect: cancelling start due to port disconnect"),b.cancelPendingStart()),m.delete(e)})),m.set(e,{app:r,sender:o}),e.onMessage.removeListener(t)}}))}return w.startRecording=function(e,t,r){return o((function*(){return u.debug("connect: startRecording",e,t=t||{}),b&&b.appId!==e.id?n.reject("busy"):b&&!(yield b.cancelPendingStart())?(u.debug("connect: could not cancel pending start"),n.reject("busy")):b||!function(e){for(var t of m.values())if(t.app.id===e)return!0;return!1}(e.id)?n.reject("busy"):((b=p(e)).ended.then((function(){v("recordingStateChanged",e.id,"inactive"),b=null})),b.onStateChanged=function(t){v("recordingStateChanged",e.id,t)},b.onTimeChanged=function(t){v("recordingTimeChanged",e.id,t)},t.tabId=r.tab.id,b.start(t))}))},w.stopRecording=function(e){return y(e)?b.stop():n.reject("busy")},w.pauseRecording=function(e){return y(e)?b.pause():n.reject("busy")},w.resumeRecording=function(e){return y(e)?b.resume():n.reject("busy")},w.getRecordingState=function(e){return y(e)?b.getState():"inactive"},w.getRecordingTime=function(e){return y(e)?b.getTime():0},w.storeFileInLibrary=o.wrap((function*(e,o){var i=(o=o||{}).fileId;return(yield t.hasAccess(e.id,i))?(yield h.getFileDescriptor(i)).autoShare?(yield f.storeAutoSharedFile(i),void(o.openFile&&(yield function(e){var t="ng/app/app.html#/files/"+encodeURIComponent(e);return r.create({url:t})}(i)))):n.reject("file is already stored in library"):n.reject("access_denied")})),g.install=function(){c.onConnect.addListener(_),a("connect",g,["install"])},g}])},"/b8I":function(e,t){angular.module("castifyExt.driveUtils",["w69b.googledrive","castifyExt.castifyAuth","w69b.es6","w69b.spawn","cf2.chromeStorageService"]).factory("driveUtils",["googledrive","$q","spawn","$log","cf2ChromeStorageService","$rootScope","$timeout",function(e,t,n,r,o,i,a){var c,s,u={};function l(e){if(e&&e.data){var t,n=e.data;if(n.error&&n.error.errors&&n.error.errors.length&&(t=n.error.errors[0]),t)return t.reason}else if(e&&e.message)return e.message;return null}function d(e,t){var n=e.filter((function(e){return e.type===t}));return n.length?n[0]:null}function f(e){return d(e,"anyone")}function p(e){return d(e,"domain")}function h(e){var t=f(e),n=p(e);return t?t.withLink?"unlisted":"public":n?n.withLink?"domain_unlisted":"domain_public":"private"}return u.getDriveUploadParentId=function(i){return c&&!i||(c=n((function*(){var n=yield o.sync.getSingle("DRIVE_FOLDER_ID");if(n&&(yield function(n){return e.getFile(n).then((function(e){return!e.labels.trashed}),(function(e){return 404!==e.status&&(r.warn("driveUtils: checkIfExists failed",e),t.reject(e))}))}(n)))return r.debug("driveUtil: using cached parent Id",n),n;var i=yield e.listFiles({q:"mimeType = 'application/vnd.google-apps.folder' and trashed = false and 'me' in owners and properties has { key='isScreencastifyUploadFolder' and value='true' and visibility='PRIVATE' }",maxResults:1}).then((function(e){return r.debug("driveUtils: findFolder items #",e.length),e.length?e[0]:null}));i||(i=yield(r.debug("driveUtils: creating Drive folder"),e.postFile({title:"Screencastify",mimeType:"application/vnd.google-apps.folder",description:"Screencastify uses this folder to store Screencasts that you upload. You may rename or move it, it will upload to this folder.",properties:[{key:"isScreencastifyUploadFolder",value:!0,visibility:"PRIVATE"}]})));var a=i.id;return yield o.sync.setSingle("DRIVE_FOLDER_ID",a),a}))).catch((function(e){u.isRateLimitError(e)?(s&&a.cancel(s),s=a((function(){c=null,s=null}),1e4)):c=null})),c},u.getSimplePrivacy=function(t){return e.listPermissions(t).then(h)},u.getLink=function(e){return`https://drive.google.com/file/d/${e}/view`},u.getEmbedLink=function(e){return`https://drive.google.com/file/d/${e}/preview`},u.setSimplePrivacy=function(r,o,i){var a=o.startsWith("domain_");if(a&&!i)throw new Error;return n((function*(){var n=yield e.listPermissions(r),c=f(n),s=p(n);if(h(n)===o)return t.when(null);if("private"!==o){c&&(yield e.removePermission(r,c.id)),s&&(yield e.removePermission(r,s.id));var u={role:"reader",type:a?"domain":"anyone",withLink:"unlisted"===o||"domain_unlisted"===o};return a&&(u.value=i),e.insertPermission(r,u)}c&&(yield e.removePermission(r,c.id)),s&&(yield e.removePermission(r,s.id))}))},u.isGoogleAppsForbiddenError=function(e){return e&&403==e.status&&"domainPolicy"===l(e)},u.isRateLimitError=function(e){return e&&403==e.status&&"rateLimitExceeded"===l(e)},u.findCommentPermissions=function(e){return e?e.filter(e=>"reader"===e.role&&e.additionalRoles&&e.additionalRoles.includes("commenter")):[]},u.findReadOnlyPermissions=function(e){return e?e.filter(e=>!("reader"!==e.role||e.additionalRoles&&e.additionalRoles.includes("commenter"))):[]},i.$on("event:signInChanged",(function(){c=null,o.sync.remove("DRIVE_FOLDER_ID")})),u}])},0:function(e,t,n){e.exports=n("EtE5")},"3Jae":function(e,t){!function(){class e{constructor(){this.reset()}get time(){return this.started?this.paused?this._pausedAtTimestamp-this._firstTimestamp+this._offset:this._now()-this._firstTimestamp+this._offset:0}get started(){return this._firstTimestamp>=0}get paused(){return this._pausedAtTimestamp>=0}_now(){return Date.now()/1e3}start(){this.reset(),this._firstTimestamp=this._now()}reset(){this._firstTimestamp=-1,this._pausedAtTimestamp=-1,this._offset=0}pause(){this.paused||(this._pausedAtTimestamp=this._now())}resume(){if(!this.paused)throw new Error;this._offset-=this._now()-this._pausedAtTimestamp,this._pausedAtTimestamp=-1}}angular.module("castifyExt.pausableTimer",[]).value("PausableTimer",e).value("PausableTimeout",class extends e{constructor(e){super(),this._timeout=e,this.promise=new Promise(e=>this._resolve=e)}get remaining(){return this._timeout-this.time}_startInterval(){this._timerId=setTimeout(this._onTimer.bind(this),1e3*this.remaining)}_onTimer(){this._timerId=null,this._resolve(),this.dispose()}_stopInterval(){this._timerId&&clearTimeout(this._timerId)}start(){super.start(),this._startInterval()}pause(){super.pause(),this._stopInterval()}resume(){super.resume(),this._startInterval()}dispose(){this._stopInterval(),this._resolve=null,this.promise=null}}).value("PausableTriggeringTimer",class extends e{constructor(e,t){super(),this._interval=t,this._listener=e,this._startTime=0}setStartTime(e){this._startTime=e}get time(){return super.time+this._startTime}_fireChange(){this._listener&&this._listener(this.time)}_startInterval(){this._listener&&this._interval&&(this._intervalId=setInterval(this._fireChange.bind(this),this._interval))}_stopInterval(){this._intervalId&&clearInterval(this._intervalId),this._intervalId=0,this._fireChange()}reset(){super.reset(),this._stopInterval()}start(){super.start(),this._startInterval()}pause(){super.pause(),this._stopInterval()}resume(){super.resume(),this._startInterval()}})}()},"44cV":function(e,t){angular.module("castifyExt.youtubeUtils",["castifyExt.castifyAuth"]).factory("youtubeUtils",["$http","$q",function(e,t){var n="https://www.googleapis.com/youtube/v3/videos",r={};function o(e){var n=e.data.items;return n.length?n[0]:t.reject("not found on youtube")}return r.getPrivacy=function(r,i){return function(t,r){return e.get(n,angular.extend({params:{id:t,part:"status,snippet"}},{youtubeAuth:r})).then(o)}(r,i).then((function(e){return i!==e.snippet.channelId?t.reject():e.status.privacyStatus}))},r.getLink=function(e){return"https://youtu.be/"+e},r.setPrivacy=function(t,r,o){return function(t,r,o){return o=angular.extend({id:t},o),e.put(n,o,angular.extend({params:{part:"status"}},{youtubeAuth:r})).then((function(e){return e.data}))}(t,o,{status:{privacyStatus:r}})},r}])},"4Z/A":function(e,t){angular.module("w69b.chromeCommands",["w69b.promiseTool"]).factory("chromeCommands",["promiseTool",function(e){var t={};return t.getAll=e.wrapChromeError(chrome.commands.getAll,chrome.commands),t.onCommand=chrome.commands.onCommand,t}])},"58x+":function(e,t){angular.module("w69b.pnaclModule",[]).factory("pnaclModule",["$q","$log","$timeout",function(e,t,n){return function(r,o,i){var a=["<embed ","width=0 height=0 ",'src="'+r+'" ','ps_tty_prefix="ps:" ps_stdout="/dev/tty" ps_stderr="/dev/tty" type="application/x-'+(o?"pnacl":"nacl")+'" />'].join("");i||(i=document.body);var c,s,u,l=document.createElement("div"),d={isLoaded:!1};function f(){t.error("pnacl module crashed",u.lastError),d.onCrash&&d.onCrash(u.lastError)}function p(e){d.onMessage&&d.onMessage(e)}return d.onMessage=void 0,d.onCrash=void 0,d.load=function(){if(c)return c;var t=e.defer();function r(){l.removeEventListener("load",o,!0),l.removeEventListener("error",h,!0)}function o(){r(),t.resolve()}function h(){r(),t.reject(u.lastError)}l.addEventListener("load",o,!0),l.addEventListener("error",h,!0),l.addEventListener("crash",f,!0),l.addEventListener("message",p,!0),s=n((function(){t.reject("load_timeout")}),8e3),l.innerHTML=a,u=l.children[0],i.appendChild(l),d._pnaclHack=l.offsetTop,(c=t.promise).finally((function(){n.cancel(s),s=null}));var g=c;return c.catch((function(){d.unload()})),g},d.unload=function(){d.isLoaded=!1,l.removeEventListener("message",p,!0),l.removeEventListener("crash",f,!0),l.innerHTML="",i.removeChild(l),u=null,c=null},d.getElement=function(){return u},d.postMessage=function(e){if(!u)throw new Error("not loaded");u.postMessage(e)},d}}])},"5Lhf":function(e,t){angular.module("castifyExt.enterprisePolicy",["cf2.chromeStorageService"]).provider("enterprisePolicy",(function(){var e={};this.setOverride=function(t){e=t},this.$get=["cf2ChromeStorageService","$rootScope",function(t,n){var r={},o=!1,i={options:{}};angular.extend(i,e);var a=["disableSharing","disableSaveToDisk","options"];return a.forEach((function(e){Object.defineProperty(r,e,{get:function(){return i[e]}})})),r.loadedPromise=t.managed.get(a).then((function(t){angular.extend(i,t,e),o=!0})),r.isLoaded=function(){return o},r.has=function(e){return i.hasOwnProperty(e)},r.get=function(e){return i[e]},t.onChanged.addListener((function(e,t){"managed"===t&&(angular.forEach(e,(function(e,t){i[t]=e.newValue})),n.$$phase||n.$digest())})),r}]}))},"5NUK":function(e,t){angular.module("castifyExt.recordingHooks",["castifyExt.videoPreviewRenderer","castifyExt.appOptions","cf2.inAppTabService","castifyExt.bgFiles","castifyExt.connect.bgConnectService","w69b.spawn","w69b.clipboard","w69b.chromeRuntime","w69b.chromeTabs","w69b.filesHelper","castifyExt.recordTool"]).factory("recordingHooks",["$rootScope","$filter","videoPreviewRenderer","chromeTabs","appOptions","bgFiles","clipboard","cf2InAppTabService","$q","$log","$timeout","filesHelper","spawn","bgConnectService",function(e,t,n,r,o,i,a,c,s,u,l,d,f,p){var h=[],g={};function m(e){if(0===e.lastIndexOf("upload:",0)){var t=e.substr("upload:".length);r.create({url:t}),chrome.notifications.clear(e)}}function b(e,t){if(!t.config.isSyncUpload){var n=t.config,r=t.link;if(/https?:\/\//.test(r)){var o='Your screencast "'+n.title+'" has been uploaded. Click here to open it.';n.copyLinkToClipboard&&(a.copy(r),o+=" The link was copied to your clipboard."),n.showNotification&&chrome.notifications.create("upload:"+r,{type:"basic",priority:0,title:"Upload complete",message:o,iconUrl:"images/icon128.png"},angular.noop)}}}function v(e,r,a){return f((function*(){yield function(e){return n.renderPreview(e).catch((function(t){u.warn("rendering preview image failed",e);var n=i.idToLocalFilename(e);return function(e){return d.getFileEntryByPath(e).then((function(e){return d.getMetadata(e)})).then((function(e){return e.size}))}(n).then((function(e){return e<1e4?(u.warn("file is empty, removing it"),d.removeByPath(n),s.reject(t)):null}))}))}(r),a.autoShareApp?yield function(e,t){return f((function*(){var n=t.autoShareApp.id,r=t.connectMeta&&t.connectMeta.shareUrl,o=t.connectMeta&&t.connectMeta.payload;yield i.updateLocalInfo(e,{autoShare:{appId:n,shareUrl:r,payload:o,timestamp:Date.now()}}),yield i.registerLocalFile(e),yield p.share(n,e,r)}))}(r,a):(yield i.registerLocalFile(r),yield function(e,n){let r;var a;return r="tab"===n.captureSource&&"tabTitle"===o.values.videoTitleNamingScheme&&n.tabTitle?""+n.tabTitle:"Untitled: "+(a=Date.now(),t("date")(a,"MMM d, y h:mm a")),i.rename(e,r)}(r,a),o.values.autoOpen&&"recorder:fixedFile"!==e.name&&function(e,t=!1){let n="";n=t?`ng/app/app.html#/files/${encodeURIComponent(e)}?autostopped`:"ng/app/app.html#/files/"+encodeURIComponent(e),l((function(){c.create(n)}),500)}(r,a.timeLimitReached)),u.debug("recording hooks completed for",r)})).catch(e=>{u.debug("recordingHooks:onStopped cancelled",e)})}return g.install=function(){h=[e.$on("recorder:stopped",v),e.$on("recorder:fixedFile",v),e.$on("uploader:complete",b)],chrome.notifications.onClicked.addListener(m)},g.uninstall=function(){h.forEach((function(e){e()})),h=[],chrome.notifications.onClicked.removeListener(m)},g}])},"5Rb+":function(e,t){angular.module("castifyExt.licenseEnforcer",["castifyExt.bgRecord","cf2.userAccount","w69b.chromeTabs"]).factory("licenseEnforcer",["bgRecordService","$rootScope","userAccount","chromeTabs","$log","cf2BgCastifyDrawService",function(e,t,n,r,o,i){var a={install:function(){function r(){var t=e.getConfig();return t.autoShareApp&&t.autoShareApp.isPaid}var a=Number.MAX_VALUE;function c(){n.getAccount().then((function(e){a=e.license.maxLength}))}t.$on("event:userAccountChanged",c),c(),t.$watch((function(){return e.getRecorderState().time>=a}),(function(t){t&&!r()&&(o.debug("recordLimitReached"),chrome.notifications.clear("recordLimitInfo",angular.noop),chrome.notifications.clear("recordLimitReached",angular.noop),e.stop(!0))})),t.$watch((function(){return a-Math.ceil(e.getRecorderState().time)}),(function(e){e>0&&e<=30&&!r()&&function(e){o.debug("recordLimitApproaching");var t={type:"basic",priority:2,title:"Approaching free recording limit",message:"Recording will be stopped automatically in "+e+" seconds. Please upgrade Screencastify to record longer screencasts.",iconUrl:"images/icon128.png"};i.isActiveTabInjected()||chrome.notifications.create("recordLimitInfo",t,angular.noop)}(e)})),t.$on("recorder:stopped",(function(){chrome.notifications.clear("recordLimitInfo",angular.noop)}))}};return chrome.notifications.onClicked.addListener((function(e){"recordLimitReached"!==e&&"recordLimitInfo"!==e||(r.create({url:"https://www.screencastify.com/buy?utm_source=app&utm_medium=notify&utm_campaign=recording_length"}),chrome.notifications.clear(e,angular.noop))})),a}])},"6GBm":function(e,t){angular.module("w69b.googleUploader",["w69b.ngProgressHttp"]).factory("googleUploader",["$progressHttp","$http","$q","$timeout","$log",function(e,t,n,r){var o=!0,i=!0,a=1073741824,c={};function s(e,t){var o=e.headers("Retry-After");if(o&&i)o=Math.min(6e4,1e3*Number(o));else{if(!t)return n.when(e);o=t}return r(angular.noop,o).then((function(){return e}))}function u(e){return e.data}function l(r,i){var c=null,l=n.defer(),d=l.promise,f=!1,p={};function h(e){return!f&&c&&308===e.status?m():o&&!f&&c&&(e.status<=0||e.status>=500&&e.status<=599||e.config&&!1===e.config.authAutoRetry&&401===e.status)?s(e,2e3).then(m):n.reject(e)}function g(t){if(308==t.status){var o,s=t.headers("Range");o=s?Number(s.match(/bytes=0-(\d+)/)[1])+1:0;var u=Math.min(r.size,a),l=Math.min(o+u,r.size)-1,f="bytes "+o+"-"+l+"/"+r.size,p=angular.extend({},i,{url:c,method:"PUT",progressEvents:"upload",transformRequest:null,data:r.slice(o,l+1),googleAuth:!0,authAutoRetry:!1,timeout:d});return p.headers=angular.extend({},p.headers,{"Content-Type":r.type,"Content-Range":f}),e(p).then(null,null,(function(e){return{loaded:(e=e.event).loaded+o,total:r.size}}))}return 200==t.status?t:n.reject(t)}function m(){var e=angular.extend({},i,{timeout:d,googleAuth:!0});return e.headers=angular.extend({},e.headers,{"Content-Range":"bytes */"+r.size}),t.put(c,"",e).then(s,s).then(g).catch(h)}return p.start=function(e,o,a){a=angular.extend({},i,a),angular.extend(a.headers||{},{"X-Upload-Content-Length":r.size,"X-Upload-Content-Type":"video/*"}),a.googleAuth=!0,a.timeout=d;var s=n.defer();return t.post(e,o,a).then((function(e){return c=e.headers("Location"),s.notify({uploadUrl:c}),m()})).catch(h).then(s.resolve.bind(s),s.reject.bind(s),s.notify.bind(s)),p.promise=s.promise.then(u),p.promise},p.resume=function(e){return c=e,p.promise=m().then(u),p.promise},p.cancel=function(){f=!0,l.resolve()},p}return c.setAutoResumeEnabled=function(e){o=e},c.setRespectRetryAfterHeader=function(e){i=e},c.setMaxChunkSize=function(e){a=e},c.resumeUpload=function(e,t,n){var r=l(e,n);return r.resume(t),r},c.driveUpload=function(e,t,n){return c.upload("https://www.googleapis.com/upload/drive/v2/files?uploadType=resumable",e,t,n)},c.upload=function(e,t,n,r,o){var i=l(t,r);return i.start(e,n,o),i},c.generateId=function(){return t.get("https://www.googleapis.com/drive/v3/files/generateIds",{googleAuth:!0,params:{count:1,space:"drive"}}).then(e=>e.data.ids[0])},c}])},"6Mel":function(e,t){angular.module("castifyExt.commonConfig",["castifyExt.castifyAuth","w69b.chromeAnalytics","w69b.chromeRuntime","castifyExt.appOptions","cf2.userAccount","castifyExt.deployConfig"]).config(["$compileProvider","$sceDelegateProvider","analyticsProvider","$locationProvider","deployConfigProvider",function(e,t,n,r,o){n.setTrackingId(o.analyticsId),n.setApp("Screencastify"),t.resourceUrlWhitelist(["self","http://localhost:9008/**","blob:**","filesystem:chrome-extension://**","https://**"]);var i=/^\s*(https?|mailto|blob|chrome-extension|filesystem:chrome-extension):/;e.aHrefSanitizationWhitelist(i),e.imgSrcSanitizationWhitelist(i),r.hashPrefix("")}]).run(["$rootScope","analytics","chromeRuntime","appOptions","$injector","userAccount",function(e,t,n,r,o,i){var a=o.has("$transitions")?o.get("$transitions"):null,c=r.loadedPromise.then(s);function s(){return i.getAccount().then((function(e){let o;o=e.license.isPaid?"paid":e.license.isTester?"tester":"trial",t.tracker.set("dimension1",o),t.tracker.set("dimension2",n.getManifest().version),t.tracker.set("dimension5",r.values.hwEncoding),e.user?(t.tracker.set("userId",e.user.analyticsUid),t.tracker.set("dimension4",e.user.analyticsUid),t.setEnabled(r.values.enableAnalytics&&!1!==e.user.analyticsEnabled)):t.setEnabled(r.values.enableAnalytics)}))}a&&a.onSuccess({},(function(e){var n=e.targetState().state(),r=n.analyticsView||n.pageTitle;r&&c.then((function(){t.tracker.sendAppView(r)}))})),e.$on("event:userAccountChanged",s)}]).factory("castifyConfig",["deployConfig",e=>({API_URL:e.apiUrl,IS_E2E:window.localStorage.e2e})])},"8ZPm":function(e,t){angular.module("castifyExt.webrtcRecorder",["w69b.spawn","w69b.filesHelper","w69b.asyncResponse","castifyExt.pausableTimer"]).factory("webrtcRecorder",["$log","filesHelper","spawn","asyncResponse","PausableTriggeringTimer","$rootScope","$q","PausableTimeout",function(e,t,n,r,o,i,a,c){var s=window.MediaRecorder,u=window.webkitMediaStream||window.MediaStream;function l(){var l,d,f,p={},h=["start","stop","pause","resume","error"];I();var g,m,b,v=Promise.resolve(),y=[],w=0,_=0,S=new o((function(){f.time=S.time,A(),T(),p.onTimeChanged&&p.onTimeChanged(f.time),i.$$phase||i.$apply()}),500),E=!1;function I(){f={state:"inactive",time:0}}function O(t){return v=v.then((function(){if(t||w>65536){var e=new Blob(y);return y.length=0,w=0,g.sendWithResponse("write",e)}})).catch((function(t){e.error("webrtcRecoder: flushQueue failed",t)}))}function C(e){var t;y.push(t=e.data),w+=t.size,_+=t.size,O()}function j(){let t=l?l.state:"inactive";if(e.debug("webrtcRecorder: state change",t),b||f.state!=t){if(b)f.state=b.paused?"paused":"recording";else switch(f.state=t,t){case"paused":S.pause();break;case"recording":S.paused?S.resume():S.started||S.start()}p.onStateChanged&&p.onStateChanged(f.state)}}var A=n.wrap((function*(){g&&(f.fps=yield g.sendWithResponse("getFps"))}));const T=n.wrap((function*(){g&&f.time>=7&&(_||("no_data",E||(E=!0,e.error("webrtcRecorder: fatal error: ","no_data"),function(){if(I(),b&&(b.dispose(),b=null),l){l.removeEventListener("dataavailable",C);try{l.stop()}catch(e){}l=null,y.length=0,w=0}m&&(m.terminate(),m=null,g=null),S.reset()}(),p.onError&&p.onError("no_data"))))}));function x(e,t){l.addEventListener(e,(function n(){l.removeEventListener(e,n),t.apply(this,arguments)}))}return p.onStateChanged=null,p.onTimeChanged=null,p.start=n.wrap((function*(n,o){e.debug("webrtcRecorder: onStart",n,o),(d=new u).addTrack(o.videoTrack),o.audioTrack&&d.addTrack(o.audioTrack);try{l=new s(d,{BitRate:o.bitRate,mimeType:o.mimeType||'video/webm; codecs="vp9, opus"',videoBitsPerSecond:o.bitRate})}catch(f){throw e.error("webrtcEncoder: failed to create MediaRecorder",f),f}function i(){return b=null,a.when(new Promise((function(t){x("start",(function(){e.debug("webrtcEncoder: onStart"),t()})),h.forEach((function(e){l.addEventListener(e,j)})),l.addEventListener("error",t=>e.warn("webrtcEncoder: error event ",t)),l.start(500)})))}return t.isSupported()&&(yield t.removeByPath(n).catch(()=>null)),m=new Worker("/components/castifyMediawriter/dist/mediawriter.worker.min.js"),g=r.createSender(e=>m.postMessage(e)),m.addEventListener("message",e=>g.handleResult(e.data)),g.send("init",{path:n,fsType:"PERSISTENT"}),l.addEventListener("dataavailable",C),o.startDelay?(S.setStartTime(-o.startDelay),S.start(),(b=new c(o.startDelay)).start(),b.promise.then(i),j(),a.when()):i()})),p.pause=function(){return b?(b.pause(),S.pause()):l.pause(),j(),a.when()},p.resume=function(){return b?(b.resume(),S.resume()):l.resume(),j(),a.when()},p.getStateObj=function(){return f},p.load=function(){return a.when()},p.getCurrentTime=function(){return f.time},p.getPreciseCurrentTime=function(){return S.time},p.stop=n.wrap((function*(){if(b)b.dispose(),b=null,S.reset(),j();else{var e=new Promise((function(e){x("stop",(function(){e()}))}));l.stop(),yield e,S.pause(),l=null,yield O(!0)}var t=yield g.sendWithResponse("end");return m.terminate(),m=null,g=null,S.reset(),t})),p}return l.isSupported=function(e){return void 0!==s&&(s.isTypeSupported&&s.isTypeSupported(e||'video/webm; codecs="vp9, opus"')||(n=(t=navigator.userAgent).match(/Firefox\/(\d+)/))&&n[1]>=44&&t.indexOf("Android")<0)&&!function(){var e=/Chrome\/(\d+)/.exec(window.navigator.userAgent);return e&&e[1]<51}();var t,n},l}])},"8iUY":function(e,t){angular.module("castifyExt.connect.appPermissions",["cf2.chromeStorageService","w69b.spawn"]).factory("appPermissions",["cf2ChromeStorageService","spawn",function(e,t){var n={};function r(e){var t=Date.now();return e.filter((function(e){return e.timeout>=t}))}function o(){return e.local.getSingle("appPermissions",[]).then(r)}return n.hasAccess=function(e,t){return o().then((function(n){return n.some((function(n){return n.appId===e&&n.fileId===t}))}))},n.allowAccess=function(n,r){return t((function*(){var t,i=yield o();(i=i.filter((function(e){return e.appId!==n&&e.appId!==r}))).push({appId:n,fileId:r,timeout:Date.now()+18e5}),yield(t=i,e.local.setSingle("appPermissions",t))}))},n}])},"98ZH":function(e,t){angular.module("castifyExt.diskSpaceWatcher",["castifyExt.bgRecord","w69b.filesHelper","w69b.ui.bytesFilter","castifyExt.appOptions","w69b.chromeNotifications","cf2.supportArticlesService"]).factory("diskSpaceWatcher",["bgRecordService","$timeout","filesHelper","$rootScope","$filter","appOptions","chromeNotifications","$log","analytics","cf2SupportArticlesService",function(e,t,n,r,o,i,a,c,s,u){var l,d=0,f=104857600;function p(){return d}function h(){g(),i.values.enableDiskSpaceWatcher&&n.getPersistentQuota().then((function(e){return e.quota-e.usage})).then((function(n){var r;n<=p()?(r={priority:2,title:"Critically low disk space",message:"You have less than 1GB left. Recording was paused automatically.",buttons:[{title:"Help"}]},a.clear("disk_space_critical").finally((function(){u.setNotifyHelp(a.simple.createError(r,"disk_space_critical"),"disk_space")})),c.info("diskSpaceWatcher: auto-pausing on critical low space"),e.pause()):n<=f&&function(e){e+=1073741824;var t={priority:2,title:"Low disk space",message:"You have only "+o("bytes")(e)+" left. Recording will be paused automatically soon.",buttons:[{title:"Help"}]};u.setNotifyHelp(a.simple.createError(t,"disk_space_low"),"disk_space")}(n),n>p()&&(l=t(h,1e4))}))}function g(){l&&(t.cancel(l),l=null)}return{install:function(){r.$watch((function(){return"recording"===e.getRecorderState().state&&!e.isBlocked()}),(function(e,t){e!==t&&(e?h():g())})),r.$on("recorder:stopped",(function(){a.clear("disk_space_critical"),a.clear("disk_space_low")}))},setThresholds:function(e,t){d=t,f=e}}}])},"9I/G":function(e,t){angular.module("w69b.spawn",[]).factory("spawn",["$q",function(e){function t(t,n){var r=n?Promise.reject.bind(Promise):e.reject.bind(e),o=n?Promise.resolve.bind(Promise):e.when.bind(e);function i(e,t){var n;try{n=e(t)}catch(i){return r(i)}return n.done?o(n.value):o(n.value).then(c,s)}var a=t(),c=i.bind(null,a.next.bind(a)),s=i.bind(null,a.throw.bind(a));return c()}return t.wrap=function(e){return function(){var n=arguments;return t(e.bind(this,...n))}},t}])},"9br6":function(e,t){window.angular&&angular.module("w69b.es6",[]),Array.prototype.find||(Array.prototype.find=function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),r=n.length>>>0,o=arguments[1],i=0;i<r;i++)if(e.call(o,t=n[i],i,n))return t}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{enumerable:!1,configurable:!0,writable:!0,value:function(e){if(null==this)throw new TypeError("Cannot convert this value to object");var t=Object(this),n=parseInt(t.length,10)||0;if(0===n)return!1;var r,o=parseInt(arguments[1],10)||0;if(o>=n)return!1;for(o>=0?r=o:(r=n+o)<0&&(r=0);r<n;){var i=t[r];if(e===i||e!=e&&i!=i)return!0;r++}return!1}}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(e,t){var n=this.toString();(void 0===t||t>n.length)&&(t=n.length);var r=n.indexOf(e,t-=e.length);return-1!==r&&r===t}}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(e,t){return this.lastIndexOf(e,t=t||0)===t}})},"9k28":function(e,t){angular.module("castifyExt.bgUserNotifications",["castifyExt.simpleBgServicePublisher","castifyExt.chromeEventPublisher","castifyExt.bgUserAccount","castifyExt.deployConfig","w69b.chromeAnalytics","w69b.chromeRuntime","w69b.chromeAlarms","w69b.throttle","w69b.spawn"]).factory("bgUserNotifications",["$http","$window","deployConfig","spawn","simpleBgServicePublisher","userAccount","$log","$rootScope","chromeAlarms",function(e,t,n,r,o,i,a,c,s){const u=n.notificationUri,l={};function d(e,...t){a.debug("userNotifications: "+e,...t)}function f(){return JSON.parse(t.localStorage.getItem("uNotifications"))}l._storeInBrowser=function(e){t.localStorage.setItem("uNotifications",JSON.stringify(e))};const p=r.wrap((function*(t,n){d(`updating ${t} in firestore...`,n),yield e.put(`${u}${t}`,n,{googleAuth:!0}),function(e,t){const n=Object.keys(t)[0],r=f();r.userNotifications.forEach(r=>{r.id===e&&(r[n]=t[n])}),l._storeInBrowser(r)}(t,n)}));function h(e){"uNotifications"===e.name&&l.loadOrFetch()}function g(){d("setting alarm"),s.create("uNotifications",{periodInMinutes:4320})}return l.hideIconBadge=()=>{chrome.browserAction.setBadgeText({text:""})},l.showIconBadge=()=>{let{userNotifications:e}=f()||{},t=0,n="";e&&e.length&&e.forEach(e=>{e.seen||t++}),t?(d(`has ${t} unseen notifications`),n=t.toString(),chrome.browserAction.setBadgeText({text:n})):l.hideIconBadge()},l.loadOrFetch=r.wrap((function*(){d("loadOrFetch");let{lastFetched:t,userNotifications:n,email:r}=f()||{};const o=yield i.getAccount();if(o.user){if(!t||Date.now()-t>36e5||r!==o.user.email)try{n=(yield e.get(u,{googleAuth:!0})).data,r=o.user.email,t=Date.now(),d("fetched notifications"),g()}catch(a){d("failed to fetch uNotifications",a)}}else n=[],r=null,t=1,d("erased notifications");return d("loaded notifications"),l._storeInBrowser({userNotifications:n,email:r,lastFetched:t}),l.showIconBadge(),n})),l.seen=r.wrap((function*(){const e=f();let t=[];e&&(d("marking all as seen..."),e.userNotifications.forEach(e=>{e.seen||t.push(p(e.id,{seen:!0}))})),yield Promise.all(t),l.hideIconBadge()})),l.clicked=r.wrap((function*(e){d(e+" clicked"),f().userNotifications.forEach(t=>{t.id!==e||t.clicked||p(e,{clicked:!0})})})),l._getFetchIntervals=()=>({MIN_FETCH_INTERVAL:36e5,MAX_FETCH_INTERVAL_MINUTES:4320}),l.install=()=>{o("userNotifications",l,["install"]),c.$on("event:userAccountChanged",l.loadOrFetch),g(),l.loadOrFetch(),s.onAlarm.addListener(h)},l}]).factory("userNotifications",["bgUserNotifications",function(e){return e}])},A5fb:function(e,t){angular.module("castifyExt.branding",["w69b.filesHelper","w69b.spawn"]).factory("branding",["userAccount","$http","filesHelper","spawn","$log",function(e,t,n,r,o){return{getFilename:function(){return r((function*(){try{if(!(yield e.getAccount()).license.branding)return null;yield n.getDirByPath("_branding",{create:!0});var r=yield n.getFileEntryByPath("_branding/_branding.png",{create:!0}),i=yield n.getMetadata(r);if(!i.size||8532!==i.size){var a=yield n.createWriter(r),c=yield t.get("/images/branding.png",{responseType:"blob"});yield n.writeFile(a,c.data)}return"_branding/_branding.png"}catch(s){return o.error("failed to prepare branding file",s),null}}))}}}])},AALf:function(e,t){angular.module("castifyExt.ui.countdownIcon",["w69b.spawn"]).factory("countdownIcon",["spawn","$q",function(e,t){var n={},r=new Map,o={path:{19:"images/icon_countdown19.png",38:"images/icon_countdown38.png"}},i=e.wrap((function*(e,n){var o=document.createElement("canvas");o.width=e,o.height=e;var i=o.getContext("2d"),a=e/38;return i.scale(a,a),i.drawImage(yield function(e){var n=r.get(38);if(n)return n;var o=t.defer(),i=new Image;return i.crossOrigin="anonymous",i.addEventListener("load",(function e(){i.removeEventListener("load",e),o.resolve(i)})),i.src="images/icon38.png",r.set(38,o.promise),o.promise}(),0,0),i.font="bold 35px sans-serif",i.textBaseline="middle",i.textAlign="center",i.fillStyle="red",i.fillText(n,19,19),i.getImageData(0,0,o.width,o.height)}));return n.getIcon=e.wrap((function*(e){return(e=Math.ceil(-e))>=10?t.when(o):{imageData:{38:yield i(38,e)}}})),n}])},AOG9:function(e,t){angular.module("castifyExt.optionalPermissions",["w69b.chromePermissions","castifyExt.deployConfig"]).factory("optionalPermissions",["chromePermissions","deployConfig",function(e,t){var n={},r={permissions:["tabCapture","webNavigation"],origins:["<all_urls>"]},o={permissions:["tabCapture","webNavigation"],origins:[]};function i(e){return e&&(!e.draw||e.draw&&!e.draw.showToolbox)?o:r}return t.enableInlinePopupSupport||(r.permissions.push("activeTab"),o.permissions.push("activeTab")),n.hasLiteTabPermissions=function(){return e.contains(o)},n.hasTabPermissions=function(t){let n=i(t);return e.contains({permissions:n.permissions})},n.requestTabPermissions=function(t){return e.request(i(t))},n}])},"Al3/":function(e,t){angular.module("w69b.throttle",[]).factory("throttle",["$timeout",function(e){return function(t,n,r){var o,i,a;r=!1!==r;var c=function(){return a=angular.copy(arguments,[]),i=function(){return o=null,i=null,t.apply(null,a)},r?(o&&e.cancel(o),o=e(i,n)):o||(o=e(i,n)),o};return c.flush=function(){o&&(e.cancel(o),i())},c}}])},C5ui:function(e,t){angular.module("castifyExt.hdpiTool",[]).factory("hdpiTool",["$window",function(e){var t={};return t.devicePixelRatio=e.devicePixelRatio,t.toPhysicalResolution=function(e){return{width:Math.floor(e.width*t.devicePixelRatio),height:Math.floor(e.height*t.devicePixelRatio)}},t.toCssResolution=function(e){return{width:Math.round(e.width/t.devicePixelRatio),height:Math.round(e.height/t.devicePixelRatio)}},t.getScreenCssResolution=function(){return{width:e.screen.width,height:e.screen.height}},t.scaleResolution=function(e,t){var n=Math.min(t.height/e.height,t.width/e.width,1);return{width:Math.floor(e.width*n),height:Math.floor(e.height*n)}},t}])},CO2U:function(e,t){angular.module("w69b.webrtc",["w69b.promiseTool","w69b.spawn"]).factory("webrtc",["promiseTool","$window","$q","spawn","$log",function(e,t,n,r,o){var i={},a=t.navigator;function c(e){return e.some((function(e){return!!e.label}))}return i.getUserMedia=e.wrapCallbacks(a.getUserMedia||a.webkitGetUserMedia||a.mozGetUserMedia||a.msGetUserMedia,a),i.getSources=a.mediaDevices&&a.mediaDevices.enumerateDevices?function(){return n.when(a.mediaDevices.enumerateDevices()).then((function(e){return e.filter((function(e){return e.kind.endsWith("input")})).map((function(e){var t={id:e.deviceId,label:e.label};return t.kind=e.kind.substring(0,e.kind.length-5),t}))})).catch(e=>(o.info("enumarateDevices() failed, treating it as no devices present",e),[]))}:e.wrapCallbacks(MediaStreamTrack.getSources,MediaStreamTrack),i.getSourcesByKind=function(e){return i.getSources().then((function(t){return t.filter((function(t){return t.kind===e}))}))},i.getVideoSources=function(){return i.getSourcesByKind("video")},i.getAudioSources=function(){return i.getSourcesByKind("audio")},i.hasCamera=function(){return i.getVideoSources().then((function(e){return e.length>0}))},i.hasMicrophone=function(){return i.getAudioSources().then((function(e){return e.length>0}))},i.hasVideoAccess=function(){return i.getVideoSources().then(c)},i.hasAudioAccess=function(){return i.getAudioSources().then(c)},i.getCameraAndMicPermission=r.wrap((function*(){let e=yield i.hasCamera(),t=!1,n=!1;try{let r=yield i.getUserMedia({audio:!0,video:e});n=!!r.getVideoTracks().length,t=!!r.getAudioTracks().length,r.getTracks().forEach((function(e){e.stop()}))}catch(r){}return{video:n,audio:t}})),i}])},CVq3:function(e,t){angular.module("w69b.googledrive",[]).factory("googledrive",["$q","googleauth","$location","$interval","$http","$log",function(e,t,n,r,o,i){var a=!1,c="https://www.googleapis.com/drive/v2/",s={};function u(e){return e.data}function l(e,t){return o.get(c+e,{googleAuth:!0,params:t}).then(u)}function d(e,t){return o.post(c+e,t,{googleAuth:!0}).then(u)}function f(e,t){return o({method:"PATCH",url:c+e,data:t,googleAuth:!0}).then(u)}function p(e){return o.delete(c+e,{googleAuth:!0}).then(u)}return s.isLoaded=function(){return a},s.loadLibs=function(){return a?e.when(null):t.loadClient().then((function(){return e.all([t.gapiLoad("picker")])})).then((function(){a=!0}))},s.getFile=function(e){return i.debug("googledrive.getFile",e),l("files/"+e)},s.listFiles=function(e){return i.debug("googledrive.listFiles",e),l("files/",e).then((function(e){return e.items}))},s.postFile=function(e){return i.debug("googledrive.postFile",e),d("files",e)},s.patchFile=function(e,t){return i.debug("googledrive.patchFile",e,t),f("files/"+e,t)},s.trashFile=function(e){return i.debug("googledrive.trashFile",e),d("files/"+e+"/trash")},s.getAbout=function(){return l("about")},s.showShareSettings=function(n){return t.gapiLoad("drive-share").then((function(){var o=new gapi.drive.share.ShareClient(t.getAppId());o.setItemIds([n]),o.showSettingsDialog();var i=e.defer(),a=r((function(){for(var e=!1,t=document.activeElement;t!==document.documentElement;){if(t.classList.contains("dcs-ad-dcs-c")){e=!0;break}t=t.parentNode}e||(r.cancel(a),i.resolve())}),300);return i.promise}))},s.listPermissions=function(e){return i.debug("googledrive.listPermissions",e),l("files/"+e+"/permissions").then((function(e){return e.items}))},s.insertPermission=function(e,t){return i.debug("googledrive.insertPermissions",e),d("files/"+e+"/permissions",t)},s.patchPermission=function(e,t,n){return i.debug("googledrive.patchPermission",e),f("files/"+e+"/permissions/"+t,n)},s.removePermission=function(e,t){return i.debug("googledrive.removePermission",e,t),p("files/"+e+"/permissions/"+t)},s.getContextAction=function(){var e=n.search().state,t=null;if(angular.isString(e))try{t=JSON.parse(e)}catch(r){}return t?{action:t.action,ids:(t.ids||[]).concat(t.exportIds||[]),parentId:t.parentId,userId:t.userId}:null},s.listComments=function(e){return l(`files/${e}/comments`,{maxResults:100}).then((function(e){return e.items}))},s.insertComment=function(e,t){return d(`files/${e}/comments`,{content:t})},s.patchComment=function(e,t,n){return f(`files/${e}/comments/${t}`,{content:n})},s.deleteComment=function(e,t){return p(`files/${e}/comments/${t}`)},s}])},"D+N8":function(e,t){angular.module("castifyExt.simpleBgServicePublisher",["w69b.chromeRuntime"]).factory("simpleBgServicePublisher",["chromeRuntime","$q","$log",function(e,t,n){return function(r,o,i){var a={};function c(e,i,c){var s=function(e){try{c(e)}catch(t){}};return!(!e||"simpleService"!==e.type||e.service!==r||!o.hasOwnProperty(e.fn)||a[e.fn]||(t.when(o[e.fn](...e.data)).then((function(e){s({data:e})}),(function(t){n.debug(`simpleService(${r}).${e.fn} failed : `,t),s({error:t})})),0))}return(i||[]).forEach((function(e){a[e]=!0})),e.onMessage.addListener(c),function(){e.onMessage.removeListener(c)}}}])},EtE5:function(e,t,n){"use strict";n.r(t);var r,o,i=n("TYT/"),a=n("Llzl"),c=n.n(a),s=n("D57K"),u=Object(s.__assign)(Object(s.__assign)({},(r=function(e,t){void 0===t&&(t="production");var n="production"===t?"screencastify.com":t+".screencastify.com",r="svc."+n;return{test:!1,production:!1,environmentName:t,signInUrl:"https://app."+n+"/extension-auth/handover",extensionServiceUrl:"https://extension."+r+"/api/extensionService",logServiceUrl:"https://log."+r+"/api/logService",dashboardServiceUrl:"https://dashboard."+r+"/api/dashboardService"}}(0,"production"),Object(s.__assign)(Object(s.__assign)({},r),{firebaseConfig:{apiKey:"AIzaSyDraAcnfh7TewzYJS9yt8Togm6_VzB_RJE",authDomain:"castify-storage.firebaseapp.com",databaseURL:"wss://castify-storage.firebaseio.com",projectId:"castify-storage",storageBucket:"castify-storage.appspot.com",messagingSenderId:"37637381719",appId:"1:37637381719:web:379c0d7b8ecdfae2bd8d12"}}))),{production:!0}),l=n("cekD"),d=n("vEql"),f=n.n(d);n("6AkR"),n("MZO8"),n("WpLb"),n("DjTI"),Object(l.a)((function(){return[f.a,(o||(o=f.a.initializeApp(u.firebaseConfig)),o)]})),n("q6u/"),n("9br6"),n("6Mel"),n("tYv9"),n("gfU1");var p=function(){function e(e,t,n,r){this.spawn=e,this.optionalPermissions=t,this.chromeCommands=n,this.webrtc=r,this.setShortcuts=this.spawn.wrap((function(e){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.shouldUseCastifyDraw(e)];case 1:return n.sent()?(t=e.draw,[4,this.chromeCommands.getAll()]):[3,3];case 2:t.chromeCommands=n.sent(),n.label=3;case 3:return[2]}}))})),this.shouldUseCastifyDraw=this.spawn.wrap((function(e){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.optionalPermissions.hasTabPermissions(e)];case 1:return t=n.sent(),[2,["tab","desktop","screen","tab_picker"].includes(e.captureSource)&&t&&!!e.draw]}}))})),this.setControlWebcam=this.spawn.wrap((function(e){var t,n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return t=e.draw,(n=e.audio.mic||e.embedWebcam||"pip"===e.draw.webcamDisplay)?[4,this.webrtc.hasVideoAccess()]:[3,2];case 1:n=r.sent(),r.label=2;case 2:return t.controlWebcam=n,[2]}}))}))}return e.$inject=["spawn","optionalPermissions","chromeCommands","webrtc"],e.prototype.createFromConfig=function(e){var t;return e.draw?((t=e.draw).controlWebcam=!1,t.embedWebcam=!1,t.webcamDisplay="embed",("tab"===e.captureSource||function(e){return"webrtc"===e.encoder&&["desktop","screen","tab_picker"].includes(e.captureSource)}(e))&&(t.controlWebcam=!0,t.embedWebcam=e.embedWebcam,t.camSourceId=e.camSourceId),t):null},e.prototype.enablePiP=function(e){e.controlWebcam=!0,e.webcamDisplay="pip",e.pip=!0,e.embedWebcam=!1},e}();function h(){return window.navigator.userAgent}function g(){return h().includes("Windows NT 10.0")&&81===Number((/Chrome\/(\d+)/.exec(h())||[void 0,0])[1])}function m(e,t,n,r){var o={videoTitleNamingScheme:"tabTitle",notifyAudio:!0,notifyFramerate:!1,notifyTabFocus:!0,uploadPrivacy:"public",autoOpen:!0,autoPlay:!0,driveSync:!0,enableDiskSpaceWatcher:!0,notifySyncProgress:!1,notifyEditProgress:!0,enableAnalytics:!0,showEditToolsHint:!0,enableWindowPicker:!g(),encoder:null,audioCodec:null,bitRateOption:"high",hwEncoding:!1,hideRestartAlert:!1,hideDiscardAlert:!1,featureRolloutRand:null,hasUsedAudioExport:!1,enableAudioExport:!1,enableSurvey:!1,hasSilencedTrimConfirm:!1,hasVisitedNewVDP:!1,useVideoExportForAudioExport:!1,enablePersistentDriveCache:!1,showEditorButtonCovidTrial:!1,showEditorButton:!0,enableProjectShoelaces:!1,enableMicPage2:!1,autoTrim:!1},i=!1,c={},s={},u={};function l(e){return r.options.hasOwnProperty(e)}return c.localValues=a.copy({micGain:1,micAudioProcessing:!0}),c.loadedPromise=n.all({sync:e.sync.getSingle("options"),local:e.local.getSingle("options"),rollout:e.sync.getSingle("rolloutOptions"),managed:r.loadedPromise}).then((function(e){a.extend(s,e.sync),a.extend(u,e.rollout),a.extend(c.localValues,e.local),i=!0})),c.values={},Object.keys(o).forEach((function(e){Object.defineProperty(c.values,e,{enumerable:!0,get:function(){return l(e)?function(e){return r.options[e]}(e):s.hasOwnProperty(e)?s[e]:u.hasOwnProperty(e)?u[e]:o[e]},set:function(t){s[e]=t}})})),c.setRolloutValues=function(t){return e.sync.setSingle("rolloutOptions",u=t)},c.save=function(){return e.sync.setSingle("options",s)},c.saveLocal=function(){return e.local.setSingle("options",c.localValues)},c.isLoaded=function(){return i},c.isSetByEnterprisePolicy=function(e){return l(e)},c.shouldDisableSingleAppRecording=g,e.onChanged.addListener((function(e,n){"sync"===n&&e.options&&(a.extend(s,e.options.newValue),t.$$phase||t.$digest()),"sync"===n&&e.rolloutOptions&&(a.extend(u,e.rolloutOptions.newValue),t.$$phase||t.$digest()),"local"===n&&e.options&&(a.extend(c.localValues,e.options.newValue),t.$$phase||t.$digest())})),c}a.module("castifyExt.drawConfig",[]).service("drawConfig",p),a.module("castifyExt.chromeVideoRecorder",["w69b.pnaclVideoEncoder","w69b.webrtc","w69b.chromeCapture","w69b.chromeTabs","w69b.promiseTool","w69b.spawn","w69b.chromeCommands","castifyExt.ui.audioCountdown","castifyExt.optionalPermissions","castifyExt.resizeTab","castifyExt.audioStreamMixer","castifyExt.requestMicPermission","castifyExt.webrtcRecorder","castifyExt.recordTool","castifyExt.hdpiTool","castifyExt.deadAudioStreamChecker","w69b.filesHelper","castifyExt.pip","castifyExt.drawConfig","cf2.upgradeHelperService"]).provider("chromeVideoRecorder",(function(){var e="/components/castify/pnacl/manifest_pnacl.nmf",t=!0;this.setEncoderUrl=function(n,r){e=n,t=!!r},this.$get=["$log","pnaclVideoEncoder","webrtc","chromeCapture","$q","cf2BgCastifyDrawService","resizeTab","chromeTabs","audioStreamMixer","$rootScope","requestMicPermission","promiseTool","optionalPermissions","spawn","hdpiTool","webrtcRecorder","audioCountdown","filesHelper","deadAudioStreamChecker","pip","drawConfig","cf2UpgradeHelperService","cf2SpeechDetectionService",function(n,r,o,i,c,u,l,d,f,p,h,g,m,b,v,y,w,_,S,E,I,O,C){var j,A,T,x,P=[{width:1920,height:1080},{width:1280,height:720},{width:854,height:480},{width:640,height:360},{width:320,height:240},{width:320,height:180}],R={},k=document.createElement("video"),D=null,$={},F=null,U=!1;function L(e,t){var n=e.getSettings();return Math.floor(n.height*n.width*t)}function M(){n.warn("chromeVideoRecorder: video stream ended while still recording"),p.$broadcast("chromeVideoRecorder:streamEnded")}function N(e){e.getTracks().forEach((function(e){e.stop()}))}function B(){return Number((/Chrome\/(\d+)/.exec(window.navigator.userAgent)||[void 0,0])[1])}function q(){C.stopDetecting(),T&&T.dispose(),T=null,R.video&&R.video.removeEventListener("inactive",M),a.forEach(R,(function(e){N(e)})),R={}}function z(e){R.video&&(R.video.removeEventListener("inactive",M),N(R.video)),R.video=e,e.addEventListener("inactive",M)}function H(e){return e&&("PermissionDeniedError"===e.name||"MediaDeviceFailedDueToShutdown"===e.name||"NotAllowedError"===e.name||"InvalidStateError"===e.name)}function W(e){return n.debug("chromeVideoRecorder: capture mic failed",e&&e.name),"NotReadableError"===e.name?(n.err("chromeVideoRecorder: NotReadableError:",e),c.reject("start_error:no_audio_access")):c.reject(e)}function V(e){var t={video:!0};return e.camSourceId&&(t.video={deviceId:e.camSourceId}),o.getUserMedia(t)}var G=b.wrap((function(e){function t(){var t=[],n=P.filter((function(e){return e.height<=r.height}));e.resolution&&(n=n.filter((function(e){return e.height!==r.height}))).unshift(r),n.forEach((function(e){t.push({minHeight:e.height})}));var o={audio:Q(e),video:{optional:t,mandatory:{maxWidth:r.width,maxHeight:r.height,maxFrameRate:e.targetFPS}}};return e.camSourceId&&(o.video.mandatory.sourceId=e.camSourceId),S.getUserMedia(o).catch(W)}var r,o;return Object(s.__generator)(this,(function(i){switch(i.label){case 0:(r=e.resolution)||(r={width:4096,height:4096}),i.label=1;case 1:return i.trys.push([1,3,,7]),[4,t()];case 2:return[2,i.sent()];case 3:return H(o=i.sent())?[4,h()]:[3,6];case 4:return i.sent(),[4,t()];case 5:return[2,i.sent()];case 6:return n.warn("chromeVideoRecorder: failed to get webcam stream",o),[2,c.reject(o)];case 7:return[2]}}))}));function J(e){return e||c.reject("stream is null")}var Y=b.wrap((function(e){var t,n,r,a,u,l;return Object(s.__generator)(this,(function(d){switch(d.label){case 0:return(t=e.resolution)||(t={width:4096,height:4096}),n=e.audio.system,x&&x.cancelled?[2,c.reject("cancelled")]:["desktop","screen","tab_picker"].includes(e.captureSource)?(r=void 0,r="desktop"===e.captureSource?["screen","window"]:"screen"===e.captureSource?["screen"]:["tab"],B()>=50&&e.audio.system&&r.push("audio"),(D=i.chooseDesktopMedia(r)).promise.finally((function(){D=!1})),[4,D.promise]):[3,2];case 1:return(a=d.sent())?(l={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:a,maxWidth:t.width,maxHeight:t.height,maxFrameRate:e.targetFPS}}},r.includes("window")&&(u=v.scaleResolution(v.getScreenCssResolution(),t),l.video.mandatory=Object(s.__assign)(Object(s.__assign)({},l.video.mandatory),{maxWidth:u.width,maxHeight:u.height,minWidth:u.width,minHeight:u.height})),n&&(l.audio={mandatory:{chromeMediaSource:B()>=52?"desktop":"system"}}),[2,o.getUserMedia(l).then(J)]):[2,c.reject("cancelled")];case 2:if("tab"===e.captureSource)return l={video:!0,videoConstraints:{mandatory:{maxWidth:t.width,maxHeight:t.height,maxFrameRate:e.targetFPS}},audio:n},n&&(l.audioConstraints={mandatory:{googEchoCancellation:!1,googAutoGainControl:!1,googNoiseSuppression:!1,googHighpassFilter:!1}}),[2,i.tabCapture(l).then(J)];if("cam"===e.captureSource)return[2,G(e).then(J)];throw Error();case 3:return[2]}}))}));function Q(e){if(e.audio.mic){var t={echoCancellation:!1!==e.audio.micAudioProcessing};return e.audio.micSourceId&&(t.sourceId=e.audio.micSourceId),{mandatory:t}}return!1}function K(e){var t=!!e.embedWebcam;function r(){return S.getUserMedia({audio:Q(e),video:t}).catch(W)}return t&&e.camSourceId&&(t={mandatory:{sourceId:e.camSourceId}}),r().catch((function(e){return H(e)?(n.debug("chromeVideoRecorder: requesting mic permission"),h().then(r)):c.reject(e)}))}function X(){E.close(),u.disposeAll(),q(),A&&(A=null),F=null}function Z(e){e.audio.system&&"tab"===e.captureSource&&(k.srcObject=R.video,k.volume=1,k.play())}function ee(e){for(var t=2,n=t,r=1;r<Math.floor(16/v.devicePixelRatio);++r)if((n=Math.round(100*v.devicePixelRatio*r)/100)%2==0){t=n;break}var o=e.width%t,i=e.height%t;return!(!o&&!i||(e.width-=o,e.height-=i,0))}function te(e){return e.startDelay&&!1!==e.audibleCountdown?g.withTimeout((function(){return w.load(e.startDelay).catch((function(e){n.warn("chromeVideoRecorder: : loading countdown failed: ",e)}))}),2e3,(function(){return n.warn("chromeVideoRecorder: loading countdown timed out"),!0})):null}function ne(e){n.debug("chromeVideoRecorder: ignoring rejection",e)}return $.togglePipWebcam=b.wrap((function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return E.isActive?(E.close(),[3,4]):[3,1];case 1:return[4,E.open()];case 2:return t.sent(),e=R,[4,V(j)];case 3:e.pip=t.sent(),E.playVideoStream(R.pip),t.label=4;case 4:return[2]}}))})),$.start=function(o){n.debug("chromeVideoRecorder: "+o.captureSource+" recording starting...",o);var i,h=b.wrap((function(){var e,t,n,r;return Object(s.__generator)(this,(function(i){switch(i.label){case 0:return"tab"!==o.captureSource?[2,null]:(n=(t=v).toPhysicalResolution,[4,d.get(o.tabId)]);case 1:return e=n.apply(t,[i.sent()]),o.resolution||(o.resolution=a.copy(e)),o.resolution=v.scaleResolution(e,o.resolution),ee(o.resolution),ee(e)?(r=v.toCssResolution(e),[4,l(o.tabId,r.width,r.height,!1)]):[3,3];case 2:i.sent(),i.label=3;case 3:return[2,null]}}))})),g=b.wrap((function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return o.audio.mic||o.embedWebcam?"cam"!==o.captureSource?[3,1]:(e=i,[3,3]):[3,4];case 1:return[4,K(o)];case 2:e=t.sent(),t.label=3;case 3:return[3,5];case 4:e=null,t.label=5;case 5:return e&&(R.mic=e),[2,e]}}))})),_=b.wrap((function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return"tab"!==o.captureSource?[3,2]:[4,m.hasTabPermissions(o)];case 1:if(!e.sent())return[2,c.reject("tab_permissions_denied")];e.label=2;case 2:return[2]}}))})),S=b.wrap((function(){var e,t,r,a;return Object(s.__generator)(this,(function(s){switch(s.label){case 0:return E.isActive?(t=R,[4,V(o)]):[3,2];case 1:t.pip=s.sent(),E.playVideoStream(R.pip),s.label=2;case 2:return[4,c.all([A.load(),h(),_(),te(o)])];case 3:s.sent(),n.debug("chromeVideoRecorder: getting video stream"),s.label=4;case 4:return s.trys.push([4,6,,7]),[4,Y(o)];case 5:return i=s.sent(),[3,7];case 6:throw r=s.sent(),n.warn("chromeVideoRecorder: could not get video stream",l=r),c.reject(l),r;case 7:return E.isActive&&(E.shouldUse(i)?(E.drawConfig=o.draw,I.enablePiP(o.draw),o.embedWebcam=!1):E.close()),[4,g()];case 8:return e=s.sent(),n.debug("chromeVideoRecorder: got video stream"),z(i),[4,"tab"===o.captureSource?d.get(o.tabId).then((function(e){F.originalMainSize={width:e.width,height:e.height}})):null];case 9:return s.sent(),[4,I.shouldUseCastifyDraw(o)];case 10:return s.sent()?[4,I.setShortcuts(o)]:[3,17];case 11:return s.sent(),o.draw.controlWebcam?[4,I.setControlWebcam(o)]:[3,13];case 12:s.sent(),o.embedWebcam=!1,s.label=13;case 13:return s.trys.push([13,15,,16]),[4,u.loadInTab(o.tabId,o.draw)];case 14:return s.sent(),[3,16];case 15:return a=s.sent(),n.warn("chromeVideoRecorder: failed to initialize draw",a),"webrtc"===o.encoder&&"tab"===o.captureSource&&(o.startDelay=0,F.startDelay=0,w.stop()),[3,16];case 16:return[3,18];case 17:o.draw=null,s.label=18;case 18:return n.debug("chromeVideoRecorder: got all streams"),F.videoTrack=i.getVideoTracks()[0],"webrtc"===o.encoder&&(F.bitRate=function(e,t){switch(t){case"medium":return L(e,5);case"low":return L(e,1);case"high":default:return L(e,20)}}(F.videoTrack,o.bitRateOption)),o.audio.system&&!i.getAudioTracks().length&&(o.audio.system=!1,n.warn("chromeVideoRecorder: failed to capture system audio - stream has no audio track."),p.$broadcast("chromeVideoRecorder:systemAudioUnsupported")),o.audio.system&&o.audio.mic?"webrtc"===o.encoder?(T=f(),F.audioTrack=T.outStream.getAudioTracks()[0],e&&o.audio.mic&&(T.addStream("mic",e),T.setGain("mic",o.audio.micGain||1)),o.audio.system&&T.addStream("system",i)):(F.audioTrack=i.getAudioTracks()[0],F.audioTrack2=e.getAudioTracks()[0],F.micVolume=o.audio.micGain||1):o.audio.mic?"webrtc"!==o.encoder?(F.audioTrack2=e.getAudioTracks()[0],F.micVolume=o.audio.micGain||1):F.audioTrack=e.getAudioTracks()[0]:o.audio.system&&(F.audioTrack=i.getAudioTracks()[0]),o.embedWebcam&&e&&e.getVideoTracks().length&&(F.camTrack=e.getVideoTracks()[0],F.camPosition=o.camPosition),o.audio.mic&&o.computeTrimHint&&A.getPreciseCurrentTime&&C.startDetecting(e.getAudioTracks()[0],(function(){return A.getPreciseCurrentTime()}),o.fileId),Z(o),n.debug("chromeVideoRecorder: starting encoder...",F),[4,A.start(o.filename,F)];case 19:return s.sent(),n.debug("chromeVideoRecorder: "+o.captureSource+" recording started",o),w.start(),[2]}var l}))}));!function(){if(F={},j=o,function(e){e.hwEncoding&&(n.debug("chromeVideoRecorder: trying to use hw encoding"),e.encoder="webrtc",F.mimeType='video/webm; codecs="h264, opus"',(!e.resolution||e.resolution.width>1920)&&(e.resolution={width:1920,height:1080}))}(o),"webrtc"===o.encoder?F.mimeType||(F.mimeType='video/webm; codecs="vp8, opus"'):("nacl"===o.encoder?F.codec=null:o.encoder&&(F.codec=o.encoder),o.audioCodec&&(F.audioCodec=o.audioCodec)),o.draw=I.createFromConfig(o),o.targetFPS=o.targetFPS||30,o.draw&&(o.draw.timeLimit=O.getRecordingTimeLimit()),"cam"===o.captureSource&&(o.audio.system=!1,o.embedWebcam=!1,F.videoTrackIsCam=!0),!o.filename)throw new Error("filename required");o.audio||(o.audio={}),o.startDelay&&(F.startDelay=o.startDelay),x={cancelled:!1,cancel:function(){x.cancelled=!0,D&&D.cancel("cancelled")}},(A=function(){if("webrtc"===o.encoder){if(y.isSupported(o.mimeType))return y();F.encoder=null}return r(e,t)}()).onCrash=function(e){n.warn("chromeVideoRecorder: video encoder crashed",e),X(),p.$broadcast("chromeVideoRecorder:crash",e)},A.onError=function(e){"start_timeout"===e||a.isString(e)&&e.startsWith("start_timeout:")||(X(),p.$broadcast("chromeVideoRecorder:error",e))}}();var P=S().catch((function(e){return n.error("chromeVideoRecorder: start error",e),X(),c.reject(e)}));return x.promise=P,P.finally((function(){x=null})),P},$.setAutoStop=function(e){j.nonpersistent.autoStop=e},$.discard=b.wrap((function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return E.stop(),[4,w.stop()];case 1:return e.sent(),u.disposeAll(),[4,A.stop()];case 2:return e.sent(),q(),A=null,F=null,n.debug("chromeVideoRecorder: discarding recording"),[4,_.removeByPath(j.filename)];case 3:return e.sent(),[2]}}))})),$.restart=b.wrap((function(e,t){var r,o,i,a,l;return void 0===e&&(e=function(){}),void 0===t&&(t=function(e){return e}),Object(s.__generator)(this,(function(f){switch(f.label){case 0:r=b.wrap((function(e){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return n.debug("chromeVideoRecorder: removing files..."),[4,_.removeByPath(e)];case 1:return[2,t.sent()]}}))})),o=b.wrap((function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,w.stop()];case 1:return e.sent(),u.disposeAll(),[4,A.stop()];case 2:return e.sent(),[2]}}))})),i=b.wrap((function(e,t){var n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return[4,te(j)];case 1:return r.sent(),[4,d.getActiveTab()];case 2:return n=r.sent(),j.draw?(j.draw.timeLimit=O.getRecordingTimeLimit(),[4,u.loadInTab(n.id,j.draw).catch(ne)]):[3,4];case 3:r.sent(),r.label=4;case 4:return[4,A.start(e,t)];case 5:return r.sent(),[4,w.start()];case 6:return r.sent(),[2]}}))})),n.debug("chromeVideoRecorder: restarting..."),a=j.filename,U=!0,f.label=1;case 1:return f.trys.push([1,7,8,9]),[4,o()];case 2:return f.sent(),[4,c.when(e())];case 3:return f.sent(),[4,r(a)];case 4:return f.sent(),[4,c.when(t(Object.assign({},j))).then((function(e){return j=e}))];case 5:return f.sent(),[4,i(j.filename,F)];case 6:return f.sent(),[3,9];case 7:throw l=f.sent(),n.error("chromeVideoRecorder: restart error",l),X(),l;case 8:return U=!1,[7];case 9:return[2]}}))})),$.stop=function(){return n.debug("chromeVideoRecorder: "+j.captureSource+" recording stopping...",j),E.stop(),w.stop(),u.disposeAll(),A.stop().finally((function(){q(),A=null,F=null,n.debug("chromeVideoRecorder: "+j.captureSource+" recording stopped",j)}))},$.pause=function(){var e=A.pause();return e.then((function(){w.pause()})),e},$.resume=function(){var e=A.resume();return e.then((function(){w.start()})),e},$.setMicGain=function(e){T&&T.setGain("mic",e)},$.getState=function(){return $.getStateObj().state},$.getStateObj=function(){var e;return e=U?{state:"recording",time:0}:A?A.getStateObj():{state:"inactive",time:0},a.extend({},e,{isDesktopDialogShown:!!D})},$.cancelPendingStart=function(){return!!x&&(x.cancel(),!0)},$.getCurrentTime=function(){return A?A.getCurrentTime():0},$.getRecordingConfig=function(){return j},$.replaceStream=b.wrap((function(e){var t,r,o,i,l,d;return Object(s.__generator)(this,(function(s){switch(s.label){case 0:if(j.tabId===e.tabId)throw new Error("cannot replace stream for same tab");if(t=j.tabId,r=j.audio.system,o=a.extend({},j,e),!A.replaceTracks)throw new Error("chromeVideoRecorder: replaceTracks not supported by chosen recorder");s.label=1;case 1:return s.trys.push([1,3,,4]),[4,Y(o)];case 2:return i=s.sent(),[3,4];case 3:return l=s.sent(),n.warn("chromeVideoRecorder: could not get replacement stream",l),[2,c.reject(l)];case 4:return j=o,d={videoTrack:i.getVideoTracks()[0]},r&&(d.audioTrack=i.getAudioTracks()[0]),o.draw&&(o.draw.timeLimit=O.getRecordingTimeLimit(),u.loadInTab(o.tabId,o.draw).catch(ne),u.disposeInTab(t)),[4,A.replaceTracks(d)];case 5:return s.sent(),F.videoTrack=i.getVideoTracks()[0],z(i),Z(o),[2]}}))})),$}],this.$get.$inject=["$log","pnaclVideoEncoder","webrtc","chromeCapture","$q","cf2BgCastifyDrawService","resizeTab","chromeTabs","audioStreamMixer","$rootScope","requestMicPermission","promiseTool","optionalPermissions","spawn","hdpiTool","webrtcRecorder","audioCountdown","filesHelper","deadAudioStreamChecker","pip","drawConfig","cf2UpgradeHelperService","cf2SpeechDetectionService"]})),n("mim6"),m.$inject=["cf2ChromeStorageService","$rootScope","$q","enterprisePolicy"],a.module("castifyExt.appOptions",["cf2.chromeStorageService","castifyExt.enterprisePolicy"]).factory("appOptions",m),n("fNYK");var b=function(){function e(e){this.$log=e,this.isActive=!1,this.OPENING="OPENING",this.CLOSING="CLOSING",this._stopVideo=this._stopVideo.bind(this),this._leavePipListener=this._leavePipListener.bind(this)}return e.$inject=["$log"],e.prototype.isSupported=function(){var e=this._getChromeVersion();return e>=71&&window.navigator.userAgent.includes("Mac OS")||e>=74},e.prototype._getChromeVersion=function(){return Number((/Chrome\/(\d+)/.exec(window.navigator.userAgent)||[void 0,0])[1])},e.prototype.shouldUse=function(e){var t=e.getVideoTracks()[0],n=t.label.includes("window"),r=t.label.includes("screen");return!n&&!!r},e.prototype.open=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),this._state===this.OPENING?[2]:(this._state=this.OPENING,this.$log.debug("pip: opening..."),[4,this._video.requestPictureInPicture()]);case 1:return t.sent(),this.isActive=!0,this._video.addEventListener("leavepictureinpicture",this._leavePipListener),[3,3];case 2:return e=t.sent(),this.$log.warn("pip: crashed: ",e.message),[3,3];case 3:return this._state=null,[2]}}))}))},e.prototype._leavePipListener=function(){try{if(this._state===this.CLOSING)return;this._state=this.CLOSING,this.isActive=!1,this._stopVideo(),this._drawConfig&&(this._drawConfig.pip=!1),this._video.removeEventListener("leavepictureinpicture",this._leavePipListener)}catch(e){this.$log.warn("pip: closing failed: ",e.message)}this._state=null},e.prototype._stopVideo=function(){this._stream&&this._stream.getTracks().filter((function(e){return"video"===e.kind})).forEach((function(e){return e.stop()})),this._stream=null},e.prototype.close=function(){this.isActive&&this._state!==this.CLOSING&&(this.$log.debug("pip: closing..."),document.exitPictureInPicture())},e.prototype.playVideoStream=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),this._stream=e,this._video.srcObject=e,[4,this._video.play()];case 1:return n.sent(),this._drawConfig.pip=!0,[3,3];case 2:return t=n.sent(),this.$log.debug("pip: playVideoStream failed",t.message),[3,3];case 3:return[2]}}))}))},Object.defineProperty(e.prototype,"drawConfig",{set:function(e){this._drawConfig=e},enumerable:!0,configurable:!0}),e.prototype.stop=function(){this.close(),this.drawConfig=null},e.prototype.load=function(){if(!this._video){var e=document.createElement("video");e.muted=!0,e.setAttribute("preload","metadata"),e.src="../../../videos/black.mp4",this._video=e,document.body.appendChild(this._video),this._state=null}},e}();function v(e){return new Promise((function(t){var n=new Image;n.crossOrigin="anonymous",n.addEventListener("load",(function e(){n.removeEventListener("load",e),t(n)})),n.src=e}))}function y(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t,n,r;return Object(s.__generator)(this,(function(o){switch(o.label){case 0:return[4,v(e)];case 1:return t=o.sent(),n=new OffscreenCanvas(t.width,t.height),(r=n.getContext("2d")).drawImage(t,0,0,n.width,n.height),[2,r.getImageData(0,0,n.width,n.height)]}}))}))}function w(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t,n,r;return Object(s.__generator)(this,(function(o){switch(o.label){case 0:return t={},n={},r=38,[4,y(e)];case 1:return[2,(t.imageData=(n[r]=o.sent(),n),t)]}}))}))}a.module("castifyExt.pip",["castifyExt.appOptions"]).service("pip",b);var _=function(){function e(e){this.encoder=null,this.embedWebcam=!1,this.computeTrimHint=!1,Object.assign(this,e)}return e.prototype.isWindowOrScreenCapturing=function(){return"desktop"===this.captureSource||"screen"===this.captureSource},e}();a.module("castifyExt.bgRecord",["w69b.chromeTabs","w69b.chromeAnalytics","cf2.chromeStorageService","w69b.chromeWindows","w69b.chromeNotifications","w69b.filesHelper","w69b.chromeRuntime","w69b.spawn","castifyExt.switchTab","castifyExt.chromeVideoRecorder","castifyExt.bgFiles","castifyExt.bgUserAccount","castifyExt.appOptions","castifyExt.recordTool","castifyExt.fileNameGenerator","cf2.sentryErrorHandler","castifyExt.connect.appRegistry","castifyEdit.bgEditJobScheduler","castifyExt.ui.countdownIcon","castifyExt.optionalPermissions","castifyExt.bgUserNotifications","castifyExt.pip","cf2.upgradeHelperService","cf2.supportArticlesService"]).factory("bgRecordService",["chromeVideoRecorder","$rootScope","$q","$log","chromeRuntime","chromeTabs","$window","analytics","appOptions","recordTool","fileNameGenerator","bgFiles","cf2ChromeStorageService","chromeWindows","sentryErrorHandler","chromeNotifications","appRegistry","filesHelper","spawn","bgEditJobScheduler","countdownIcon","cf2BgUsageStatsService","userAccount","switchTab","optionalPermissions","userNotifications","pip","cf2SupportArticlesService",function(e,t,n,r,o,i,c,u,l,d,f,p,h,g,m,b,v,y,S,E,I,O,C,j,A,T,x,P){var R,k,D,$,F,U=[],L=!1,M=n.when(),N={};function B(e){return Q._pathToIconConfig("images/"+e+"38.png")}function q(e){if(L)throw new Error("already blocked");L=!0;var t=n.defer();return M=t.promise,e.finally((function(){L=!1,t.resolve()})),e}function z(e,n){r.warn("bgRecord: recorder_fatal_error",n),m.handleError(n&&n.stack?n:new Error("recorder_fatal_error "+n)),J(),"out_of_disk_space"===n?P.setNotifyHelp(b.simple.createError({priority:1,title:"Out of disk space",message:"Recording was stopped forcefully. Your recording might be corrupted.",buttons:[{title:"Help"}]},"disk_space"),"disk_space"):"no_data"===n?P.setNotifyHelp(b.simple.createError({priority:1,title:"Oops, we failed to capture anything",message:"Please try to restart you computer if this problem persists."},"no_audio"),"no_audio"):"add_frame_failed"===n?t.$broadcast("recorder:out_of_memory"):b.simple.createError({priority:1,title:"Oops, something went wrong",message:"Please try to restart Chrome if this problem persists."},"unknown_fatal")}function H(){m.handleError(new Error("encoder_crash")),J(),t.$broadcast("recorder:encoder_crash")}function W(e,t){U.forEach((function(n){n.postMessage({type:e,data:t})}))}var V=S.wrap((function(t){var n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return t||(t=e.getState()),"paused"!==t?[3,2]:[4,B("icon_paused")];case 1:return n=r.sent(),[3,9];case 2:return"recording"!==t?[3,7]:e.getCurrentTime()<0?[4,I.getIcon(e.getCurrentTime())]:[3,4];case 3:return n=r.sent(),[3,6];case 4:return[4,B("icon_recording")];case 5:n=r.sent(),r.label=6;case 6:return T.hideIconBadge(),[3,9];case 7:return[4,B("icon")];case 8:n=r.sent(),T.showIconBadge(),r.label=9;case 9:return chrome.browserAction.setIcon(n),[2]}}))}));function G(t,n){if(void 0===n&&(n=!1),U.length){var r=a.copy(e.getStateObj());a.extend(r,t),r.config=e.getRecordingConfig(),r.previewShown=!!k,r.isBlocked=L,!n&&a.equals(r,N)||(W("stateUpdate",r),N=r)}}function J(){r.debug("bgRecord: cleaning up after fatal error stop"),i.onActivated.removeListener(Q.onTabActivated),ce(),L=!1,ie(!1)}var Y=S.wrap((function(n,o){var i,a,u,l,d,f,g,m,b;return Object(s.__generator)(this,(function(s){switch(s.label){case 0:return r.debug("bgRecord: stop finished"),(i=e.getRecordingConfig()).timeLimitReached=!!o,u=(a=i.filename).split("/").slice(-1)[0],l=p.localFilenameToId(u),d=!1,c.navigator.userAgent.includes("Windows")&&"webrtc"!==i.encoder?(m=(g=y).getMetadata,[4,y.getFileEntryByPath(a)]):[3,4];case 1:return[4,m.apply(g,[s.sent()])];case 2:return(f=s.sent()).size>2e9?(r.debug("Working around 2GB chrome bug on Windows for file of size",f.size),[4,oe(a,l,u)]):[3,4];case 3:s.sent(),d=!0,s.label=4;case 4:return d?[3,6]:[4,y.moveFileByPath(a,u)];case 5:s.sent(),s.label=6;case 6:return h.local.remove("bgRecord:pendingConfig"),[4,C.getAccount()];case 7:return b=s.sent(),n>0?[4,O.trackNewRecording(n,b.license.isPaid)]:[3,9];case 8:s.sent(),s.label=9;case 9:return p.updateLocalInfo(l,{recordingDuration:n}),t.$broadcast("recorder:stopped",l,i),[2]}}))})),Q={};function K(n,o,i){var a,c;switch(n){case"stop":a=e.stop(),c=function(){return Y(o,i)};break;case"pause":a=e.pause(),c=function(){return r.debug("bgRecord: "+n+" finished")};break;case"resume":a=e.resume(),c=function(){return r.debug("bgRecord: "+n+" finished")};break;case"restart":a=e.restart((function(){t.$broadcast("recorder:canceled",e.getRecordingConfig())}),(function(e){return f("/_recording/",".webm").then((function(t){e.filename=t;var n=t.split("/");return e.fileId=p.localFilenameToId(n[n.length-1]),e}))})),c=function(){r.debug("bgRecord: "+n+" finished"),t.$broadcast("recorder:started",e.getRecordingConfig())}}return r.debug("bgRecord: "+n+" in progress..."),a.then(c),q(a),u.trackEvent("recorder",n,"",o||1),a}function X(){return!l.values.hwEncoding&&(r.info("bgRecord: Enabling hw encoding as default encoder..."),l.values.hwEncoding=!0,l.save(),!0)}function Z(){Q.stop()}function ee(){b.simple.createError({priority:1,title:"Not recording system audio",message:"Capturing system audio is only supported for full-screen or tab recording."},"no_system_audio")}function te(t){L||(r.debug("bgRecord: replacing stream...",t),"inactive"!==e.getState()?(b.clear("active_tab"),q(e.replaceStream(t))):r.error("bgRecord: cannot replace tab while not recording"))}function ne(e){if("recorder"===e.name){W("recorderConnected",{}),U.push(e),G({},!0),e.onDisconnect.addListener((function(){var t=U.indexOf(e);t>=0&&U.splice(t,1)}));var n={start:Q.start,stop:Q.stop,restart:Q.restart,replaceStream:te,pause:Q.pause,resume:Q.resume,discard:Q.discard,togglePipWebcam:Q.togglePipWebcam,cancelPendingStart:Q.cancelPendingStart,showPreview:function(e){e?se():ce()},setAutoStop:Q.setAutoStop};e.onMessage.addListener((function(e){n.hasOwnProperty(e.type)&&n[e.type](e.data),t.$$phase||t.$digest()}))}}function re(t){if(!L){var n=e.getState();if("toggle-recording"===t)"recording"===n||"paused"===n?Q.stop():Q.start(F);else if("toggle-pause"===t)"paused"===n?Q.resume():"recording"===n&&Q.pause();else if("focus-tab"===t){var r=e.getRecordingConfig();if("inactive"===n||"tab"!==r.captureSource)return;i.getActiveTab().then((function(e){r.tabId!==e.id&&te({tabId:e.id,windowId:e.windowId,tabTitle:e.title})}))}}}Q.restart=function(){return L||"inactive"===e.getState()?n.reject():K("restart")},Q.stop=function(t){if(L||"inactive"===e.getState())return n.reject();i.onActivated.removeListener(Q.onTabActivated),ce(),b.clear("audio_dropped"),b.clear("active_tab"),b.clear("no_system_audio");var r=e.getCurrentTime();return R.send(),K("stop",Math.round(r),t)},Q.togglePipWebcam=function(){e.togglePipWebcam()},Q.pause=function(){return L||"recording"!==e.getState()?n.reject():(b.clear("active_tab"),K("pause"))},Q.resume=function(){if(!L&&"paused"===e.getState())return i.getActiveTab().then((function(e){Q.onTabActivated({tabId:e.id,windowId:e.windowId})})),K("resume")},Q.setAutoStop=function(t){e.setAutoStop(t)},Q.discard=S.wrap((function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return L||!["paused","recording"].includes(e.getState())?[2]:[4,q(e.discard())];case 1:return t.sent(),u.trackEvent("recorder","discard"),[2]}}))})),Q.start=function(o){if(o instanceof _||(o=new _(o)),L||"inactive"!==e.getState())return n.reject();"desktop"===o.captureSource&&x.isSupported()&&o.embedWebcam&&x.open(),i.onActivated.addListener(Q.onTabActivated),R=u.trackTimer("recorder","duration"),o.audio.micGain=l.localValues.micGain,o.audio.micAudioProcessing=l.localValues.micAudioProcessing,o.audioCodec=l.values.audioCodec,o.bitRateOption=l.values.bitRateOption,o.hwEncoding=l.values.hwEncoding,o.computeTrimHint=l.values.autoTrim&&l.values.hwEncoding,o.resolution=o.limitResolution?o.maxResolution:null,l.values.enableWindowPicker||"desktop"!==o.captureSource||(o.captureSource="screen"),o.encoder=l.values.encoder?l.values.encoder:a.isDefined(window.navigator.mimeTypes["application/x-nacl"])?null:"webrtc",r.debug("bgRecord: starting in progress",o),$={cancelled:!1,cancel:function(){$.cancelled=!0,e.cancelPendingStart()}};var c=(o.autoShareApp?v.getAppInfo(o.autoShareApp.id).then((function(e){o.autoShareApp=e})):n.when()).then((function(){var e=[];return e.push(y.getDirByPath("/_recording",{create:!0})),e.push(f("/_recording/",".webm").then((function(e){o.filename=e;var t=e.split("/");o.fileId=p.localFilenameToId(t[t.length-1])}))),e.push(function(e){return i.getActiveTab().then((function(t){e.tabId=t.id,e.windowId=t.windowId,e.tabTitle=t.title}))}(o)),n.all(e)})).then((function(){return $.cancelled?n.reject("cancelled"):e.start(o).catch((function(t){return"nacl_load"!==t||"webrtc"===o.encoder||o.hwEncoding?n.reject(t):function(){r.info("bgRecord: retrying with hw encoding..."),o.hwEncoding=!0;var t=e.start(o);return t.then(X),t}()}))}));return q(c),c.finally((function(){$=null})),c.then((function(){r.debug("bgRecord: started recording"),h.local.setSingle("bgRecord:pendingConfig",o),o.showPreview&&se(),t.$broadcast("recorder:started",o),W("recordingStarted",{})}),(function(e){if("cancelled"!==e)return G({startError:e}),function(e,t){m.handleError(e&&e.stack?e:new Error("start_error "+e)),"nacl_load"===e?P.setNotifyHelp(b.simple.createError({priority:1,title:"Failed to load NaCl module",message:"Click for help",buttons:[{title:"Help"}]},"load_nacl"),"load_nacl"):"tab_permissions_denied"===e?b.simple.createError({priority:1,title:"Tab recording and annotation tools requires additional permissions.",message:"Please use the Screencastify Icon to start recording."},"tab_permissions_denied"):"start_timeout:no_audio"===e?P.setNotifyHelp(b.simple.createError({priority:1,title:"Failed to capture audio",message:"Please try to restart you computer or re-plug your mic."},"no_audio"),"no_audio"):"start_error:no_audio_access"===e?P.setNotifyHelp(b.simple.createError({priority:1,title:"Failed to access your microphone",message:"Please disable it or restart your computer and try again. Click here for help."},"no_audio_access"),"no_audio_access"):"start_timeout:no_cam"===e?P.setNotifyHelp(b.simple.createError({priority:1,title:"Failed to capture your webcam",message:"Please try to restart you computer or re-plug your cam."},"no_cam"),"no_cam"):e&&"NotAllowedError"===e.name?P.setNotifyHelp(b.simple.createError({priority:1,title:"Recording failed",message:"Please allow screen recording in system preferences. Click here for help."},"blocked_permissions_macos"),"blocked_permissions_macos"):P.setNotifyHelp(b.simple.createError({priority:1,title:"Failed to start recording",message:"tab"===t.captureSource?"Please try to re-open the tab you are trying to record.":"Please try to restart your computer if this problem persists",buttons:[{title:"Help"}]},"start_recording"),"start_recording")}(e,o),n.reject(e)})),c},Q.onTabActivated=S.wrap((function(t){var n,o;return Object(s.__generator)(this,(function(i){switch(i.label){case 0:return n=e.getRecordingConfig(),[4,A.hasTabPermissions(n)];case 1:return o=i.sent(),"recording"!==e.getState()||("desktop"!==n.captureSource&&"screen"!==n.captureSource||!o?"tab"===n.captureSource&&(t.tabId!==n.tabId&&l.values.notifyTabFocus&&t.windowId===n.windowId?j.chromeNotify(n):(r.debug("bgRecord: recording tab got focus"),b.clear("active_tab"))):j.loadAdditionalDraw(t.tabId,n.draw)),[2]}}))}));var oe=S.wrap((function(e,t,n){var o,i,a,c,u;return Object(s.__generator)(this,(function(s){switch(s.label){case 0:return[4,l.loadedPromise];case 1:return s.sent(),l.values.instantUpload&&l.values.driveSync?(r.warn("bgRecord: skipping fix job since instantUpload is enabled"),[4,y.moveFileByPath(e,n)]):[3,3];case 2:return s.sent(),[3,10];case 3:return a=(i=y).getMetadata,[4,y.getFileEntryByPath(e)];case 4:return[4,a.apply(i,[s.sent()])];case 5:o=s.sent(),r.debug("bgRecord: adding fix job for incomplete recording",e,o.size),c=E.addJob({type:"fixWebm",inPath:e,fileId:t,outPath:n,meta:{fileId:t}}),s.label=6;case 6:return s.trys.push([6,8,,10]),[4,c.promise];case 7:return s.sent(),r.debug("bgRecord: fixed incomplete recording",e),[3,10];case 8:return u=s.sent(),r.warn("bgRecord: failed to fix incomplete recording",e,u),[4,y.moveFileByPath(e,n)];case 9:return s.sent(),[3,10];case 10:return[2]}}))})),ie=S.wrap((function(e){var n,r,o,i,a,c,u,l,d,f,g;return Object(s.__generator)(this,(function(b){switch(b.label){case 0:return[4,y.listByPath("/_recording").catch((function(){return null}))];case 1:return(n=b.sent())&&n.length?[4,h.local.getSingle("bgRecord:pendingConfig",void 0)]:[2];case 2:r=b.sent(),e&&(m.handleError(new Error("incomplete recording found.")),t.$broadcast("recorder:incomplete_recording_found")),b.label=3;case 3:b.trys.push([3,8,9,10]),o=Object(s.__values)(n),i=o.next(),b.label=4;case 4:return i.done?[3,7]:(c=(a=i.value.fullPath).split("/").slice(-1)[0],u=p.localFilenameToId(c),[4,oe(a,u,c)]);case 5:b.sent(),l={},r&&r.filename!==a&&(l=r),t.$broadcast("recorder:fixedFile",u,l),b.label=6;case 6:return i=o.next(),[3,4];case 7:return[3,10];case 8:return d=b.sent(),f={error:d},[3,10];case 9:try{i&&!i.done&&(g=o.return)&&g.call(o)}finally{if(f)throw f.error}return[7];case 10:return[2]}}))}));function ae(){(L||"inactive"!==e.getState())&&(r.info("bgRecord: onSuspend() while recorder is active, preventing unloading"),o.getBackgroundPage())}function ce(){k&&g.remove(k),G()}function se(){if(!k){r.debug("bgRecord: opening preview window");var e=4;"cam"===Q.getConfig().captureSource&&(e=1);var t=Math.ceil(c.screen.width/e),n=Math.ceil(c.screen.height/e);g.create({url:"livepreview.html",type:"panel",width:t,height:n,top:c.screen.height-n,left:c.screen.width-t}).then((function(e){k=e.id,G(),g.onRemoved.addListener((function t(n){e.id===n&&(g.onRemoved.removeListener(t),r.debug("bgRecord: closed preview window"),k=null,G())}))}))}}return Q.install=function(){var n;D=t.$new(!0),n=!1,D.$watchCollection(e.getStateObj,(function(){G()})),D.$watch((function(){return L}),(function(e,t){e!==t&&G()})),D.$watch((function(){return[e.getState(),Math.min(0,e.getCurrentTime())]}),(function(){return V()}),!0),D.$watch((function(){return Math.floor(e.getStateObj().droppedAudioTime)}),(function(e){if(l.values.notifyAudio&&e){var t={type:"basic",priority:2,title:"Dropping Audio Frames",message:"Screencastify dropped "+e+" seconds audio. Audio will be choppy. Try to restart recording with a lower resolution or frame rate.",iconUrl:"images/icon128.png"};n?b.update("audio_dropped",t):b.simple.createError(t,"audio_dropped"),n=!0}})),D.$watch((function(){return l.localValues.micGain}),(function(t,n){t!==n&&e.setMicGain(t)})),D.$watch((function(){return Math.floor(e.getCurrentTime()/60)}),(function(e){var t=Q.getConfig();if(t){var n=t.nonpersistent&&t.nonpersistent.autoStop;n&&e>=n&&Q.stop()}})),D.$on("chromeVideoRecorder:streamEnded",Z),D.$on("chromeVideoRecorder:crash",H),D.$on("chromeVideoRecorder:error",z),D.$on("chromeVideoRecorder:systemAudioUnsupported",ee),ie(!0),o.onConnect.addListener(ne),o.onConnectExternal.addListener(ne),o.onSuspend.addListener(ae),chrome.commands.onCommand.addListener(re),d.getRecordConfig().then((function(e){return F=e})),h.onChanged.addListener((function(e,t){"local"===t&&e.recordConfig&&d.getRecordConfig().then((function(e){return F=e}))})),x.load()},Q.uninstall=function(){D.$destroy(),o.onConnect.removeListener(ne),chrome.commands.onCommand.removeListener(re)},Q.getRecorderState=function(){return e.getStateObj()},Q.cancelPendingStart=function(){return!!$&&($.cancel(),!0)},Q.getConfig=function(){return e.getRecordingConfig()},Q.isBlocked=function(){return L},Q.waitWhileBlocked=function(){return M},Q._pathToIconConfig=w,Q}]),n("U5Ke"),n("V0Mt");var S,E,I,O=n("fQLH"),C=n("2Mvu");E=S||(S={}),I=0,E.ensureOnline=function(){0===I&&f.a.database().goOnline(),I++},E.goOfflineIfIdle=function(){0==--I&&f.a.database().goOffline()};var j=function(){function e(){}return e._ref=function(){return f.a.database().ref(this.ROOT_REF)},e.get=function(){var e=this;S.ensureOnline();var t=function(){e._ref().off("value",r),S.goOfflineIfIdle()},n=new O.a,r=function(e){t(),n.next(e.val())};return this._ref().on("value",r,(function(e){t(),n.error(e)})),n.pipe(Object(C.a)()).toPromise()},e.ROOT_REF="/featureRollout",e}();function A(e,t,n,r,o,i,c,u,l,d){var f={},p=null;function h(){return t.navigator.userAgent}function g(){return h().indexOf("CrOS aarch")>=0}function m(e){return n.getSources().then((function(t){function n(e,n){return t.some((function(t){return t.kind===e&&t.label&&(!n||n===t.id)}))}return e.audio.mic&&(n("audio")?e.audio.micSourceId&&!n("audio",e.audio.micSourceId)&&delete e.audio.micSourceId:e.audio.mic=!1),n("video")?e.camSourceId&&!n("video",e.camSourceId)&&delete e.camSourceId:("cam"===e.captureSource&&(e.captureSource="tab"),e.embedWebcam&&(e.embedWebcam=!1)),e}))}function b(e){return e.autoShareApp?r.isConnected(e.autoShareApp.id).then((function(t){return t||delete e.autoShareApp,e})):d.resolve(e)}f.toResolution=function(e){return{width:e.width,height:e.height}},f.getResolutionLimit=function(e,t){return e.limitResolution?"tab"===e.captureSource?i.scaleResolution(i.toPhysicalResolution(t),e.maxResolution):e.maxResolution:null};var v=c.wrap((function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return p?[3,2]:[4,u.cpu.getInfo()];case 1:p=e.sent().numOfProcessors,e.label=2;case 2:return[2,p]}}))})),y=c.wrap((function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,v()];case 1:return e.sent()>=4?[2,{width:1920,height:1080}]:[2,{width:1280,height:720}]}}))})),w=c.wrap((function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return(e=g())?[3,2]:[4,v()];case 1:e=t.sent()<=4,t.label=2;case 2:return[2,e]}}))}));return f.canCaptureSystemAudio=function(){return h().indexOf("Windows")>=0||h().indexOf("CrOS")>=0&&Number((/Chrome\/(\d+)/.exec(window.navigator.userAgent)||[void 0,0])[1])>=46},f.getRecentlyConnectedApp=function(){return r.getRecent().then((function(e){return e?o.getAppInfo(e):null}))},f.clearRecentlyConnectedApp=function(){return r.clearRecent()},f.setRecordConfig=function(t){return e.local.setSingle("recordConfig",t)},f.isInjectable=function(e){return e&&(e.startsWith("https://")||e.startsWith("http://")||e.startsWith("file://"))&&!e.startsWith("https://chrome.google.com/webstore/")},f.getRecordConfigDefaults=function(){return{audio:{mic:!0,system:!1},draw:{showToolbox:!0,tool:"pointer"},embedWebcam:!1,captureSource:"desktop",targetFPS:g()?5:(h().indexOf("CrOS x86_64"),30),exportFormat:"webm",startDelay:l.IS_E2E?0:3,visualCountdown:!0}},f.getRecordConfig=c.wrap((function(){var t,n,r,o,i,c;return Object(s.__generator)(this,(function(s){switch(s.label){case 0:return t=f.getRecordConfigDefaults(),[4,e.local.getSingle("recordConfig",{})];case 1:return n=s.sent(),r=n,a.isDefined(n.limitResolution)?(o=n.limitResolution,[3,4]):[3,2];case 2:return[4,w()];case 3:o=s.sent(),s.label=4;case 4:return r.limitResolution=o,i=n,n.maxResolution?(c=n.maxResolution,[3,7]):[3,5];case 5:return[4,y()];case 6:c=s.sent(),s.label=7;case 7:return i.maxResolution=c,n.audio=a.isObject(n.audio)?n.audio:t.audio,n.draw=n.draw||t.draw,n.embedWebcam=n.embedWebcam||t.embedWebcam,n.captureSource=n.captureSource||t.captureSource,n.targetFPS=n.targetFPS||t.targetFPS,n.exportFormat=n.exportFormat||t.exportFormat,n.startDelay=a.isDefined(n.startDelay)?n.startDelay:t.startDelay,n.visualCountdown=a.isDefined(n.visualCountdown)?n.visualCountdown:t.visualCountdown,"desktop"!==n.captureSource&&"screen"!==n.captureSource||f.canCaptureSystemAudio()||(n.audio.system=!1),n.showPreview=!1,n.nonpersistent={},[4,m(n)];case 8:return[4,b(n=s.sent())];case 9:return[2,n=s.sent()]}}))})),f.isAutoSharePaid=function(){return e.local.getSingle("recordConfig",{}).then((function(e){return e.autoShareApp&&e.autoShareApp.isPaid}))},f}n("werd"),n("jHUz"),A.$inject=["cf2ChromeStorageService","$window","webrtc","cf2ConnectedAppsService","appRegistry","hdpiTool","spawn","chromeSystem","castifyConfig","$q"],a.module("castifyExt.recordTool",["cf2.connectedAppsService","castifyExt.connect.appRegistry","castifyExt.hdpiTool","castifyExt.appOptions","w69b.webrtc","cf2.chromeStorageService","w69b.chromeWindows","w69b.spawn","w69b.chromeSystem"]).factory("recordTool",A),n("ZugE"),n("5NUK"),n("YGdR");var T=function(){function e(){}return e.isLess=function(e,t){function n(e){return e.split(".").map((function(e){return Number(e)}))}for(var r=n(e),o=n(t),i=0;i<Math.max(r.length,o.length);++i){if((r[i]||0)<(o[i]||0))return!0;if((r[i]||0)>(o[i]||0))return!1}return!1},e.isEqual=function(e,t){return!this.isLess(e,t)&&!this.isLess(t,e)},e.isLessOrEqual=function(e,t){return this.isLess(e,t)||this.isEqual(e,t)},e}();angular.module("castifyExt.updateMigrationService",["w69b.chromeRuntime","castifyExt.hdpiTool","castifyExt.appOptions","cf2.chromeStorageService"]).factory("updateMigrationService",["chromeRuntime","$log","cf2ChromeStorageService",function(e,t,n){var r={};function o(r){t.debug("installed",r);let o=e.getManifest().version;"update"===r.reason&&function(e,r){e!==r&&(t.info("updating from "+e+" to "+r),T.isLess(e,"1.35.0")&&n.sync.setSingle("showOldIcon",!0))}(r.previousVersion,o),"install"===r.reason&&n.local.setSingle("tos_confirmed",!0)}return r.install=function(){e.onInstalled.addListener(o)},r}]),n("LHv7"),n("98ZH"),n("Z0Xy"),n("rsSo"),n("AALf"),n("xOqQ"),n("ihUj"),c.a.module("castifyExt.driveFileDb",["cf2.chromeStorageService","w69b.spawn","castifyExt.driveUtils","castifyExt.offline","castifyExt.castifyAuth","castifyExt.appOptions"]).factory("driveFileDb",["googledrive","$q","$log","onlineState","cf2ChromeStorageService","appOptions","spawn",function(e,t,n,r,o,i,a){var u={};function l(e,t){if(e){var n=e.match(/(.*)=s\d+$/);if(n)return n[1]+"=s"+t}return e}function d(e){var t={};return e.forEach((function(e){if("PRIVATE"===e.visibility){if(e.key.indexOf("_")>0){var n=e.key.split("_",2),r=n[0],o=n[1];t[r]||(t[r]={}),t[r][o]=e.value}t[e.key]=e.value}})),t}function f(e){this.updateFromDriveResource_(e)}var p=f.prototype;function h(){return t.when(o.local.getSingle("drive_files",null))}p.updateFromDriveResource_=function(e){var t,r=d(e.properties),o={id:r.uuid,driveId:e.id,thumbnailUrl:l(e.thumbnailLink,400),createdAt:new Date(r.recordingDate?Number(r.recordingDate):e.createdDate),url:(t=e.downloadUrl,t.indexOf("?")>=0?t+="&":t+="?",t+"cache_buster="+Math.floor(1e10*Math.random()).toString().padStart(10,"0").toString().padStart(10,"0")),urlRequiresAccessToken:!0,mimeType:e.mimeType,size:Number(e.fileSize),duration:Number(r.duration),width:Number(r.width),height:Number(r.height),driveInfo:e},i="."+e.fileExtension;void 0===e.title?(n.warn("driveFileDb: file title is undefined, resource is",e),o.title=""):o.title=e.fileExtension&&-1!==e.title.indexOf(i,e.title.length-i.length)?e.title.slice(0,-i.length):e.title,r.youtubeInfo&&(o.youtubeInfo=r.youtubeInfo),c.a.extend(this,o)},p.remove=function(){return e.trashFile(this.driveId)},p.rename=function(t){var n=this.driveInfo.fileExtension;return n&&t.indexOf(n="."+n,t.length-n.length)<0&&(t+=n),e.patchFile(this.driveId,{title:t}).then(this.updateFromDriveResource_.bind(this))},p.updateYoutubeInfo=function(t){return d(this.driveInfo.properties).youtubeInfo=t,e.patchFile(this.driveId,{properties:(n={youtubeInfo:t},r=[],c.a.forEach(n,(function(e,t){c.a.isObject(e)?c.a.forEach(e,(function(e,n){r.push({key:t+"_"+n,value:e,visibility:"PRIVATE"})})):r.push({key:t,value:e,visibility:"PRIVATE"})})),r)});var n,r},u.getFileDescriptor=function(n){return e.listFiles({maxResults:1,q:"trashed = false and properties has { key='uuid' and value='"+n+"' and visibility='PRIVATE' }"}).then((function(e){return e.length?e[0]:t.reject()})).then((function(e){return new f(e)}))};var g=a.wrap((function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,h()];case 1:return(e=t.sent())&&e.fetchDate?[2,e.list]:e&&e.length?[2,e]:[2,[]]}}))}));return u.listFiles=function(){return a((function(){var t,n,a,c;return Object(s.__generator)(this,(function(s){switch(s.label){case 0:return r.isOnline()?[4,h()]:[3,10];case 1:return n=s.sent(),[4,i.loadedPromise];case 2:return s.sent(),i.values.enablePersistentDriveCache&&n&&n.fetchDate&&Date.now()<=n.fetchDate+12e5?(t=n.list,[3,9]):[3,3];case 3:return s.trys.push([3,5,,9]),[4,e.listFiles({maxResults:1e3,q:"trashed = false and 'me' in owners and properties has { key='isScreencastifySyncFile' and value='true' and visibility='PRIVATE' }"})];case 4:return function(e){var t={list:e,fetchDate:Date.now()};o.local.setSingle("drive_files",t)}(t=s.sent()),[3,9];case 5:return(a=s.sent())&&(a.status<=0||a.status>=500)?[4,g()]:[3,7];case 6:return t=s.sent(),[3,8];case 7:throw a;case 8:return[3,9];case 9:return[3,12];case 10:return[4,g()];case 11:t=s.sent(),s.label=12;case 12:return c={},t&&t.forEach((function(e){var t=new f(e);c[t.id]=t})),[2,c]}}))}))},u.clearCache=function(){return o.local.setSingle("drive_files",null)},u}]),n("mV/w"),n("5Rb+"),n("QP76"),n("/b8I"),n("44cV"),n("JYpz"),n("IkP3"),n("Ryvw"),n("UmrE"),n("gCzY"),n("k4Xy"),n("e9m0"),angular.module("castifyExt.youtubeAuth",["w69b.uritool","castifyExt.castifyAuth","w69b.promiseTool"]).factory("authFlowHack",["promiseTool","$interval","chromeRuntime","uritool","$q","$log","$window",function(e,t,n,r,o,i,a){return{launchWebAuthFlow:function(c){return function(c,s){var u=a.open(c),l=!1,d=function(e){var t=o.defer(),i=function(n){if("oauth2AuthResult"===n.type){var o=r.parseUrl(n.data),i=r.parseQuery((o.hash||o.query).substring(1));if(!i||i.state!==e)return;i.error?t.reject({error:i.error||"immediate_failed"}):t.resolve(i)}};return n.onMessageExternal.addListener(i),t.promise.finally((function(){n.onMessageExternal.removeListener(i)})),t}(s);d.promise.then((function(){l=!0}));var f=t((function(){u.closed&&!l&&(i.debug("castifyAuth: user closed oauth window"),d.reject("auth_window_closed"))}),200),p=e.withTimeout((function(){return d.promise}),9e4);return p.finally((function(){t.cancel(f)})),p}(c.url,c.state)}}}]).provider("youtubeAuth",(function(){var e,t=["https://www.googleapis.com/auth/youtube"];this.setScopes=function(e){t=e},this.setClientId=function(t){e=t},this.$get=["castifyAuth","$log","uritool","$q","$http","castifyConfig","deployConfig","authFlowHack",function(n,r,o,i,a,c,s,u){var l=c.API_URL+"/youtube/",d=l+"channels",f=l+"tokens",p={},h=0,g={};function m(e){return e.data}function b(){var n,a=(n={redirect_uri:s.redirectUri,scope:t.join(" "),response_type:"code",client_id:e,access_type:"offline",include_granted_scopes:!1,prompt:"select_account consent"},"https://accounts.google.com/o/oauth2/auth?"+o.encodeQuery(n));return u.launchWebAuthFlow({url:a,interactive:!0}).then((function(e){return r.debug("youtube oauth result",e),e.code?e.code:i.reject("youtube_flow_returned_no_code")}))}function v(e){return a.post(d,{code:e,version:2},{googleAuth:!0}).then(m,(function(e){return r.warn("adding youtube code failed",e),i.reject(400===e.status&&"youtube"===e.data.error?"youtube_no_channels":"youtube_add_code_failed")}))}return g.addChannel=function(){return n.getAuthToken({interactive:!0}).then(b).then(v)},g.listChannels=function(){return a.get(d,{googleAuth:!0}).then(m)},g.removeChannel=function(e){return a.delete(d+"/"+e,{googleAuth:!0}).then(m)},g.getAuthToken=function(e){if(!e.channelId)throw new Error;var t,n=e.channelId,r=Math.floor(Date.now()-h)+12e4,o=p[n];return o&&o.expiresAt>r?t=i.when(o):(t=function(e){return a.get(f+"/"+e,{googleAuth:!0}).then(m).then((function(e){return e.expiresAt=Number(new Date(e.expiresAt)),e.issuedAt=Number(new Date(e.issuedAt)),e}))}(n)).then((function(e){p[n]=e,e.issuedAt&&(h=Date.now()-Number(e.issuedAt))})),t.then((function(e){return e.accessToken}))},g}]})).factory("youtubeHttpAuthInterceptor",["$q","$injector","$log",function(e,t,n){var r;return{request:function(o){return o.youtubeAuth?(o.googleAuth&&delete o.googleAuth,(i=o.youtubeAuth,a={channelId:i},(r||(r=t.get("youtubeAuth")),r).getAuthToken(a)).then((function(e){return o.headers=angular.extend(o.headers||{},function(e){return{Authorization:"Bearer "+e}}(e)),o}),(function(t){return n.warn("youtubeAuth failed",t),e.reject("youtubeAuth failed")}))):o;var i,a}}}]),n("5Lhf"),a.module("castifyExt.crashReporterSetup",["cf2.sentryErrorHandler"]).factory("$exceptionHandler",["$injector",function(e){return function(t,n){e.get("$log").error(t,n),t&&e.get("sentryErrorHandler").handleError(t)}}]),n("NkpF"),n("MWHJ"),n("U148"),angular.module("castifyExt.firebase",[]).factory("firebase",()=>f.a),n("A5fb"),n("D+N8"),n("oRFD"),n("dE4o"),n("+m22"),a.module("castifyExt.connect.appRegistry",["w69b.spawn","cf2.chromeStorageService"]).factory("appRegistry",["castifyConfig","$http","$q","spawn","cf2ChromeStorageService",function(e,t,n,r,o){var i=e.API_URL+"/apps",a={};function c(){return o.local.getSingle("appRegistry:cache",[])}function u(e){return c().then((function(t){return t.filter((function(t){return e.includes(t.id)}))}))}function l(e){return e.forEach((function(e){delete e._fetchTimestamp})),e}function d(e,t){return r((function(){var n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return e=new Set(e||[]),[4,c()];case 1:return n=r.sent(),t.forEach((function(t){e.add(t.id)})),n=n.filter((function(t){return!e.has(t.id)})),t.forEach((function(e){e._fetchTimestamp=Date.now()})),[4,(i=n=n.concat(t),o.local.setSingle("appRegistry:cache",i))];case 2:return r.sent(),[2]}var i}))}))}function f(e){return r((function(){var r,o,a;return Object(s.__generator)(this,(function(c){switch(c.label){case 0:return e&&0!==e.length?[4,u(e)]:[2,n.when([])];case 1:if(function(e,t){var n=Date.now();return!e.some((function(e){return n>e._fetchTimestamp+6e4}))&&t.length===e.length}(o=c.sent(),e))return[2,l(o)];c.label=2;case 2:return c.trys.push([2,4,,5]),[4,t.get(i,{params:{ids:e}})];case 3:return a=c.sent(),r=a.data,[3,5];case 4:return c.sent(),[2,l(o)];case 5:return[4,d(e,r)];case 6:return c.sent(),[2,l(r)]}}))}))}return a.getApps=function(e){return f(e)},a.getAppInfo=function(e){return f([e]).then((function(e){return e.length?e[0]:n.reject()}))},a}]),n("8iUY"),n("PdQI"),n("8ZPm"),n("3Jae"),n("AOG9"),n("C5ui");var x=n("HnWI");function P(e,t){return new x.a((function(n){return e.$on(t,(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.next(e)}))}))}var R=n("W/Ou"),k=n("AouM"),D=n("cGAd"),$=n("Jg5f"),F=n("lqvn");c.a.module("castifyExt.bgUserAccount",["castifyExt.chromeEventPublisher","castifyExt.simpleBgServicePublisher","castifyExt.castifyAuth","castifyExt.bgLicensing","w69b.chromeRuntime","cf2.chromeStorageService","w69b.promiseTool","w69b.spawn"]).factory("bgUserAccount",["$http","castifyAuth","$rootScope","castifyConfig","spawn","promiseTool","simpleBgServicePublisher","$log","cf2ChromeStorageService","chromeRuntime","bgLicensing","$q","cf2BgUsageStatsService",function(e,t,n,r,o,i,a,u,l,d,f,p,h){var g={},m=r.API_URL+"/account",b=i.serializer(),v=null;function y(e){return e.data}var w=o.wrap((function(){return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,t.isSignedIn()];case 1:return n.sent()?[2,e.get(m,{params:{license:"1"},googleAuth:!0}).then(y)]:[2,null]}}))}));function _(t){return e.post(m,t,{googleAuth:!0}).then(y)}var S=o.wrap((function(e){var t,n,r,o;return Object(s.__generator)(this,(function(i){switch(i.label){case 0:return[4,p.all([e||w().catch((function(){return null})),f.getLicense()])];case 1:return t=s.__read.apply(void 0,[i.sent(),2]),r=t[1],o=null,(n=t[0])&&(o=n.license,delete n.license),[2,{license:(a=r,c=o,o=c?c.isPaid?c:a.isPaid?a:c.isTester?c:a.isTester?a:c.branding?a.branding?c:a:c:a),user:n}]}var a,c}))}));function E(e){return v=e,l.local.setSingle("userAccount",e)}function I(e){return!e.license||!e.license.validTill||e.license.validTill<Date.now()}var O=i.serializer().wrap(o.wrap((function(e){var t,n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return v?[2,{account:v,updated:!1}]:(t=e,n=!1,e&&I(e)&&(e=null),[4,S(e)]);case 1:return e=r.sent(),u.debug("userAccount: fetched",e),!e.user&&t&&t.user?(u.debug("userAccount: using expired, but signed-in account",t),e=t):(n=!0,E(e),u.debug("userAccount: updated cache")),v=e,[2,{account:e,updated:n}]}}))}))),C=b.wrap(o.wrap((function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return v?[2,v]:[4,l.local.getSingle("userAccount",null)];case 1:return(e=t.sent())&&e.license?[3,3]:[4,O(e)];case 2:return[2,t.sent().account];case 3:return e&&I(e)?(b((function(){return O(e)})).then((function(e){e.updated&&A()})),[2,e]):[2,e];case 4:return[2]}}))}))),j=b.wrap((function(){return u.debug("userAccount: clearing cache"),v=null,E(null)}));function A(){n.$broadcast("event:userAccountChanged"),d.sendMessage({type:"event:userAccountChanged"}).catch(c.a.identity),u.debug("userAccount: firing accountChanged")}function T(){return u.debug("userAccount: refreshing account"),j(),C().finally((function(){A()}))}var x=o.wrap((function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,C()];case 1:return e=t.sent(),[4,M(e)];case 2:return t.sent(),[4,E(e)];case 3:return t.sent(),u.debug("userAccount: redecorate account"),d.sendMessage({type:"event:userAccountRedecorated"}).catch(c.a.identity),[2]}}))}));function U(e,t,n){n.isPaidInstall&&T()}function L(e,t,n){function r(e){return!e||e>=Date.now()}r(t)!==r(n)&&T()}var M=o.wrap((function(e){var t,n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return t=e,[4,h.getFreeCount()];case 1:return t.freeRecordingsCount=r.sent(),n=e,[4,h.getPaidCount()];case 2:return n.paidRecordingsCount=r.sent(),[2,e]}}))}));return g.signIn=function(e){return void 0===e&&(e=!1),Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,t.getAuthToken({interactive:!e||"select_account"})];case 1:return n.sent(),T(),[2]}}))}))},g.signOut=o.wrap((function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return u.debug("userAccount: signOut"),[4,p.all([t.signOut(),j()])];case 1:return e.sent(),T(),[2]}}))})),g.getAccount=o.wrap((function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return e=M,[4,C()];case 1:return[2,e.apply(void 0,[t.sent()])]}}))})),g.update=function(){return T()},g.postUpdate=o.wrap((function(e){var t,n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return n=S,[4,_(e)];case 1:return[4,n.apply(void 0,[r.sent()])];case 2:return[4,E(t=r.sent())];case 3:return r.sent(),A(),[2,M(t)]}}))})),g.$testClearMemoryCache=function(){v=null},g.onAccount=function(){return P(n,"event:userAccountChanged").pipe(Object(R.a)(null),Object(k.a)((function(){return g.getAccount()})))},g.install=function(){a("userAccount",g,["install"]),n.$on("event:redecorateAccount",x),n.$on("connect:appConnected",U),n.$on("connect:userExpiryDateChange",L),t.onFbAuthToken().pipe(Object(D.a)(1)).subscribe((function(){return T()})),g.onAccount().pipe(Object($.a)((function(e){return e.user&&e.user.email})),Object(F.a)(),Object(D.a)(1)).subscribe((function(){return n.$broadcast("event:signInChanged"),void d.sendMessage({type:"event:signInChanged"}).catch(c.a.identity)}))},g}]).factory("userAccount",["bgUserAccount",function(e){return e}]),c.a.module("cf2.userAccount",[]),n("9k28"),n("EtHb");var U=n("U3QC"),L=n("88Oa"),M=n("3ygq"),N=n("iJR/"),B=n("QfVV"),q=n("4Kzh"),z=n("wlUu"),H=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),t}(B.a),W=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),Object.defineProperty(t,"root",{get:function(){return this._getRoot("/trimTasks")},enumerable:!0,configurable:!0}),Object.defineProperty(t,"taskQueueName",{get:function(){return"task-FisTrimTask"},enumerable:!0,configurable:!0}),t.Collection=H,t.taskType="FisTrimTask",Object(s.__decorate)([Object(q.a)()],t.prototype,"userId",void 0),Object(s.__decorate)([Object(q.a)()],t.prototype,"driveFileId",void 0),Object(s.__decorate)([Object(q.a)()],t.prototype,"driveInfo",void 0),Object(s.__decorate)([Object(q.a)()],t.prototype,"traceContext",void 0),Object(s.__decorate)([Object(q.a)()],t.prototype,"trimStart",void 0),Object(s.__decorate)([Object(q.a)()],t.prototype,"trimEnd",void 0),t}(z.a),V=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),t}(B.a),G=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),Object.defineProperty(t,"root",{get:function(){return this._getRoot("/videoExportTasks")},enumerable:!0,configurable:!0}),Object.defineProperty(t,"queueTopicSuffix",{get:function(){return"simpleTask2"},enumerable:!0,configurable:!0}),t.Collection=V,t.taskType="FisVideoExportTask",Object(s.__decorate)([Object(q.a)()],t.prototype,"userId",void 0),Object(s.__decorate)([Object(q.a)()],t.prototype,"driveFileId",void 0),Object(s.__decorate)([Object(q.a)()],t.prototype,"exportOptions",void 0),Object(s.__decorate)([Object(q.a)()],t.prototype,"fileName",void 0),Object(s.__decorate)([Object(q.a)()],t.prototype,"driveFolderId",void 0),Object(s.__decorate)([Object(q.a)()],t.prototype,"signedUrl",void 0),Object(s.__decorate)([Object(q.a)()],t.prototype,"traceContext",void 0),t}(z.a);K.$inject=["bgFiles","startFixWebmJob","$q","ExportClientService","castifyAuth"],X.$inject=["simplePortService","$rootScope","ScheduledEditJob","$log","chromeRuntime","sentryErrorHandler","bgFiles","spawn","promiseTool","$q"];var J=function(){function e(e,t){var n=this;this._auth=t,this.promise=Object(N.a)(M.a.root.getById(e)).pipe(Object(U.a)((function(e){return n._task=e})),Object(k.a)((function(e){return e.onProgress()})),Object(U.a)((function(e){return n._progress=e})),Object(L.a)(),Object(k.a)((function(){return n._getResult()}))).toPromise()}return e.prototype._getResult=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,this._task.load()];case 1:return n.sent(),[4,this._auth.onGoogleAuthToken().pipe(Object(C.a)()).toPromise()];case 2:return e=n.sent(),t=this._task.driveInfo,[2,{url:"/ng/app/driveProxy/"+encodeURIComponent(t.name)+"?fileId="+t.id+"&access_token="+e,successMessage:"Audio file has been saved to your Google Drive.",isExport:!0,isDriveExport:!0,driveViewUrl:t.webViewLink,saveFileName:t.name}]}}))}))},e.prototype.getProgress=function(){return this._progress},e}(),Y=function(){function e(e,t){var n=this;this.promise=Object(N.a)(W.root.getById(e)).pipe(Object(U.a)((function(e){return n._task=e})),Object(k.a)((function(e){return e.onProgress()})),Object(U.a)((function(e){return n._progress=e})),Object(L.a)(),Object(k.a)(t),Object(k.a)((function(){return n._getResult()}))).toPromise()}return e.prototype._getResult=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._task.load()];case 1:return t.sent(),[2,{url:(e=this._task.driveInfo).webContentLink,successMessage:"Trim job done.",isExport:!1,isDriveExport:!1,driveViewUrl:e.webViewLink}]}}))}))},e.prototype.getProgress=function(){return this._progress},e}(),Q=function(){function e(e){var t=this;this.promise=Object(N.a)(G.root.getById(e)).pipe(Object(U.a)((function(e){return t._task=e})),Object(k.a)((function(e){return e.onProgress()})),Object(U.a)((function(e){return t._progress=e})),Object(L.a)(),Object(k.a)((function(){return t._getResult()}))).toPromise()}return e.prototype._getResult=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,this._task.load()];case 1:return e.sent(),[2,{taskId:this._task.id,url:this._task.signedUrl,saveFileName:this._task.fileName,successMessage:"Video export job completed",isExport:!0,isDriveExport:!1}]}}))}))},e.prototype.getProgress=function(){return this._progress},e}();function K(e,t,n,r,o){var i=1;return function(){function a(t){this.config=t,this.dismissed=!1,this.state="queued",this._doneDeferred=n.defer(),this.promise=this._doneDeferred.promise,this.id=""+i++,this.promise.catch((function(){return null})),t.meta&&t.meta.fileId&&e.getFileDescriptor(t.meta.fileId).then((function(e){this.fileDesc=e}).bind(this))}return a.prototype.start=function(){var n,i=this;switch(i.state="running",this.config.type){case"fixWebm":n=t(i.config);break;case"audioExport":n=e.getFileDescriptor(i.config.meta.fileId).then((function(e){return r.exportAudio({driveFileId:e.driveInfo.id,driveFolderId:i.config.driveFolderId,fileName:i.config.fileName})})).then((function(e){return new J(e.taskId,o)}));break;case"trim":var a=function(){return e.reload(i.config.meta.fileId)};n=e.getFileDescriptor(i.config.meta.fileId).then((function(e){return r.trim({driveFileId:e.driveInfo.id,trimStart:i.config.trim.trimStart,trimEnd:i.config.trim.trimEnd})})).then((function(e){return new Y(e.taskId,a)}));break;case"videoExport":n=e.getFileDescriptor(i.config.meta.fileId).then((function(e){var t={driveFileId:e.driveInfo.id,fileName:i.config.fileName};return i.config.outFormat.includes("gif")?t.gif={size:i.config.scale}:i.config.outFormat.includes("mp4")?t.mp4={fps:i.config.fps}:i.config.outFormat.includes("mp3")&&(t.mp3=!0),r.exportVideo(t)})).then((function(e){return new Q(e.taskId)}))}var c=n.then((function(e){return i.editJob=e,e.promise}));return c.then(i.onComplete_.bind(i),i.onError_.bind(i)),c.then(this._doneDeferred.resolve.bind(this._doneDeferred),this._doneDeferred.reject.bind(this._doneDeferred)),c},a.prototype.getProgress=function(){return"done"===this.state?1:"running"===this.state&&this.editJob?this.editJob.getProgress():0},a.prototype.onComplete_=function(e){this.result=e,this.state="done"},a.prototype.onError_=function(){this.state="error"},a.prototype.cancel=function(){return!(!this.editJob||!this.editJob.cancel||(this.editJob.cancel(),this.state="cancelled",0))},a.prototype.dismiss=function(){this.dismissed=!0},a.prototype.toJSON=function(){var e={id:this.id,type:this.config.type,result:this.result,state:this.state,outFormat:this.config.outFormat,progress:this.getProgress(),cancelDanger:"fixWebm"===this.config.type,cancelable:!(!this.editJob||!this.editJob.cancel),dismissed:this.dismissed};return this.config.meta&&this.config.meta.fileId&&(e.fileId=this.config.meta.fileId),this.fileDesc?e.fileTitle=this.fileDesc.title:this.config.fileName&&(e.fileTitle=this.config.fileName),e},a}()}function X(e,t,n,r,o,i,a,c,u,l){var d={},f=[];function p(e){return f.filter((function(t){return t.state===e}))}function h(e){return f.find((function(t){return t.id===e}))}function g(){return p("queued")}var m,b=u.serializer().wrap(c.wrap((function(){var e,n,o,i,c,u,d;return Object(s.__generator)(this,(function(f){switch(f.label){case 0:return[4,l.all(g().map((function(e){return e&&!e.config.meta.newVideoDetails?e:a.refresh(e.config.meta.fileId).then((function(){return a.getFileDescriptor(e.config.meta.fileId)})).catch((function(){return null})).then((function(t){return t.driveInfo?e:null}))}))).then((function(e){return e.filter((function(e){return!!e}))}))];case 1:e=f.sent();try{for(n=Object(s.__values)(e),o=n.next();!o.done;o=n.next())r.debug("starting scheduled edit",i=o.value),c=i.start(),t.$broadcast("editJob:started",i.id),c.then(y.bind(null,i),v.bind(null,i))}catch(p){u={error:p}}finally{try{o&&!o.done&&(d=n.return)&&d.call(n)}finally{if(u)throw u.error}}return[2]}}))})));function v(e,n){r.warn("scheduled edit job failed",e,n),b(),t.$broadcast("editJob:failed",e.id,n),"trim"===e.config.type&&d.dismiss(e.id),i.handleError(n)}function y(e,n){r.debug("scheduled edit job completed",e,n),b(),t.$broadcast("editJob:completed",e.id,n)}function w(){(g().length||p("running").length)&&(r.info("onSuspend() while editing is active, preventing unloading"),o.getBackgroundPage())}return t.$on("uploader:complete",b),d.addJob=function(e){r.debug("adding edit job",e);var o=new n(e);return f.push(o),b(),t.$broadcast("editJob:added",o.id),o},d.cancel=function(e){r.debug("canceling edit job",e);var n=h(e);n&&n.cancel()&&t.$broadcast("editJob:cancelled",n.id)},d.dismiss=function(e){var n=h(e);r.debug("dismissing edit job",e),n.dismiss(),t.$broadcast("editJob:dismissed",n.id)},d.getJob=function(e){return h(e)},d.getJobs=function(){return f},d.clearComplete=function(e){f=f.filter((function(t){return"done"!==t.state||e&&t.id!==e})),m&&m.postJobs()},d.install=function(){m=function(){var n=e("editor");function r(){n.postMessage("jobsList",d.getJobs())}return n.handlers={addJob:d.addJob,cancel:d.cancel,dismiss:d.dismiss,getJobs:r,clearComplete:d.clearComplete},t.$on("editJob:completed",r),t.$on("editJob:started",r),t.$on("editJob:cancelled",r),t.$on("editJob:dismissed",r),t.$on("editJob:added",(function(e,t){r(),n.postMessage("jobAdded",d.getJob(t))})),n.install(),{postJobs:r}}(),o.onSuspend.addListener(w)},d}a.module("castifyEdit.bgEditJobScheduler",["castifyEdit.fixWebmJob","castifyExt.bgFiles","castifyExt.simplePortService","castifyExt.deployConfig","w69b.spawn","w69b.promiseTool"]).factory("ScheduledEditJob",K).factory("bgEditJobScheduler",X),n("Sewt"),n("iNku"),n("RnoO"),n("HRCS"),n("kwgm"),n("4Z/A"),n("c4q8"),n("Ie/p"),n("IiHr"),n("sQ84"),n("vEZL"),n("G+hJ"),n("rJTD"),n("6GBm"),n("H+pR"),n("58x+"),n("tUCW"),n("cgCA"),n("kEoX"),n("iTUk"),n("9I/G"),n("Al3/"),n("CO2U"),n("qVZV"),n("CVq3"),n("gutk"),n("wFxG"),n("NqIN"),n("d7dg"),n("WNYX"),n("KGdM"),angular.module("castifyExt.bgApp",["w69b.es6","castifyExt.commonConfig","castifyExt.crashReporterSetup","castifyExt.bgRecord","castifyExt.bgUpload","castifyExt.recordingHooks","castifyExt.updateMigrationService","castifyExt.diskSpaceWatcher","castifyExt.licenseEnforcer","castifyExt.bgFiles","castifyExt.bgSyncManager","castifyExt.syncNotifications","castifyExt.authConfig","castifyEdit.bgEditJobScheduler","w69b.chromeNotifications","castifyExt.connect.bgConnectService","castifyExt.bgSyncDownloader","castifyExt.bgUserAccount","castifyExt.bgUserNotifications","castifyExt.bgRecordingErrorHandler","castifyExt.popupInjector","cf2.background"]).config(["chromeVideoRecorderProvider","deployConfigProvider",function(e,t){e.setEncoderUrl("manifest_encoder.nmf",!1)}]).run(["bgRecordService","bgUploadService","$q","recordingHooks","updateMigrationService","diskSpaceWatcher","licenseEnforcer","bgFiles","googleUploader","chromeRuntime","bgSyncManager","syncNotifications","onlineState","bgEditJobScheduler","chromeNotifications","bgConnectService","bgSyncDownloader","bgUserAccount","bgUserNotifications","popupInjector","bgRecordingErrorHandler","cf2BgMessagesService","bgCf2OnlyServices","cf2RemoteYoutubeUploadService",function(e,t,n,r,o,i,a,c,s,u,l,d,f,p,h,g,m,b,v,y,w,_,S,E){h.simple.defaultOptions={type:"basic",priority:2,iconUrl:"images/icon128.png"},s.setAutoResumeEnabled(!1),s.setRespectRetryAfterHeader(!1),r.install(),n.all([l.install(),e.install(),t.install(),o.install(),i.install(),a.install(),_.install(),c.install(),d.install(),p.install(),g.install(),m.install(),b.install(),v.install(),w.install(),y.install(),S.install()]).finally((function(){_.initializationCompleted()})),f.check(),u.setUninstallURL("https://api.screencastify.com/api/on_uninstall")}]);var Z=n("Valr"),ee=n("paqz"),te=n("E1rE"),ne=n("cr/0");function re(e){return Object(ne.a)((function(t){e.addListener(t)}),(function(t){return e.removeListener(t)}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e}))}var oe=n("8Fqk"),ie=n("JpoA"),ae=n("XO9t"),ce=n("IMYO"),se=n("3n3h"),ue=function(){function e(e){this._sendFn=e,this._msgCnt=0,this._msgResolvers=new Map}return e.prototype.sendWithResponse=function(e,t){return this.sendWithResponseStream(e,t).toPromise()},e.prototype.sendWithResponseStream=function(e,t){var n=this;if("__arUnsubscribe"===e)throw new Error;return new x.a((function(r){var o=++n._msgCnt,i=!0;return function(r){var o=new O.a;return n._msgResolvers.set(r,o),Object(oe.a)((function(){return Object(s.__awaiter)(n,void 0,void 0,(function(){return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,this._sendFn({type:e,data:t,msgId:r})];case 1:return[2,n.sent()]}}))}))})).pipe(Object(ce.a)((function(e){return delete n._msgResolvers[r],Object(ie.a)(e)})),Object(se.a)(o.asObservable()))}(o).subscribe((function(e){return r.next(e)}),(function(e){i=!1,r.error(e)}),(function(){i=!1,r.complete()})),function(){i&&n._sendFn({type:"__arUnsubscribe",msgId:o})}}))},e.prototype.send=function(e,t){if("__arUnsubscribe"===e)throw new Error;this._sendFn("object"==typeof e?e:{type:e,data:t})},e.prototype.handleResult=function(e){if(e&&"result"===e.type){var t=this._msgResolvers.get(e.msgId);if(!t)throw new Error("asyncResponse: no resolver");return e.hasOwnProperty("error")||e.isError?(t.error(e.data),this._msgResolvers.delete(e.msgId)):(e.isNext&&t.next(e.data),e.isComplete&&(t.complete(),this._msgResolvers.delete(e.msgId))),!0}return!1},e}(),le=function(){function e(e){this._sendFn=e,this._subscriptions=new Map}return e.prototype._sendComplete=function(e,t,n){void 0===n&&(n=!0),this._sendFn({type:"result",msgId:t.msgId,data:e,isComplete:!0,isNext:n})},e.prototype._sendError=function(e,t){e instanceof Error&&!("toJSON"in e)&&(e={name:e.name,message:e.message}),this._sendFn({type:"result",msgId:t.msgId,data:e,isError:!0})},e.prototype._sendNext=function(e,t){this._sendFn({type:"result",msgId:t.msgId,data:e,isNext:!0})},e.prototype.respond=function(e,t){return Object(s.__awaiter)(this,void 0,void 0,(function(){var n,r,o,i=this;return Object(s.__generator)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,e];case 1:return n=a.sent(),Object(ae.a)(n)?(r=n.subscribe((function(e){return i._sendNext(e,t)}),(function(e){i._subscriptions.delete(t.msgId),i._sendError(e,t)}),(function(){i._subscriptions.delete(t.msgId),i._sendComplete(void 0,t,!1)})),this._subscriptions.set(t.msgId,r)):this._sendComplete(n,t),[3,3];case 2:return o=a.sent(),this._sendError(o,t),[3,3];case 3:return[2,null]}}))}))},e.prototype.handleMessage=function(e){if(e&&"__arUnsubscribe"===e.type){var t=this._subscriptions.get(e.msgId);return t&&(t.unsubscribe(),this._subscriptions.delete(e.msgId)),!0}return!1},e}(),de=function(){function e(){}return e.create=function(e){var t=chrome.runtime.connect({name:"servify_"+e}),n=new ue((function(e){t.postMessage(e)}));re(t.onMessage).subscribe((function(e){var t=Object(s.__read)(e,2);n.handleResult(t[0])}));var r=new Proxy({},{get:function(e,t){var r=t.toString();return r.startsWith("on")?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.sendWithResponseStream(r,e)}:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.sendWithResponse(r,e)}}}),o=function(){};return o.prototype=r,o},e}();function fe(e){return de.create(e)}var pe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),t.\u0275prov=i.tb({token:t,factory:t.\u0275fac=function(e){return he(e||t)},providedIn:"root"}),t}(fe("userAccount")),he=i.yb(pe),ge=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),t.\u0275prov=i.tb({token:t,factory:t.\u0275fac=function(e){return me(e||t)},providedIn:"root"}),t}(fe("extensionAuth")),me=i.yb(ge),be=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),t.\u0275prov=i.tb({token:t,factory:t.\u0275fac=function(e){return ve(e||t)},providedIn:"root"}),t}(fe("onboarding")),ve=i.yb(be);function ye(){return Object(i.M)("$injector")}var we=new i.m("ajs.analytics",{providedIn:"root",factory:function(){return ye().get("analytics")}}),_e=(new i.m("ajs.backgroundTool",{providedIn:"root",factory:function(){return ye().get("backgroundTool")}}),new i.m("ajs.castifyConfig",{providedIn:"root",factory:function(){return ye().get("castifyConfig")}})),Se=(new i.m("ajs.chromeEventPublisher",{providedIn:"root",factory:function(){return ye().get("chromeEventPublisher")}}),new i.m("ajs.connectService",{providedIn:"root",factory:function(){return ye().get("connectService")}}),new i.m("ajs.chromeSystem",{providedIn:"root",factory:function(){return ye().get("chromeSystem")}}),new i.m("ajs.appOptions",{providedIn:"root",factory:function(){return ye().get("appOptions")}})),Ee=new i.m("ajs.chromeRuntime",{providedIn:"root",factory:function(){return ye().get("chromeRuntime")}}),Ie=new i.m("ajs.chromeWindows",{providedIn:"root",factory:function(){return ye().get("chromeWindows")}}),Oe=new i.m("ajs.chromeTabs",{providedIn:"root",factory:function(){return ye().get("chromeTabs")}}),Ce=(new i.m("ajs.driveUtils",{providedIn:"root",factory:function(){return ye().get("driveUtils")}}),new i.m("ajs.fileDbClient",{providedIn:"root",factory:function(){return ye().get("fileDbClient")}}),new i.m("ajs.webEditUtils",{providedIn:"root",factory:function(){return ye().get("webEditUtils")}}),new i.m("ajs.$log",{providedIn:"root",factory:function(){return ye().get("$log")}}),new i.m("ajs.shareUtils",{providedIn:"root",factory:function(){return ye().get("shareUtils")}}),new i.m("ajs.simpleBgServiceConsumer",{providedIn:"root",factory:function(){return ye().get("simpleBgServiceConsumer")}}),new i.m("ajs.youtubeAuth",{providedIn:"root",factory:function(){return ye().get("youtubeAuth")}}),new i.m("ajs.syncStatusClient",{providedIn:"root",factory:function(){return ye().get("syncStatusClient")}}),new i.m("ajs.onlineState",{providedIn:"root",factory:function(){return ye().get("onlineState")}})),je=(new i.m("ajs.enterprisePolicy",{providedIn:"root",factory:function(){return ye().get("enterprisePolicy")}}),new i.m("ajs.optionalPermissions",{providedIn:"root",factory:function(){return ye().get("optionalPermissions")}}),new i.m("ajs.recordTool",{providedIn:"root",factory:function(){return ye().get("recordTool")}}),new i.m("ajs.bgUserAccount",{providedIn:"root",factory:function(){return ye().get("bgUserAccount")}})),Ae=new i.m("ajs.bgFiles",{providedIn:"root",factory:function(){return ye().get("bgFiles")}}),Te=(new i.m("ajs.deployConfig",{providedIn:"root",factory:function(){return ye().get("deployConfig")}}),new i.m("ajs.UploadBase",{providedIn:"root",factory:function(){return ye().get("UploadBase")}})),xe=(new i.m("ajs.$http",{providedIn:"root",factory:function(){return ye().get("$http")}}),new i.m("ajs.$state",{providedIn:"root",factory:function(){return ye().get("$state")}}),new i.m("ajs.rootScope",{providedIn:"root",factory:function(){return ye().get("$rootScope")}})),Pe=(new i.m("ajs.$stateParams",{providedIn:"root",factory:function(){return ye().get("$stateParams")}}),new i.m("ajs.$location",{providedIn:"root",factory:function(){return ye().get("$location")}}),new i.m("ajs.appRegistry",{providedIn:"root",factory:function(){return ye().get("appRegistry")}})),Re=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),t}(B.a),ke=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),Object.defineProperty(t,"root",{get:function(){return this._getRoot("/youtubeUploadTasks")},enumerable:!0,configurable:!0}),Object.defineProperty(t,"queueTopicSuffix",{get:function(){return"simpleTask2"},enumerable:!0,configurable:!0}),t.Collection=Re,t.taskType="FisYoutubeUploadTask",Object(s.__decorate)([Object(q.a)()],t.prototype,"userId",void 0),Object(s.__decorate)([Object(q.a)()],t.prototype,"driveFileId",void 0),Object(s.__decorate)([Object(q.a)()],t.prototype,"traceContext",void 0),Object(s.__decorate)([Object(q.a)()],t.prototype,"privacy",void 0),Object(s.__decorate)([Object(q.a)()],t.prototype,"channelId",void 0),Object(s.__decorate)([Object(q.a)()],t.prototype,"title",void 0),Object(s.__decorate)([Object(q.a)()],t.prototype,"description",void 0),Object(s.__decorate)([Object(q.a)()],t.prototype,"youtubeInfo",void 0),t}(z.a),De=n("nco3"),$e=n("cUzu"),Fe=function(){function e(e){this._http=e}return e.prototype.createJob=function(e){return this._http.post(u.extensionServiceUrl+"/youtubeUploads/upload",e).toPromise()},e.\u0275fac=function(t){return new(t||e)(i.zb($e.b))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),Ue=function(e){function t(){return e.call(this,"no job found")||this}return Object(s.__extends)(t,e),t}(Error),Le=function(){function e(e,t,n){this._bgFiles=e,this._uploadBase=t,this._clientService=n,t.register_("_youtube_remote_2",function(t){function r(e,n){var r=t.call(this,e)||this;return r.config=e,r.jobId=n,r._task=null,r.progress=null,r._log=De.Log.create("RemoteYoutubeUpload"),r}return Object(s.__extends)(r,t),r.fromObject=function(e){return new r(e.config,e.jobId)},r.prototype.start=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t,n,r,o;return Object(s.__generator)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,9,,10]),t=this.config,this.jobId?[4,this._trackProgress(this.jobId)]:[3,3];case 1:return i.sent(),[4,this._handleComplete()];case 2:return i.sent(),[3,8];case 3:return[4,e.getFileDescriptor(t.fileId)];case 4:return n=i.sent(),[4,this._createJob(n)];case 5:return r=i.sent(),[4,this._trackProgress(r)];case 6:return i.sent(),[4,this._handleComplete()];case 7:i.sent(),i.label=8;case 8:return[3,10];case 9:return o=i.sent(),this._handleError(o),[3,10];case 10:return[2]}}))}))},r.prototype._createJob=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return[4,n.createJob({driveFileId:e.driveInfo.id,privacy:this.config.privacy,title:this.config.title,channelId:this.config.channelId,description:this.config.description||""})];case 1:return t=r.sent(),this.jobId=t.taskId,[2,t.taskId]}}))}))},r.prototype._getYoutubeInfo=function(e){return{id:e.id,channelId:e.snippet.channelId}},r.prototype._trackProgress=function(e){var t=this;return Object(N.a)(ke.root.getById(e)).pipe(Object($.a)((function(e){if(!e)throw new Ue;return t._task=e,e})),Object(k.a)((function(e){return e.onProgress()})),Object(U.a)((function(e){t.progress=e,t.onProgress()})),Object(L.a)()).toPromise()},r.prototype._handleError=function(e){this._log.warn("original error is",e);var t=!1,n="unknown";e instanceof Ue?(t=!1,n=e.message):"unavailable"===e.code?(t=!0,n=e.message):e.status<=0?(t=!0,n=e.statusText||n):"youtubeSignupRequired"===e.msg?(t=!1,n=e.msg):e.status>=500&&e.status<=600||e.config&&!1===e.config.authAutoRetry&&401===e.status?(t=!0,n=e.statusText||n):401===e.status?(t=!1,n=e.statusText||n):"no_youtube_credentials"===e.msg&&(t=!1,n=e.msg),this.onError({isTransient:t,reason:n})},r.prototype._handleComplete=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,ke.root.getById(this._task.id)];case 1:return t=n.sent(),this._task=t,this.handleComplete_(t.youtubeInfo),e.updateYoutubeInfo(this.config.fileId,this._getYoutubeInfo(t.youtubeInfo)),this.openLink="http://youtu.be/"+t.youtubeInfo.id,this.onComplete(),[2]}}))}))},r.prototype.toObject=function(){return{config:this.config,jobId:this.jobId}},r}(t))}return e.\u0275fac=function(t){return new(t||e)(i.zb(Ae),i.zb(Te),i.zb(Fe))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}();a.module("cf2.remoteYoutubeUploadService",[]);var Me=n("jrvE"),Ne=n("1FNf"),Be=["support_request","logs_page"],qe=Object(s.__spread)(Be.map((function(e){return e+":app"})),Be.map((function(e){return e+":bg"}))),ze=function(){function e(){var e=this;Me.a({beforeSend:function(t){try{if(window.localStorage.e2e)return null}catch(n){}return e._isWhitelisted(t)||Math.random()<.002?t:null},dsn:u.production?"https://83be6b50b8d748f6915a9c3345443403@sentry.io/1538219":"",environment:u.environmentName,release:chrome.runtime.getManifest().version_name,maxBreadcrumbs:100})}return e.prototype._isWhitelisted=function(e){return e&&e.message&&qe.includes(e.message)},e.prototype.configureScope=function(e){Ne.b(e)},e.prototype.captureException=function(e){Ne.a(e)},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac=function(t){return new(t||e)},providedIn:"root"}),e}(),He=["youtubeSignupRequired"],We=function(){function e(e,t){this._injector=e,this._sentry=t,this._hasUserContext=!1,this._patchNgLog()}return e.prototype._setupUserContext=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return this._hasUserContext?[2]:(this._hasUserContext=!0,[4,this._injector.get(pe).getAccount()]);case 1:return(e=t.sent())&&e.user&&this._sentry.configureScope((function(t){t.setUser({email:e.user.email})})),[2]}}))}))},e.prototype._isNonErrorObject=function(e){return"object"==typeof e&&null!==e&&!(e instanceof Error)},e.prototype._getMessage=function(e){return e.message?e.message:e.details?JSON.stringify(e.details):e.reason?e.reason:e},e.prototype.handleError=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,this._setupUserContext()];case 1:return n.sent(),t=this._isNonErrorObject(e)?this._getMessage(e):void 0,this._sentry.captureException(t||e.originalError||e),console.warn(e),[2]}}))}))},e.prototype.shouldIgnoreError=function(e){return He.includes(e)},e.prototype._reportLogArgs=function(e){var t,n;try{for(var r=Object(s.__values)(e),o=r.next();!o.done;o=r.next()){var i=o.value;if(i instanceof Error)return this.handleError(i),!0}}catch(a){t={error:a}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return!1},e.prototype._patchNgLog=function(){var e=this,t=De.Display.msg.bind(De.Display);De.Display.msg=function(n,r,o,i,a,c){var s=t(n,r,o,i,a,c);return a===De.Level.ERROR&&(e._reportLogArgs(r)||e.handleError(n)),s}},e.\u0275fac=function(t){return new(t||e)(i.zb(i.n),i.zb(ze))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}();a.module("cf2.sentryErrorHandler",[]).factory("sentryErrorHandler",Object(ee.b)(We));var Ve=function(){function e(e){if(e)throw new Error("ErrorReportingModule is already loaded. Import it in the AppModule only")}return e.\u0275mod=i.vb({type:e}),e.\u0275inj=i.ub({factory:function(t){return new(t||e)(i.zb(e,12))},providers:[{provide:i.j,useExisting:We}],imports:[[Z.a]]}),e}(),Ge=function(){function e(){var e=this;this.local={},this.sync={},this.managed={},this.onChanged=chrome.storage.onChanged,["local","sync","managed"].forEach((function(t){["set","get","remove","clear"].forEach((function(n){var r,o;e[t][n]=(r=chrome.storage[t][n],o=chrome.storage[t],function(){var e,t=new Promise((function(t,n){e=function(e){chrome.runtime.lastError?n(chrome.runtime.lastError):t(e)}}));return r.apply(o,Object(s.__spread)(arguments,[e])),t})})),e[t].setSingle=function(n,r){var o={};return o[n]=r,e[t].set(o)},e[t].getSingle=function(n,r){return e[t].get(n).then((function(e){return e.hasOwnProperty(n)?e[n]:r}))}}))}return e.\u0275prov=i.tb({token:e,factory:e.\u0275fac=function(t){return new(t||e)},providedIn:"root"}),e}();a.module("cf2.chromeStorageService",[]).factory("cf2ChromeStorageService",Object(ee.b)(Ge));var Je=function(){function e(e,t){this._http=e,this._castifyConfig=t,this._baseUrl=this._castifyConfig.API_URL+"/stats"}return e.prototype.trackNewRecording=function(e){this._http.post(this._baseUrl+"/recording_created",{duration:e},{headers:{auth:"google"}}).toPromise()},e.\u0275fac=function(t){return new(t||e)(i.zb($e.b),i.zb(_e))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),Ye=function(){function e(e,t){this._chromeStorage=e,this._bgUsageStatsClientService=t}return e.prototype._incrementFreeCount=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.getFreeCount()];case 1:return e=t.sent(),[4,this._chromeStorage.local.setSingle("numRecordingsStored",e+1)];case 2:return t.sent(),[2]}}))}))},e.prototype._incrementPaidCount=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.getPaidCount()];case 1:return e=t.sent(),[4,this._chromeStorage.local.setSingle("paidNumRecordingsStored",e+1)];case 2:return t.sent(),[2]}}))}))},e.prototype.getPaidCount=function(){return this._chromeStorage.local.getSingle("paidNumRecordingsStored",0)},e.prototype.getFreeCount=function(){return this._chromeStorage.local.getSingle("numRecordingsStored",0)},e.prototype.trackNewRecording=function(e,t){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return t?[4,this._incrementPaidCount()]:[3,2];case 1:return n.sent(),[3,4];case 2:return[4,this._incrementFreeCount()];case 3:n.sent(),n.label=4;case 4:return this._bgUsageStatsClientService.trackNewRecording(e),[2]}}))}))},e.\u0275fac=function(t){return new(t||e)(i.zb(Ge),i.zb(Je))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}();a.module("cf2.bgUsageStatsService",[]);var Qe=function(){function e(e){if(e)throw new Error("ChromeStorageModule is already loaded.")}return e.\u0275mod=i.vb({type:e}),e.\u0275inj=i.ub({factory:function(t){return new(t||e)(i.zb(e,12))},providers:[Ge],imports:[[Z.a]]}),e}(),Ke=n("0cIN"),Xe=function(){function e(e,t,n){this._cf2ChromeStorageService=e,this._appRegistry=t,this._$rootScope=n}return e.prototype._loadConnectedApps=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,this._cf2ChromeStorageService.sync.getSingle("connectedAppIds",[])];case 1:return[2,e.sent().map((function(e){return"number"==typeof e?{id:e,hasShareUrl:!0}:e}))]}}))}))},e.prototype._loadRecent=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){return[2,this._cf2ChromeStorageService.sync.getSingle("connectedAppRecentId",void 0)]}))}))},e.prototype._saveRecent=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._cf2ChromeStorageService.sync.setSingle("connectedAppRecentId",e)];case 1:return[2,t.sent()]}}))}))},e.prototype._saveConnectedApps=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._cf2ChromeStorageService.sync.setSingle("connectedAppIds",e)];case 1:return[2,t.sent()]}}))}))},e.prototype.getConnectedIds=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,this.getConnectedAppInfo()];case 1:return t=n.sent(),[2,this._filterByQuery(t,e).map((function(e){return e.id}))]}}))}))},e.prototype._filterByQuery=function(e,t){return e.filter((function(e){return!t||Object.keys(t).every((function(n){return t[n]===e[n]}))}))},e.prototype.getConnectedAppInfo=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._loadConnectedApps()];case 1:return e=t.sent(),[4,this._appRegistry.getApps(e.map((function(e){return e.id})))];case 2:return[2,t.sent().map((function(t){var n=e.find((function(e){return e.id===t.id}));return Object(s.__assign)(Object(s.__assign)({},t),n)}))]}}))}))},e.prototype.getConnectedAppInfoById=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return[4,this.getConnectedAppInfo()];case 1:return t=r.sent(),(n=t.find((function(t){return t.id===e})))?[2,n]:[2,null]}}))}))},e.prototype.hasConnectedApps=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.getConnectedAppInfo()];case 1:return[2,e.sent().length>0]}}))}))},e.prototype.isConnected=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._loadConnectedApps()];case 1:return[2,t.sent().some((function(t){return t.id===e}))]}}))}))},e.prototype.disconnect=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,this._loadConnectedApps()];case 1:return t=(t=n.sent()).filter((function(t){return t.id!==e})),[4,this._saveRecent(null)];case 2:return n.sent(),[4,this._saveConnectedApps(t)];case 3:return n.sent(),this._$rootScope.$broadcast("connect:appDisconnected",e),[2]}}))}))},e.prototype.connect=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return[4,this._loadConnectedApps()];case 1:return t=r.sent(),[4,this._appRegistry.getAppInfo(e)];case 2:return n=r.sent(),t.some((function(t){return t.id===e}))?[3,4]:(t.push({id:e,hasShareUrl:!!n.shareUrl}),n.shareUrl?[4,this._saveRecent(e)]:[3,4]);case 3:r.sent(),r.label=4;case 4:return[4,this._saveConnectedApps(t)];case 5:return r.sent(),this._$rootScope.$broadcast("connect:appConnected",e,n),[2]}}))}))},e.prototype._setUserDataForApp=function(e,t,n){return Object(s.__awaiter)(this,void 0,void 0,(function(){var r,o,i;return Object(s.__generator)(this,(function(a){switch(a.label){case 0:return[4,this._loadConnectedApps()];case 1:if(r=a.sent(),!(o=r.find((function(t){return t.id===e}))))throw new Error("Cannot set user data for non-connected app");return i=o[t],null==n?delete o[t]:o[t]=n,[4,this._saveConnectedApps(r)];case 2:return a.sent(),[2,i]}}))}))},e.prototype.setUserExpiryDate=function(e,t){return Object(s.__awaiter)(this,void 0,void 0,(function(){var n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return[4,this._setUserDataForApp(e,"userExpiryDate",t)];case 1:return n=r.sent(),this._$rootScope.$broadcast("connect:userExpiryDateChange",n,t),[2]}}))}))},e.prototype.setUserShareUrl=function(e,t){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,this._setUserDataForApp(e,"shareUrl",t)];case 1:return[2,n.sent()]}}))}))},e.prototype.clearRecent=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,this._saveRecent(null)];case 1:return[2,e.sent()]}}))}))},e.prototype.getRecent=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,this._loadRecent()];case 1:return[2,e.sent()]}}))}))},e.\u0275fac=function(t){return new(t||e)(i.zb(Ge),i.zb(Pe),i.zb(xe))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}();a.module("cf2.connectedAppsService",[]);var Ze=n("12aA"),et=n("pN2L"),tt=n("mUyW"),nt=n("Cc9O"),rt=n("hPFx"),ot=function(e){Error.call(this,e),Error.captureStackTrace&&Error.captureStackTrace(this),this.message=e,this.name=this.constructor.name};ot.prototype=Object.create(Error.prototype);var it=function(e){function t(t){return e.call(this,t)||this}return Object(s.__extends)(t,e),t.isInstance=function(e){return e&&e instanceof this},t}(ot),at=n("2P9O"),ct=function(){function e(e){this._http=e}return e.prototype.getToken=function(){return this._http.get(u.extensionServiceUrl+"/extensionAuth/getToken").toPromise()},e.\u0275fac=function(t){return new(t||e)(i.zb($e.b))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),Object(s.__decorate)([at.a.serialize],e.prototype,"getToken",null),e}(),st=function(e){function t(){return e.call(this,"not_signed_in")||this}return Object(s.__extends)(t,e),t}(it),ut=function(){function e(e){this._authClient=e,this._log=De.Log.create("BgExtensionAuthService"),this._fbAuth=Object(l.b)().auth(),this._signInDigestSuccess=new O.a}return e.prototype.onUser=function(){return Object(rt.a)(this._fbAuth)},e.prototype.onFbAuthToken=function(){return Object(rt.b)(this._fbAuth)},e.prototype.onGoogleAuthToken=function(){var e=this;return this.onFbAuthToken().pipe(Object(k.a)((function(t){return t?Object(N.a)(e._authClient.getToken()).pipe(Object($.a)((function(e){return e.token}))):Object(et.a)(null)})))},e.prototype.getAuthToken=function(e){var t=(void 0===e?{}:e).interactive,n=void 0!==t&&t;return Object(s.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return this._log.data("getAuthToken",n),"select_account"!==n?[3,4]:[4,this._openWindowFlow(!0)];case 1:return r.sent()?[4,this.onGoogleAuthToken().pipe(Object(C.a)()).toPromise()]:[3,3];case 2:e=r.sent(),r.label=3;case 3:return[3,9];case 4:return[4,this.onGoogleAuthToken().pipe(Object(C.a)()).toPromise()];case 5:return(e=r.sent())?[3,9]:(t=n)?[4,this._openWindowFlow()]:[3,7];case 6:t=r.sent(),r.label=7;case 7:return t?[4,this.onGoogleAuthToken().pipe(Object(C.a)()).toPromise()]:[3,9];case 8:e=r.sent(),r.label=9;case 9:if(!e)throw n&&this._log.error("Interactive sign-in failed or cancelled"),new st;return[2,e]}}))}))},e.prototype.signOut=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,this._fbAuth.signOut()];case 1:return e.sent(),[2]}}))}))},e.prototype.signIn=function(e){return void 0===e&&(e=!1),Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return this._log.data("signIn",e),[4,this._openWindowFlow(e)];case 1:if(!t.sent())throw new st;return[2]}}))}))},e.prototype.onIsSignedIn=function(){return this.onFbAuthToken().pipe(Object($.a)((function(e){return!!e})))},e.prototype.isSignedIn=function(){return this.onIsSignedIn().pipe(Object(C.a)()).toPromise()},e.prototype._openWindowFlow=function(e){return void 0===e&&(e=!1),Object(s.__awaiter)(this,void 0,void 0,(function(){var t,n,r;return Object(s.__generator)(this,(function(o){switch(o.label){case 0:return t=window.open(u.signInUrl+(e?"?selectAccount=1":"")),n=Object(tt.a)(200).pipe(Object(C.a)((function(){return t.closed})),Object(Ze.a)(!1)),[4,Object(nt.a)(n,this._signInDigestSuccess.pipe(Object(C.a)(),Object(Ze.a)(!0))).toPromise()];case 1:return r=o.sent(),this._log.info("windowFlow %s",r?"completed":"cancelled"),[2,r]}}))}))},e.prototype._onSignInMessage=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return e?(this._log.data("signing in"),t=f.a.auth.GoogleAuthProvider.credential(null,e),[4,this._fbAuth.signInAndRetrieveDataWithCredential(t)]):[3,2];case 1:return n=r.sent(),this._log.data("signed in %s",n.user.email,n),[3,4];case 2:return this._log.data("signing out"),[4,this._fbAuth.signOut()];case 3:r.sent(),this._log.data("signed out"),r.label=4;case 4:return this._signInDigestSuccess.next(),[2]}}))}))},e.prototype.install=function(){var e=this;chrome.runtime.onMessageExternal.addListener((function(t,n,r){if(t&&"extensionAuth:signInWithToken"===t.type)return e._onSignInMessage(t.data).then((function(){return r(!0)}),(function(){return r(!1)})),!0}))},e.prototype.e2eSignIn=function(e,t){return Object(s.__awaiter)(this,void 0,void 0,(function(){var n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:this._log.data("signing in e2e user",e),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._fbAuth.signInWithEmailAndPassword(e,t)];case 2:return r.sent(),[3,4];case 3:throw n=r.sent(),this._log.error("failed to sign in e2e user"),n;case 4:return this._log.data("signed in e2e user"),[2]}}))}))},e.\u0275fac=function(t){return new(t||e)(i.zb(ct))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),lt=n("iUUs"),dt=window.navigator,ft=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),t}(Error),pt=function(){function e(){this._hasDisplayMedia=dt.mediaDevices&&"getDisplayMedia"in dt.mediaDevices}return Object.defineProperty(e.prototype,"hasDisplayMedia",{get:function(){return this._hasDisplayMedia},enumerable:!0,configurable:!0}),e.prototype._throwWrappedPermissionError=function(e){if(this.isPermissionError(e))throw new ft;throw e},e.prototype.getUserMedia=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,navigator.mediaDevices.getUserMedia(e)];case 1:return[2,n.sent()];case 2:return t=n.sent(),this._throwWrappedPermissionError(t),[3,3];case 3:return[2]}}))}))},e.prototype.getDisplayMedia=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:if(!this._hasDisplayMedia)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,navigator.mediaDevices.getDisplayMedia(e)];case 2:return[2,n.sent()];case 3:return t=n.sent(),this._throwWrappedPermissionError(t),[3,4];case 4:return[3,6];case 5:throw new Error("getDisplayMedia() not supported, make sure chrome://flags/#enable-experimental-web-platform-features is enabled");case 6:return[2]}}))}))},e.prototype.getSources=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return dt.mediaDevices?[4,dt.mediaDevices.enumerateDevices()]:[2,[]];case 1:return[2,e.sent().filter((function(e){return e.kind.endsWith("input")})).map((function(e){return{id:e.deviceId,label:e.label,kind:e.kind.substring(0,e.kind.length-5)}}))]}}))}))},e.prototype.getSourcesByKind=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.getSources()];case 1:return[2,t.sent().filter((function(t){return t.kind===e}))]}}))}))},e.prototype.getVideoSources=function(){return this.getSourcesByKind("video")},e.prototype.getAudioSources=function(){return this.getSourcesByKind("audio")},e.prototype.hasCamera=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.getVideoSources()];case 1:return[2,e.sent().length>0]}}))}))},e.prototype.hasMicrophone=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,this.getAudioSources()];case 1:return[2,e.sent().length>0]}}))}))},e.prototype.hasLabel=function(e){return e.some((function(e){return!!e.label}))},e.prototype.hasVideoAccess=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return e=this.hasLabel,[4,this.getVideoSources()];case 1:return[2,e.apply(this,[t.sent()])]}}))}))},e.prototype.hasAudioAccess=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return e=this.hasLabel,[4,this.getAudioSources()];case 1:return[2,e.apply(this,[t.sent()])]}}))}))},e.prototype.getCameraAndMicPermission=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e,t,n,r;return Object(s.__generator)(this,(function(o){switch(o.label){case 0:return[4,this.hasCamera()];case 1:e=o.sent(),t=!1,n=!1,o.label=2;case 2:return o.trys.push([2,4,,5]),[4,navigator.mediaDevices.getUserMedia({audio:!0,video:e})];case 3:return r=o.sent(),n=!!r.getVideoTracks().length,t=!!r.getAudioTracks().length,r.getTracks().forEach((function(e){e.stop()})),[3,5];case 4:return o.sent(),[3,5];case 5:return[2,{video:n,audio:t}]}}))}))},e.prototype.checkPermission=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,navigator.permissions.query({name:e})];case 1:return[2,t.sent().state]}}))}))},e.prototype.onPermission=function(e){return Object(N.a)(navigator.permissions.query({name:e})).pipe(Object(k.a)((function(e){return Object(lt.a)(e,"change")})),Object($.a)((function(e){return e.currentTarget})))},e.prototype.isPermissionError=function(e){return e&&("PermissionDeniedError"===e.name||"MediaDeviceFailedDueToShutdown"===e.name||"NotAllowedError"===e.name||"InvalidStateError"===e.name)},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac=function(t){return new(t||e)},providedIn:"root"}),e}(),ht=De.Log.create("cf2BgMessagesService"),gt=function(){function e(e,t,n,r,o,i,a){this._connectedApps=e,this._castifyAuth=t,this._webrtcHelper=n,this._bgFiles=r,this._bgUserAccount=o,this._chromeRuntime=i,this._chromeTabs=a,this._initializationComplete=!1}return e.prototype._sendBgLoaded=function(){this._chromeRuntime.sendMessage("bg:loaded").catch((function(){return null}))},e.prototype._onMessage=function(e,t,n){return"bg:load"===e&&this._initializationComplete&&this._sendBgLoaded(),!1},e.prototype._getAppUrl=function(e){return"chrome-extension://"+this._chromeRuntime.id+"/ng/app/app.html#"+e},e.prototype._hasTabId=function(e){return!(!e.tab||!e.tab.id)},e.prototype._launchApp=function(e,t){return Object(s.__awaiter)(this,void 0,void 0,(function(){var n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:if(ht.d("handling bg:launchApp",e),!e.newTab&&!this._hasTabId(t))throw new Error("no id");return e.fileId?(n=this._getAppUrl("/files/"+e.fileId),[4,this._bgFiles.refresh(e.fileId)]):[3,3];case 1:return r.sent(),[4,Object(Ke.a)(500).pipe(Object(C.a)()).toPromise()];case 2:return r.sent(),[3,4];case 3:n=this._getAppUrl("/"),r.label=4;case 4:return e.newTab?[4,this._chromeTabs.create({url:n})]:[3,6];case 5:return r.sent(),[3,8];case 6:return[4,this._chromeTabs.update(t.tab.id,{url:n})];case 7:r.sent(),r.label=8;case 8:return[2,!0]}}))}))},e.prototype._focusWebsiteAfterInlineInstall=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return ht.d("cf2BgMessagesService: focusing website"),this._hasTabId(e)?[4,this._chromeTabs.getActiveTab()]:[2];case 1:return(t=n.sent()).id===e.tab.id?[3,3]:[4,this._chromeTabs.remove(t.id)];case 2:n.sent(),n.label=3;case 3:return[4,this._chromeTabs.update(e.tab.id,{active:!0})];case 4:return n.sent(),[2]}}))}))},e.prototype._requestToType=function(e){return e&&e.type?e.type:e},e.prototype._onMessageExternal=function(e,t,n){var r;switch(this._requestToType(e)){case"bg:launchApp":r=this._launchApp(e.data||{},t);break;case"bg:launchSupport":r=this._chromeTabs.create({url:this._getAppUrl("/support")});break;case"bg:focusWebsite":r=this._focusWebsiteAfterInlineInstall(t);break;case"bg:getSignInToken":r=this._castifyAuth.getAuthToken({interactive:!0});break;case"bg:updateLicense":r=this._bgUserAccount.update();break;case"bg:isInstalled":n(this._chromeRuntime.getManifest().version);break;case"bg:connectApp":r=this._connectedApps.connect(e.data).then((function(){return!0}));break;case"bg:getLicenseInfo":r=this._getLicenseInfo();break;case"bg:hasPermissions":r=this._checkPermissions();break;case"bg:openPermissions":this._openPermissionsPage(t)}return!!r&&(r.catch((function(){return!1})).then(n),!0)},e.prototype._getLicenseInfo=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,this._bgUserAccount.getAccount()];case 1:return e=n.sent(),t={isPaid:e.license.isPaid,isTester:e.license.isTester,license:e.license,user:e.user},e.user&&(t.email=e.user.email,t.analyticsUid=e.user.analyticsUid),[2,t]}}))}))},e.prototype.install=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e=this;return Object(s.__generator)(this,(function(t){return this._chromeRuntime.onMessage.addListener((function(t,n,r){return e._onMessage(t,n,r)})),this._chromeRuntime.onMessageExternal.addListener((function(t,n,r){return e._onMessageExternal(t,n,r)})),[2]}))}))},e.prototype.initializationCompleted=function(){this._initializationComplete=!0,this._sendBgLoaded()},e.prototype._checkPermissions=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,Promise.all([this._webrtcHelper.checkPermission("microphone"),this._webrtcHelper.checkPermission("camera")])];case 1:return e=s.__read.apply(void 0,[n.sent(),2]),t=e[1],[2,"prompt"!==e[0]&&"prompt"!==t]}}))}))},e.prototype._openPermissionsPage=function(e){var t=this._getAppUrl("/permissions");this._chromeTabs.update(e.tab.id,{url:t})},e.\u0275fac=function(t){return new(t||e)(i.zb(Xe),i.zb(ut),i.zb(pt),i.zb(Ae),i.zb(je),i.zb(Ee),i.zb(Oe))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}();a.module("cf2.cf2BgMessagesServiceService",[]);var mt=n("AqJ0"),bt=n("z5yO"),vt=function(){function e(e){this._userAccount=e,this.license={},this._init()}return e.prototype.getRecordingTimeLimit=function(){return this.license.limitLength?this.license.maxLength:0},e.prototype._init=function(){var e=this;this._account$=this._userAccount.onAccount().pipe(Object(mt.a)(1)),this._account$.subscribe((function(t){e.license=t.license})),this.onIsPaid().subscribe((function(t){return e.isPaid=t})),this.onIsSignedIn().subscribe((function(t){return e.isSignedIn=t}))},e.prototype.onRecordingTimeLimit=function(){return this._account$.pipe(Object(bt.a)((function(e){return e.license&&e.license.limitLength})),Object($.a)((function(e){return e.license.maxLength})))},e.prototype.onIsPaid=function(){return this._account$.pipe(Object($.a)((function(e){return e.license.isPaid})))},e.prototype.onIsSignedIn=function(){return this._account$.pipe(Object($.a)((function(e){return!!e.user})))},e.prototype._onUser=function(){return this._account$.pipe(Object(bt.a)((function(e){return!!e.user})),Object($.a)((function(e){return e.user})))},e.prototype.onIsStudent=function(){return this._onUser().pipe(Object($.a)((function(e){return e.survey&&"student"===e.survey.user_type})))},e.prototype.onIsEducator=function(){return this._onUser().pipe(Object($.a)((function(e){return e.survey&&["educator","teacher","k12Admin"].includes(e.survey.user_type)})))},e.prototype.signIn=function(){return this._userAccount.signIn()},e.prototype.openBuy=function(e,t){window.open("https://www.screencastify.com/buy?utm_source=app&utm_source=app&utm_campaign="+e+"\n      "+(t?"&utm_content="+t:""),"_blank")},e.\u0275fac=function(t){return new(t||e)(i.zb(pe))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac}),e}();a.module("cf2.upgradeHelperService",[]).factory("cf2UpgradeHelperService",Object(ee.b)(vt));var yt=function(){function e(e){if(e)throw new Error("UpgradeHelperModule is already loaded.")}return e.\u0275mod=i.vb({type:e}),e.\u0275inj=i.ub({factory:function(t){return new(t||e)(i.zb(e,12))},providers:[vt],imports:[[Z.a]]}),e}(),wt=function(){function e(e,t,n){this._chromeRuntime=e,this._chromeTabs=t,this._chromeWindows=n}return e.prototype._pathToUrl=function(e){return e.startsWith("#")?"chrome-extension://"+this._chromeRuntime.id+"/ng/app/app.html"+e:e},e.prototype.create=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(s.__generator)(this,(function(r){switch(r.label){case 0:return t=this._pathToUrl(e),[4,this._chromeTabs.create({active:!0,url:t})];case 1:return n=r.sent(),[4,this._chromeWindows.update(n.windowId,{focused:!0})];case 2:return r.sent(),[2]}}))}))},e.\u0275fac=function(t){return new(t||e)(i.zb(Ee),i.zb(Oe),i.zb(Ie))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}();a.module("cf2.inAppTabService",[]);var _t=n("LR82");function St(e,t,n){var r,o,i;void 0===n&&(n=!0),n=!1!==n;var a=function(){i=Object.assign([],arguments),o=function(){return r=null,o=null,e.apply(null,i)},n?(r&&window.clearTimeout(r),r=window.setTimeout(o,t)):r||(r=window.setTimeout(o,t))};return a.flush=function(){r&&(window.clearTimeout(r),o())},a.cancel=function(){r&&window.clearTimeout(r)},a}var Et=n("3sQE"),It=function(){function e(){this._started=!1,this._loadedPromise=null,this.STORE_MSG_TYPE="castifyDrawStore"}return e.prototype._load=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return this._loadedPromise=(n="cfDraw_store",r={},new Promise((function(e,t){chrome.storage.local.get(n,(function(o){if(chrome.runtime.lastError)return t(chrome.runtime.lastError);e(o.hasOwnProperty(n)?o[n]:r)}))}))),e=this,[4,this._loadedPromise];case 1:return e._data=t.sent(),[2]}var n,r}))}))},e.prototype._save=function(){var e;e=this._data,new Promise((function(t,n){var r;chrome.storage.local.set(((r={}).cfDraw_store=e,r),(function(){if(chrome.runtime.lastError)return n(chrome.runtime.lastError);t()}))}))},e.prototype._onMessage=function(e){e&&"castifyDrawStore"===e.type&&(this._data=e.data,this._save())},e.prototype.getData=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,this._loadedPromise];case 1:return e.sent(),[2,this._data]}}))}))},e.prototype.start=function(){if(this._started)throw new Error("bg-storage-service already started");this._started=!0,this._load()},e.prototype.stop=function(){this._started&&(this._started=!1)},e.prototype.handleMessage=function(e){this._started&&this._onMessage(e)},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac=function(t){return new(t||e)},providedIn:"root"}),e}(),Ot=window.crypto;function Ct(e){return Ot.subtle.exportKey("jwk",e)}var jt=function(){function e(){this._keyPromise=Ot.subtle.generateKey({name:"AES-GCM",length:256},!0,["encrypt","decrypt"]).then(Ct),this._started=!1,this._onMessageBound=this._onMessage.bind(this)}return e.prototype._onMessage=function(e,t,n){if(!e)return!1;if("castifyDrawGetMsgKey"===e.type){if(function(e){return e.tab.url.startsWith("https://")}(t))return this._keyPromise.then((function(e){return n(e)}),(function(){return n(null)})),!0;n("plain")}else if("castifyDrawFrameBroadcast"===e.type&&t.tab)chrome.tabs.sendMessage(t.tab.id,e.data);else if("castifyDrawFrameBroadcastWithResult"===e.type&&t.tab)return chrome.tabs.sendMessage(t.tab.id,e.data,(function(e){n(e)})),!0;return!1},e.prototype.start=function(){this._started||(chrome.runtime.onMessage.addListener(this._onMessageBound),this._started=!0)},e.prototype.stop=function(){this._started&&(this._started=!1,chrome.runtime.onMessage.removeListener(this._onMessageBound))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac=function(t){return new(t||e)},providedIn:"root"}),e}();function At(e){return e instanceof Error?Promise.reject(e.toString()):Promise.reject(e)}var Tt=function(){function e(e){var t=this;this.webrtc=e,this._started=!1,this._onMessageBound=this._onMessage.bind(this),this._throttledStop=St((function(){return t._disposeStream()}),1e3),this.msgHandlers={start:function(e){return Object(s.__awaiter)(t,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:if(this._throttledStop.cancel(),this._stream){if(JSON.stringify(this._streamConstraints)===JSON.stringify(e))return[2];this._disposeStream()}return t=this,[4,this.getStream(e)];case 1:return t._stream=n.sent(),this._streamConstraints=e,[2]}}))}))},stop:function(){t._throttledStop()}}}return e.prototype._disposeStream=function(){this._throttledStop.cancel(),this._stream&&(this._stream.getTracks().forEach((function(e){e.stop()})),this._stream=null,this._streamConstraints=null)},e.prototype.getStream=function(e){return this.webrtc.getUserMedia({video:e})},e.prototype._onMessage=function(e,t,n){return!!(e&&"castifyDrawCamSustainMsg"===e.type&&(e=e.data)&&this.msgHandlers.hasOwnProperty(e.type))&&(function(e,t){Promise.resolve(t).catch(At).then((function(t){e({type:"result",data:t})}),(function(t){e({type:"error",data:t})}))}(n,this.msgHandlers[e.type](e.data)),!0)},e.prototype.start=function(){this._started||(chrome.runtime.onMessage.addListener(this._onMessageBound),this._started=!0)},e.prototype.stop=function(){this._started&&(this._started=!1,this._disposeStream(),chrome.runtime.onMessage.removeListener(this._onMessageBound))},e.\u0275fac=function(t){return new(t||e)(i.zb(pt))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}();function xt(e,t){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new Promise((function(r,o){n.push((function(e){chrome.runtime.lastError?o(chrome.runtime.lastError):r(e)})),e.apply(t,n)}))}}var Pt={executeScript:xt(chrome.tabs.executeScript,chrome.tabs),insertCSS:xt(chrome.tabs.insertCSS,chrome.tabs),connect:chrome.tabs.connect.bind(chrome.tabs)},Rt=function(){function e(e,t,n){this._storageService=e,this._messageService=t,this._camSustainService=n,this._servicesStarted=!1,this._tabBgServices=new Map,this._bundlesPath="",this._cssPath="content-script/assets/fonts/fonts.css",this._log=De.Log.create("BgCastifyDrawService")}return e.prototype.isActiveTabInjected=function(){return Array.from(this._tabBgServices.values()).some((function(e){return e.tabActive&&e.successfulInjection}))},e.prototype._startServicesIfNotStarted=function(){this._servicesStarted||(this._servicesStarted=!0,this._messageService.start(),this._storageService.start(),this._camSustainService.start())},e.prototype._onMessageListener=function(e,t){var n,r,o=function(){return null};if(t&&t.type===this._storageService.STORE_MSG_TYPE){this._storageService.handleMessage(t);try{for(var i=Object(s.__values)(this._tabBgServices.entries()),a=i.next();!a.done;a=i.next()){var c=Object(s.__read)(a.value,2);c[0]!==e&&c[1].sendMessage(t).catch(o)}}catch(u){n={error:u}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}},e.prototype.loadInTab=function(e,t){return Object(s.__awaiter)(this,void 0,void 0,(function(){var n,r=this;return Object(s.__generator)(this,(function(o){switch(o.label){case 0:return this._log.d("loadInTab",e,t),this._startServicesIfNotStarted(),this._tabBgServices.get(e)?[2]:((n=new kt(this._storageService,e,this._bundlesPath,this._cssPath)).setOnMessageListener((function(t){return r._onMessageListener(e,t)})),this._tabBgServices.set(e,n),[4,Object(N.a)(n.initialize(t)).pipe(Object(Et.a)(1e4,Object(ie.a)(new Error("failed to init castify-draw within timeout")))).toPromise()]);case 1:return o.sent(),[2]}}))}))},e.prototype.disposeInTab=function(e){var t=this._tabBgServices.get(e);t&&(t.dispose(),this._tabBgServices.delete(e),this._tabBgServices.size||this._stopServices())},e.prototype.disposeAll=function(){var e,t;try{for(var n=Object(s.__values)(this._tabBgServices.values()),r=n.next();!r.done;r=n.next())r.value.dispose()}catch(o){e={error:o}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this._tabBgServices.clear(),this._stopServices()},e.prototype._stopServices=function(){this._servicesStarted=!1,this._camSustainService.stop(),this._messageService.stop(),this._storageService.stop()},e.\u0275fac=function(t){return new(t||e)(i.zb(It),i.zb(jt),i.zb(Tt))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),kt=function(){function e(e,t,n,r){var o=this;this._storage=e,this.tabId=t,this._cssPath=r,this.msgHandlers={},this.onMessageListener=null,this.tabActive=!0,this.successfulInjection=!1,this._subscription=new _t.a,this._log=De.Log.create("BgCastifyDrawTabService "),this.throttledLoadFrame=St((function(){o._loadContentScript(!1).catch((function(){return null}))}),1e3),this._jsPath=n+"content-script.js",this._jsPathFrame=n+"content-script-frame.js",this.init()}return e.prototype._loadContentScript=function(e){var t=this,n=[Pt.executeScript(this.tabId,{file:e?this._jsPath:this._jsPathFrame,allFrames:!0,matchAboutBlank:!0,runAt:"document_start"})];return e&&n.push(Pt.insertCSS(this.tabId,{file:this._cssPath,allFrames:!0,matchAboutBlank:!0,runAt:"document_start"})),Promise.all(n).catch((function(e){return t._log.error(e),Promise.reject(new Error("injecting castify-draw failed"))}))},e.prototype._loadAndConnect=function(){var e=this;if(!this.portPromise){var t=this._loadContentScript(!0).then((function(){var n=Pt.connect(e.tabId,{name:"castifyDraw"});return n.onDisconnect.addListener((function(){e.portPromise===t&&(e.portPromise=null)})),n.onMessage.addListener((function(t){e.msgHandlers.hasOwnProperty(t.type)?e.msgHandlers[t.type](n,t.data):e.onMessageListener&&e.onMessageListener(t)})),e.port=n,e.successfulInjection=!0,n}));t.catch((function(t){e._log.info("BgCastifyDrawServiceError",t)})),this.portPromise=t}return this.portPromise},e.prototype.initTopFrame=function(){var e=this;this._disconnect(),this.postInitialize(this.initConfig).catch((function(){return e._logLoadError()}))},e.prototype.postInitialize=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t,n,r=this;return Object(s.__generator)(this,(function(o){switch(o.label){case 0:return t=new Promise((function(e){r.msgHandlers.initializeDone=function(){r.msgHandlers.initializeDone=null,e()}})),[4,this._loadAndConnect()];case 1:return o.sent(),[4,this._storage.getData()];case 2:return n=o.sent(),this.postMessage("initialize",{config:e,storage:n,chromeCommands:this._chromeCommands}),[4,t];case 3:return o.sent(),this.msgHandlers.initializeDone=null,this.initConfig=void 0,[2]}}))}))},e.prototype.onCommitted=function(e){e.tabId===this.tabId&&(0===e.frameId?(this.throttledLoadFrame.cancel(),this.initTopFrame()):this.throttledLoadFrame())},e.prototype._logLoadError=function(){this._log.warn("could not load castify-draw in tab",this.tabId)},e.prototype.onTabReplaced=function(e){e.replacedTabId===this.tabId&&(this.tabId=e.tabId,this.initTopFrame())},e.prototype.onTabSwitch=function(e){this.updateTabFocused(e.tabId)},e.prototype.onWindowSwitch=function(){var e=this;chrome.tabs.query({active:!0,windowId:chrome.windows.WINDOW_ID_CURRENT},(function(t){e.updateTabFocused(t.length?t[0].id:-1)}))},e.prototype.updateTabFocused=function(e){var t=this;e===this.tabId?(this.tabActive=!0,this.postMessage("updateTabFocused",this.tabActive).catch((function(){return t._logLoadError()}))):this.tabActive&&(this.tabActive=!1,this.postMessage("updateTabFocused",this.tabActive).catch((function(){return t._logLoadError()})))},e.prototype.init=function(){var e,t,n=this;this._loadAndConnect().catch((function(){return null}));var r=[re(chrome.webNavigation.onCommitted).subscribe((function(e){var t=Object(s.__read)(e,1);return n.onCommitted(t[0])})),re(chrome.webNavigation.onTabReplaced).subscribe((function(e){var t=Object(s.__read)(e,1);return n.onTabReplaced(t[0])})),re(chrome.tabs.onActivated).subscribe((function(e){var t=Object(s.__read)(e,1);return n.onTabSwitch(t[0])})),re(chrome.windows.onFocusChanged).subscribe((function(){return n.onWindowSwitch()}))];try{for(var o=Object(s.__values)(r),i=o.next();!i.done;i=o.next())this._subscription.add(i.value)}catch(a){e={error:a}}finally{try{i&&!i.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}},e.prototype.postMessage=function(e,t){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return[4,this._loadAndConnect()];case 1:return n.sent().postMessage({type:e,data:t}),[2]}}))}))},e.prototype.initialize=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return this.initConfig=e,this._chromeCommands=e.chromeCommands,[4,this.postInitialize(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.setOnMessageListener=function(e){this.onMessageListener=e},e.prototype.sendMessage=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){return[2,this.postMessage(e.type,e.data)]}))}))},e.prototype._disconnect=function(){this.portPromise&&(this.portPromise.then((function(e){return e.disconnect()}),(function(){return null})),this.portPromise=null)},e.prototype.dispose=function(){this._disconnect(),this._subscription.unsubscribe()},e}(),Dt=function(){return function(){}}(),$t=function(){return function(){}}(),Ft=function(){function e(e,t){this._injector=e,this._authUrls=t}return e.prototype._ensureHaveAuth=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){if(!this._auth&&(this._auth=this._injector.get(Dt),!this._auth))throw new Error("No BearerProvider configured");return[2]}))}))},e.prototype.intercept=function(e,t){var n;return e.headers.has("auth")?("fb"!==(n=e.headers.get("auth"))&&"google"!==n&&(n=!1),e=e.clone({headers:e.headers.delete("auth")})):n=this._authUrls.shouldAuthenticate(e),n?(this._ensureHaveAuth(),("fb"===n?this._auth.onFbAuthToken():this._auth.onGoogleAuthToken()).pipe(Object(U.a)((function(t){if(null===t)throw new Error("Tried to access url '"+e.urlWithParams+"' while not signed in")})),Object(C.a)(),Object(k.a)((function(n){return e=e.clone({setHeaders:{Authorization:"Bearer "+n}}),t.handle(e)})))):t.handle(e)},e.\u0275fac=function(t){return new(t||e)(i.zb(i.n),i.zb($t))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac}),e}(),Ut=function(){function e(e){this._http=e,this._exportEndpointUrl=u.extensionServiceUrl+"/exports",this._editServiceUrl=u.extensionServiceUrl+"/trims"}return e.prototype.exportAudio=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){return[2,this._http.post(this._exportEndpointUrl+"/audioExport",e).toPromise()]}))}))},e.prototype.trim=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){return[2,this._http.post(this._editServiceUrl+"/trim",e).toPromise()]}))}))},e.prototype.exportVideo=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){return[2,this._http.post(this._exportEndpointUrl+"/videoExport",e,{}).toPromise()]}))}))},e.\u0275fac=function(t){return new(t||e)(i.zb($e.b))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),Lt=n("pday"),Mt=n("2t7I"),Nt=n("gPBt"),Bt=function(){function e(e){this._http=e}return e.prototype.postLogs=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._http.post(u.logServiceUrl+"/log",e).toPromise()];case 1:return t.sent(),[2]}}))}))},e.\u0275fac=function(t){return new(t||e)(i.zb($e.b))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),qt=["debug","error","info","log","warn"],zt=function(e){return e.EXTENSION_APP="EXTENSION_APP",e.EXTENSION_POPUP="EXTENSION_POPUP",e.EXTENSION_BACKGROUND="EXTENSION_BACKGROUND",e}({}),Ht=function(){return function(){}}(),Wt=function(){function e(e,t){this._adapter=e,this._stackdriverLoggerClient=t,this._logs=[],this._maxLinesPerRequest=1e4,this._origConsole={}}return e.prototype._installBatcher=function(){var e=this;this._subscription=Object(et.a)(null).pipe(Object(bt.a)((function(){return e._adapter.enableStreaming})),Object(bt.a)((function(){return e._logs.length>0})),Object(k.a)((function(){return e._flush()})),Object(Nt.a)({initialInterval:5e3,maxInterval:12e4}),Object(Lt.a)(5e3),Object(Mt.a)()).subscribe((function(){return null}))},e.prototype._patchConsole=function(){var e,t,n=this,r=function(e){var t=console[e];o._origConsole[e]=t,console[e]=function(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];t.apply(void 0,Object(s.__spread)(r)),n._addLog(e,r)}},o=this;try{for(var i=Object(s.__values)(qt),a=i.next();!a.done;a=i.next())r(a.value)}catch(c){e={error:c}}finally{try{a&&!a.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}},e.prototype.install=function(e){this._metadata=e,this._patchConsole(),this._installBatcher()},e.prototype.uninstall=function(){var e,t;this._subscription.unsubscribe();try{for(var n=Object(s.__values)(qt),r=n.next();!r.done;r=n.next()){var o=r.value;console[o]=this._origConsole[o]}}catch(i){e={error:i}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype._stripColorizer=function(e){if("string"==typeof e[0]&&e[0].startsWith("%c")){var t=Object(s.__spread)(e);return t[0]=t[0].replace(/%c /gi,""),t.splice(1,2),t}return e},e.prototype._addLog=function(e,t){this._logs.push({level:e,params:this._stripColorizer(t),timestamp:Date.now()})},e.prototype._buildPayload=function(e){return{logs:e,metadata:Object(s.__assign)({userAgent:navigator.userAgent},this._metadata)}},e.prototype._flush=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return this._logs.length?(e=Object(s.__spread)(this._logs.slice(0,this._maxLinesPerRequest)),t=this._buildPayload(e),[4,this._stackdriverLoggerClient.postLogs(t)]):[2];case 1:return n.sent(),this._shiftLogs(e.length),[2]}}))}))},e.prototype._shiftLogs=function(e){this._logs.splice(0,e)},e.\u0275fac=function(t){return new(t||e)(i.zb(Ht),i.zb(Bt))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),Object(s.__decorate)([at.a.serialize],e.prototype,"_flush",null),e}(),Vt=["no_youtube_channel","youtubeCredentialsMissing","quotaExceeded","no_google_drive_access","load_nacl","disk_space","drive_apps","forbidden","start_recording","change_account","youtubeSignupRequired","no_audio","no_cam","no_audio_access","drawing_tools_unavailable","blocked_permissions","tab_permissions","blocked_permissions_macos","stuck_signing_in"],Gt=function(){function e(e,t){this._analytics=e,this._inAppTab=t,this._log=De.Log.create("SupportArticlesService"),this._helpArticleTags=Vt,this._url="https://screencastify.zendesk.com/hc/en-us/",this._zendeskArticleDictionary={no_youtube_channel:this._url+"articles/360049230774-Set-Up-a-YouTube-Channel",youtubeCredentialsMissing:this._url+"articles/360049997513-I-received-a-youtubeAuth-failed-or-youtubeCredentialsMissing-error",quotaExceeded:this._url+"articles/360049230574-I-m-out-of-space-on-Google-Drive",no_google_drive_access:this._url+"articles/360049997313-I-m-forbidden-from-uploading-to-Google-Drive",load_nacl:this._url+"articles/360049995333-I-received-a-Failed-to-load-NaCL-module-error",disk_space:this._url+"articles/360049990913-I-received-a-Low-Disk-Space-notification",drive_apps:this._url+"articles/360049997313-I-m-forbidden-from-uploading-to-Google-Drive",forbidden:this._url+"articles/360049997313-I-m-forbidden-from-uploading-to-Google-Drive",start_recording:this._url+"articles/360049229374-Screencastify-failed-to-start-recording",change_account:this._url+"articles/360049986053-How-can-I-sign-in-with-a-different-account",youtubeSignupRequired:this._url+"articles/360049230774-Set-Up-a-YouTube-Channel",no_audio:this._url+"articles/360049996613-Screencastify-failed-to-capture-audio",no_cam:this._url+"articles/360049995153-My-webcam-is-not-detected",no_audio_access:this._url+"articles/360049996613-Screencastify-failed-to-capture-audio",drawing_tools_unavailable:this._url+"articles/360049225874-Drawing-tools-are-unavailable",blocked_permissions:this._url+"articles/360049991593-I-accidentally-blocked-Screencastify-from-accessing-my-webcam-and-microphone",tab_permissions:"https://learn.screencastify.com/hc/en-us/articles/360049156994-Why-do-you-ask-for-Chrome-permissions-",blocked_permissions_macos:"https://learn.screencastify.com/hc/en-us/articles/360049995693-Failed-to-Start-Recording-on-MacOS-Catalina",stuck_signing_in:"https://learn.screencastify.com/hc/en-us/articles/360049997853-I-get-stuck-when-signing-in-to-my-account"}}return e.prototype.openArticle=function(e){this._analytics.trackEvent("help articles",e),this._zendeskArticleDictionary[e]?this._inAppTab.create(this._zendeskArticleDictionary[e]):(this._log.error("tag '"+e+"' doesn't exist on the dictionary"),this._inAppTab.create(this._url+"search?query="+encodeURIComponent(e)))},e.prototype.setNotifyHelp=function(e,t){var n=this;e.onButtonClicked=e.onClicked=function(){n.openArticle(t),e.clear()}},e.\u0275fac=function(t){return new(t||e)(i.zb(we),i.zb(wt))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}();a.module("cf2.supportArticlesService",[]);var Jt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(s.__extends)(t,e),t.prototype.shouldAuthenticate=function(e){return e.url.startsWith(u.extensionServiceUrl)?"fb":!!e.url.startsWith(u.logServiceUrl)&&"google"},t}($t),Yt=n("3riI"),Qt=function(){function e(e,t){var n=this;this._userAccount=e,this._onlineState=t,this.enableStreaming=!1,Object(Yt.a)([this._userAccount.onAccount(),this._onlineState.onIsOnline()]).pipe(Object($.a)((function(e){var t=Object(s.__read)(e,2),n=t[0];return n&&!!n.user&&t[1]}))).subscribe((function(e){n.enableStreaming=e}))}return e.\u0275fac=function(t){return new(t||e)(i.zb(pe),i.zb(Ce))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),Kt=function(){function e(e,t){this._track=e,this._timeFn=t,this._audioCtx=new AudioContext({latencyHint:"playback"}),this._log=De.Log.create("AudioThresholdDetector"),this._frequencyData=new Uint8Array(16),this._volumeThreshold=.08,this._volumeSamplingRate=100,this._durationThreshold=.3,this._nonSilenceStartTime=-1,this._firstNonSilence=-1,this._lastNonSilence=-1}return e.prototype.start=function(){var e=new MediaStream;e.addTrack(this._track),this._input=this._audioCtx.createMediaStreamSource(e),this._analyser=this._audioCtx.createAnalyser(),this._analyser.smoothingTimeConstant=.5,this._analyser.fftSize=32,this._analyser.minDecibels=-70,this._analyser.maxDecibels=-10,this._input.connect(this._analyser),this._scheduleSampling()},e.prototype._scheduleSampling=function(){var e=this;setTimeout((function(){return e._onSamples()}),this._volumeSamplingRate)},e.prototype._onSamples=function(){if(this._analyser){var e=this._timeFn();if(e<0)this._scheduleSampling();else{if(this._frequencyData.length!==this._analyser.frequencyBinCount)throw new Error("unexpected frequency bin count: "+this._analyser.frequencyBinCount);this._analyser.getByteFrequencyData(this._frequencyData);var t=this._frequencyData.reduce((function(e,t){return e+t}))/this._frequencyData.length/255;this._nonSilenceStartTime<0?t>=this._volumeThreshold&&(this._nonSilenceStartTime=e):t<this._volumeThreshold&&(this._onNonSilentSegment(this._nonSilenceStartTime,e),this._nonSilenceStartTime=-1),this._scheduleSampling()}}},e.prototype._onNonSilentSegment=function(e,t){t-e<this._durationThreshold||(this._log.d("non-silent segment detected [%d, %d]",e,t),this._firstNonSilence<0&&(this._firstNonSilence=e),this._lastNonSilence=t)},e.prototype.getTrimInterval=function(){return this._firstNonSilence<=0?null:{startTime:Math.max(0,this._firstNonSilence-.1),endTime:this._lastNonSilence}},e.prototype.dispose=function(){this._audioCtx&&(this._input.disconnect(),this._analyser.disconnect(),this._audioCtx.close(),this._audioCtx=null,this._input=null,this._analyser=null)},e}(),Xt=function(){function e(e,t){var n=this;this._bgFiles=e,this._rootScope=t,this._log=De.Log.create("SpeechDetectionService"),P(this._rootScope,"bgFiles:localFileCreated").subscribe((function(e){var t=Object(s.__read)(e,2);return n._recordingDone(t[1])}))}return e.prototype._recordingDone=function(e){if(e===this._fileId){var t=this._detector.getTrimInterval();t&&(this._log.d("updating localInfo with trimHint",t),this._bgFiles.updateLocalInfo(this._fileId,{trimHint:t})),this._fileId=null,this._detector=null}},e.prototype.startDetecting=function(e,t,n){var r=new Kt(e,t);return r.start(),this._detector=r,this._fileId=n,r},e.prototype.stopDetecting=function(){this._detector&&this._detector.dispose()},e.\u0275fac=function(t){return new(t||e)(i.zb(Ae),i.zb(xe))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),Zt=n("wIp5"),en=n.n(Zt),tn=["gmail.com","googlemail.com","hotmail.com","yahoo.com"],nn=["screencastify.com"],rn=function(){function e(){}return e.prototype.generate=function(e){var t=e.split("@")[1];if(nn.includes(t))return 0;var n=tn.includes(t)?e:t,r=en.a.MD5(n).toString();return parseInt(r.slice(0,2),16)/256},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac=function(t){return new(t||e)},providedIn:"root"}),e}(),on=function(){function e(e,t,n,r){this._appOptions=e,this._chromeRuntime=t,this._bgUserAccount=n,this._domainRandom=r,this._log=De.Log.create("FeatureRolloutService")}return e.prototype._updateRolloutOptions=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t,n,r,o,i,a,c,u,l,d,f;return Object(s.__generator)(this,(function(p){switch(p.label){case 0:return[4,this._appOptions.loadedPromise];case 1:return p.sent(),n=(t=e&&e.user||null)&&t.email?this._domainRandom.generate(t.email):.9999,[4,j.get()];case 2:r=p.sent()||{},o={};try{for(i=Object(s.__values)(Object.entries(r)),a=i.next();!a.done;a=i.next())c=Object(s.__read)(a.value,2),l="number"==typeof(u=c[1])?u:u.percentage,o[c[0]]=this._hasMinimumVersion(u)&&n<l}catch(h){d={error:h}}finally{try{a&&!a.done&&(f=i.return)&&f.call(i)}finally{if(d)throw d.error}}return o.hwEncoding=o.hwEncoding||window.navigator.userAgent.indexOf("CrOS")>=0,this._log.d("Feature rollout config is",o),this._appOptions.setRolloutValues(o),[2]}}))}))},e.prototype._hasMinimumVersion=function(e){if("number"==typeof e)return!0;var t=this._chromeRuntime.getManifest().version;return T.isLessOrEqual(e.minVersion,t)},e.prototype.install=function(){var e=this;this._bgUserAccount.onAccount().subscribe((function(t){return e._updateRolloutOptions(t)}))},e.\u0275fac=function(t){return new(t||e)(i.zb(Se),i.zb(Ee),i.zb(je),i.zb(rn))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),an=function(){function e(e){this._http=e,this._endpoint=u.dashboardServiceUrl+"/onboarding",this._authConfig={headers:{auth:"google"}}}return e.prototype.completeUserOnboarding=function(e){return this._http.post(this._endpoint,{product:e},this._authConfig).toPromise()},e.prototype.fetchUserOnboarding=function(){return this._http.get(this._endpoint,this._authConfig).toPromise()},e.\u0275fac=function(t){return new(t||e)(i.zb($e.b))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),cn={extensionAuth:ut,onboarding:function(){function e(e){this._onboardingClient=e,this.loadedPromise=this._loadUserOnboarding()}return e.prototype.getOnboardingStatus=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return[4,this._getUserOnboarding()];case 1:return[2,t.sent()[e]]}}))}))},e.prototype.completeOnboarding=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t;return Object(s.__generator)(this,(function(n){switch(n.label){case 0:return t=this,[4,this._onboardingClient.completeUserOnboarding(e)];case 1:return t._cachedOnboarding=n.sent(),[2]}}))}))},e.prototype._getUserOnboarding=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:return this._cachedOnboarding?[3,2]:(e=this,[4,this._onboardingClient.fetchUserOnboarding()]);case 1:e._cachedOnboarding=t.sent(),t.label=2;case 2:return[2,this._cachedOnboarding]}}))}))},e.prototype._loadUserOnboarding=function(){return Object(s.__awaiter)(this,void 0,void 0,(function(){return Object(s.__generator)(this,(function(e){switch(e.label){case 0:return[4,this._getUserOnboarding()];case 1:return e.sent(),[2]}}))}))},e.\u0275fac=function(t){return new(t||e)(i.zb(an))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},sn=function(e){function t(t){return e.call(this,"Servify usage error: "+t)||this}return Object(s.__extends)(t,e),t}(Error),un=function(){function e(e,t){this._service=t,this._ports=new Map,this._clientSubscriptions=new Map,this._portName="servify_"+e,this._log=De.Log.create("ServifyPublisher:"+e)}return e.prototype.publish=function(){var e=this;if(this._log.data("publishing service"),this._subscription)throw new Error;this._subscription=re(chrome.runtime.onConnect).subscribe((function(t){var n=Object(s.__read)(t,1);return e._onConnect(n[0])}))},e.prototype._onConnect=function(e){var t=this;e.name===this._portName&&(this._log.data("New connection from",e.sender),this._ports.set(e,new le((function(n){t._ports.has(e)&&e.postMessage(n)}))),this._clientSubscriptions.set(e,new _t.a),re(e.onMessage).subscribe((function(e){var n=Object(s.__read)(e,2);return t._onMessage(n[0],n[1])})),re(e.onDisconnect).subscribe((function(){t._log.data("Disconnected from",e.sender),t._ports.delete(e),t._clientSubscriptions.get(e).unsubscribe()})))},e.prototype._handleMessage=function(e){return Object(s.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(s.__generator)(this,(function(r){if(this._log.data("handling message",e),e.type in this._service){if(!(t=(n=this._service)[e.type].apply(n,Object(s.__spread)(e.data))))throw new sn("Invalid return type");if(e.type.startsWith("_"))throw new sn(e.type+"is considered private");if(e.type.startsWith("on")){if(!Object(ae.a)(t))throw this._log.error("Service returned invalid return type",e.type),new sn(e.type+" must return Observable")}else if(!t.then)throw this._log.error("Service returned invalid return type",e.type),new sn(e.type+" must return Promise");return[2,t]}throw new sn("service does not implement "+e.type)}))}))},e.prototype._onMessage=function(e,t){var n=this._ports.get(t);if(!n.handleMessage(e)){var r=this._handleMessage(e);n.respond(r,e)}},e.prototype.dispose=function(){this._subscription.unsubscribe()},e}(),ln=function(){function e(e){this._injector=e}return e.prototype.publish=function(e,t){new un(e,t).publish()},e.prototype.publishAll=function(){var e,t;try{for(var n=Object(s.__values)(Object.entries(cn)),r=n.next();!r.done;r=n.next()){var o=Object(s.__read)(r.value,2);this.publish(o[0],this._injector.get(o[1]))}}catch(i){e={error:i}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.\u0275fac=function(t){return new(t||e)(i.zb(i.n))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),dn=function(){function e(e,t,n,r,o){this._featureRollout=e,this._bgUserAccount=t,this._servify=n,this._extensionAuth=r,this._stackdriverLogger=o}return e.prototype.install=function(){this._featureRollout.install(),this._servify.publish("userAccount",this._bgUserAccount),this._servify.publishAll(),this._extensionAuth.install(),this._stackdriverLogger.install({appName:zt.EXTENSION_BACKGROUND,buildId:chrome.runtime.getManifest().version_name})},e.\u0275fac=function(t){return new(t||e)(i.zb(on),i.zb(je),i.zb(ln),i.zb(ut),i.zb(Wt))},e.\u0275prov=i.tb({token:e,factory:e.\u0275fac,providedIn:"root"}),e}(),fn=function(){function e(e){this.upgrade=e}return e.prototype.ngDoBootstrap=function(){var e=document.createElement("div");document.body.appendChild(e),this.upgrade.bootstrap(e,["castifyExt.bgApp"],{strictDi:!1})},e.\u0275mod=i.vb({type:e}),e.\u0275inj=i.ub({factory:function(t){return new(t||e)(i.zb(ee.a))},providers:[{provide:pe,useExisting:je},{provide:$t,useClass:Jt},{provide:$e.a,useClass:Ft,multi:!0},{provide:Dt,useClass:ut},{provide:Ht,useClass:Qt}],imports:[[Z.a,ee.a,te.a,Ve,Qe,yt,$e.c]]}),e}();a.module("castifyExt.castifyAuth",[]).factory("castifyAuth",Object(ee.b)(ut)).factory("googleauth",["castifyAuth","$q",function(e,t){return{loadClient:function(){return t.when()},getAuthToken:function(t){e.getAuthToken(a.isObject(t)?t:{interactive:!!t})}}}]),a.module("cf2.background",[]).factory("cf2InAppTabService",Object(ee.b)(wt)).factory("cf2BgMessagesService",Object(ee.b)(gt)).factory("bgCastifyAuth",Object(ee.b)(ut)).factory("authService",Object(ee.b)(ut)).factory("ExportClientService",Object(ee.b)(Ut)).factory("cf2RemoteYoutubeUploadService",Object(ee.b)(Le)).factory("cf2SupportArticlesService",Object(ee.b)(Gt)).factory("cf2ConnectedAppsService",Object(ee.b)(Xe)).factory("cf2BgUsageStatsService",Object(ee.b)(Ye)).factory("cf2UpgradeHelperService",Object(ee.b)(vt)).factory("cf2BgCastifyDrawService",Object(ee.b)(Rt)).factory("cf2SpeechDetectionService",Object(ee.b)(Xt)).factory("bgCf2OnlyServices",Object(ee.b)(dn)),Object(l.b)(),u.production&&Object(i.L)(),te.b().bootstrapModule(fn).catch((function(e){return console.error(e)}))},EtHb:function(e,t){angular.module("castifyExt.popupInjector",["w69b.chromeTabs","w69b.spawn","w69b.promiseTool","castifyExt.deployConfig","castifyExt.appOptions"]).factory("popupInjector",["chromeTabs","$log","deployConfig","promiseTool","appOptions","spawn",function(e,t,n,r,o,i){r.wrapChromeError(chrome.browserAction.setPopup,chrome.browserAction);let a={};return a.install=i.wrap((function*(){n.enableInlinePopupSupport?yield o.loadedPromise:t.debug("built with inline popup ui support disabled")})),a}])},"G+hJ":function(e,t){angular.module("w69b.uuid",[]).factory("uuid",["$window",function(e){function t(e){for(var t=e.toString(16);t.length<4;)t="0"+t;return t}return function(){var n=new Uint16Array(8);return e.crypto.getRandomValues(n),t(n[0])+t(n[1])+"-"+t(n[2])+"-4"+t(n[3]).substring(1)+"-y"+t(n[4]).substring(1)+"-"+t(n[5])+t(n[6])+t(n[7])}}])},"H+pR":function(e,t){angular.module("w69b.ngProgressHttp",[]).service("$progressHttp",["$http","$q",function(e,t){return function(n){var r;n.headers=n.headers||{},n.method=n.method||"POST";var o=t.defer();n.headers.__setXHR__=function e(){return function(t){if(!t)return e();r=t,n.progressEvents&&"download"!==n.progressEvents||(r.addEventListener("progress",(function(e){o.notify({type:"download",event:e})}),!1),r.addEventListener("load",(function(e){e.lengthComputable&&o.notify({type:"download",event:e})}),!1)),n.progressEvents&&"upload"!==n.progressEvents||(r.upload.addEventListener("progress",(function(e){o.notify({type:"upload",event:e})}),!1),r.upload.addEventListener("load",(function(e){e.lengthComputable&&o.notify({type:"upload",event:e})}),!1))}},e(n).then(o.resolve.bind(o),o.reject.bind(o),o.notify.bind(o));var i=o.promise;return i.abort=function(){return r&&r.abort(),i},i}}]).config((function(){var e;window.XMLHttpRequest=(e=window.XMLHttpRequest,function(){var t,n=new e;return n.setRequestHeader=(t=n.setRequestHeader,function(e,r){"__setXHR__"===e?r(n):t.apply(n,arguments)}),n})}))},HRCS:function(e,t){angular.module("w69b.chromeAnalytics",[]).provider("analytics",(function(){var e,t;this.setTrackingId=function(t){e=t},this.setApp=function(e,n){t=arguments},this.$get=["$window",function(n){if(!t)throw new Error("make sure to call analyticsProvider.setApp()");if(!n.analytics)throw new Error("chrome-analytics lib not loaded");var r=n.analytics,o=r.getService.apply(r,t),i=o.getTracker(e),a={};return a.tracker=i,a.eventBuilder=function(){return r.EventBuilder.builder()},a.setEnabled=function(e){o.getConfig().addCallback((function(t){t.setTrackingPermitted(e)}))},a.send=function(){i.send.apply(i,arguments)},a.trackPageView=function(e){i.sendAppView(e)},a.trackEvent=function(){i.sendEvent.apply(i,arguments)},a.sendNonInteractionEvent=function(e,t,n,o){a.send(r.HitTypes.EVENT,{eventCategory:e,eventAction:t,eventLabel:n,eventValue:o,nonInteraction:!0})},a.trackTimer=function(e,t,n){var r,o={start:function(){return r=(new Date).getTime(),o},send:function(a,c,s){var u=(new Date).getTime();return i.sendTiming(a||e,c||t,u-r,s||n),o}};return o.start(),o},a}]}))},"Ie/p":function(e,t){angular.module("w69b.chromeTabs",["w69b.promiseTool"]).factory("chromeTabs",["$window","promiseTool","$q",function(e,t,n){if(!e.chrome||!e.chrome.tabs)return null;var r=e.chrome,o={};return o.query=t.wrapChromeError(r.tabs.query,r.tabs),o.getActiveTab=function(){return o.query({active:!0,windowId:r.windows.WINDOW_ID_CURRENT}).then((function(e){return e.length?e[0]:n.reject()}))},o.get=t.wrapChromeError(r.tabs.get,r.tabs),o.update=t.wrapChromeError(r.tabs.update,r.tabs),o.remove=t.wrapChromeError(r.tabs.remove,r.tabs),o.create=t.wrapChromeError(r.tabs.create,r.tabs),o.connect=r.tabs.connect.bind(r.tabs),o.setZoomSettings=t.wrapChromeError(r.tabs.setZoomSettings,r.tabs),o.setZoom=t.wrapChromeError(r.tabs.setZoom,r.tabs),o.executeScript=t.wrapChromeError(r.tabs.executeScript,r.tabs),o.insertCSS=t.wrapChromeError(r.tabs.insertCSS,r.tabs),o.sendMessage=t.wrapChromeError(r.tabs.sendMessage,r.tabs),o.onUpdated=r.tabs.onUpdated,o.onActivated=r.tabs.onActivated,o.sendMessageActive=function(e,t){return o.getActiveTab().then((function(n){return o.sendMessage(n.id,e,t)}))},o}]).directive("newTab",["chromeTabs",function(e){return{restrict:"A",link:function(t,n,r){n.bind("click",(function(t){t.preventDefault(),e.create({url:r.href}).then((function(e){chrome.windows.update(e.windowId,{focused:!0},angular.noop)}))}))}}}])},IiHr:function(e,t){angular.module("w69b.chromeWindows",[]).factory("chromeWindows",["promiseTool",function(e){var t={};return t.get=e.wrapChromeError(chrome.windows.get,chrome.windows),t.create=e.wrapChromeError(chrome.windows.create,chrome.windows),t.update=e.wrapChromeError(chrome.windows.update,chrome.windows),t.getCurrent=e.wrapChromeError(chrome.windows.getCurrent,chrome.windows),t.remove=e.wrapChromeError(chrome.windows.remove,chrome.windows),t.onRemoved=chrome.windows.onRemoved,t}])},IkP3:function(e,t){angular.module("castifyExt.bgSyncDownloader",["castifyExt.bgFiles","w69b.filesHelper","w69b.chromeRuntime","castifyExt.simplePortService","w69b.spawn"]).factory("fetchTool",["spawn","castifyAuth","filesHelper","$q",function(e,t,n,r){function o(e,t){return new Promise((function(n,r){e.onwriteend=n,e.onerror=r,e.write(t)}))}return{downloadUrlToFile:function(i,a){var c,s={},u=!1;return s.path=a,s.cancel=function(){c&&c.cancel(),u=!0},s.done=r.when(e((function*(){var e=new Request(i);yield function(e){return t.getAuthToken({interactive:!1}).then((function(t){e.headers.append("Authorization","Bearer "+t)}))}(e);var r=yield n.getFileEntryByPath(a,{create:!0}),l=yield n.getMetadata(r);e.headers.append("range",`bytes = ${l.size} -`);var d=yield fetch(e,{mode:"cors"});if(!d.ok)throw new Error("fetch failed");if(!u){c=d.body.getReader();var f=yield c.read();try{s.bytesLoaded=l.size;for(var p=yield n.createWriter(r);!f.done;)yield o(p,new Blob([f.value])),s.bytesLoaded+=f.value.length,f=yield c.read()}catch(h){throw c.cancel(),h}}}),!0)),s}}}]).factory("bgSyncDownloader",["bgFiles","spawn","castifyAuth","$window","filesHelper","fetchTool","$log","$q","simplePortService",function(e,t,n,r,o,i,a,c,s){var u,l={},d=new Map,f=s("syncDownloader");function p(){var e={};for(var t of d.entries())e[t[0]]={progress:t[1].progress};f.postMessage("downloads",e)}return l.getDownload=function(e){return d.get(e)},l.startDownload=function(n){var r=d.get(n);return r||(a.debug(`bgSyncDownloader.startDownload(${n})`),r=function(n){var r,c,s=!1,l={get bytesLoaded(){return r?r.bytesLoaded:0},get progress(){return c&&c.size?l.bytesLoaded/c.size:0},cancel:function(){r&&r.cancel(),s=!0}};return l.done=t((function*(){if(yield u,c=yield e.getFileDescriptor(n),!s){var t="_dl/"+c.id;r=i.downloadUrlToFile(c.url,t),yield r.done,yield o.moveFileByPath(t,e.idToLocalFilename(c.id)),yield e.registerLocalFile(c.id)}})),l.done.catch((function(e){a.warn("bgSyncDownloader: download failed",e)})),l}(n),d.set(n,r),p(),r.done.finally((function(){d.delete(n),p()}))),r},l.install=function(){u=t((function*(){yield o.getDirByPath("_dl",{create:!0});var e=yield o.listByPath("_dl"),t=[];for(var n of e)t.push(o.remove(n));yield c.all(t)})).catch((function(e){a.error("bgSyncDownloader.cleanup failed",e)})),f.install()},f.handlers.update=function(){p()},l}])},JYpz:function(e,t){angular.module("castifyExt.bgSyncManager",["castifyExt.appOptions","castifyExt.bgUpload","w69b.chromeRuntime","w69b.googledrive","castifyExt.localFileDb","castifyExt.chromeEventPublisher","castifyExt.bgFiles","w69b.spawn","castifyExt.bgSyncDownloader"]).factory("bgSyncManager",["$rootScope","appOptions","bgUploadService","localFileDb","googledrive","$q","$log","bgFiles","spawn","bgSyncDownloader",function(e,t,n,r,o,i,a,c,s,u){var l={},d=new Map,f=new Set;function p(e,t){if(t.config.isSyncUpload){var n=t.config,s=t.data.id;a.debug("bgSyncManager: sync upload of file %s complete, driveId %s",n.fileId,s),r.getFileDescriptor(n.fileId).then((function(e){if(e.title!==n.title){var t=e.title;return a.debug("bgSyncManager: title changed, applying post-upload changes"),/\.webm/i.test(t)||(t+=".webm"),o.patchFile(s,{title:t})}return i.when()})).catch((function(e){a.warn("bgSyncManager: sync upload hook failed",e)})).then((function(){c.refresh(n.fileId)}))}}function h(e,t=!0){return r.getFileDescriptor(e).then((function(e){return e.remove().then((function(){if(a.debug("bgSyncManager: removed local file",e.id),t)return c.refresh(e.id)}))}),angular.identity)}function g(e,t){v(t)}function m(){return t.values.driveSync}function b(){return s((function*(){for(let t of Object.keys(yield r.listFiles())){var e=yield c.getFileDescriptor(t);if(!e.isSynced&&!e.autoShare)return!1}return!0}))}function v(e){s((function*(){var t=yield c.getFileDescriptor(e);if(m()){t.isSynced||t.autoShare||function(e){a.debug("bgSyncManager: starting sync upload",e.id),n.upload({fileId:e.id,target:"drive",privacy:"private",title:e.title,isSyncUpload:!0,uploader:"drive"})}(t),function(e){var t=d.get(e.id),n=e.isSynced&&!!e.driveInfo.thumbnailLink,r=e.isSynced&&new Date(e.driveInfo.createdDate)<Date.now()-72e5,o=t&&(t.downloadPending||t.timestamp+18e5>=Date.now());return e.isLocal&&(n||r)&&!o}(t)&&((yield b())?h(t.id):f.add(t.id));var r=d.get(t.id);r&&!r.isDone&&(t.isLocal?r.deferred.resolve():function(e){var t=d.get(e.id);if(t&&!t.downloadPending){var n=u.startDownload(e.id);t.downloadPending=!0,n.done.then(t.deferred.resolve.bind(t.deferred),t.deferred.reject.bind(t.deferred)),n.done.finally((function(){t.downloadPending=!1,t.timestamp=Date.now()}))}}(t))}t.autoShare&&function(e){var t=e.autoShare;return t&&t.timestamp+18e5<Date.now()}(t)&&h(t.id)})).catch((function(t){a.error(`bgSyncManager.syncFile(${e}) failed : `,t)}))}function y(e,t){t||n.cancelAllUploads(!0),l.syncFiles()}function w(){for(let e of f)v(e)}l.syncFiles=function(){s((function*(){var e=new Set;for(let t of Object.keys(yield r.listFiles()))e.add(t);for(let t of d.keys())e.add(t);for(let t of e)v(t)}))};var _=s.wrap((function*(){if(m()){a.info("Removing synced files before account change.");var e=[];angular.forEach(yield r.listFiles(),(function(t){t.driveInfo&&e.push(h(t.id))})),yield i.all(e)}}));function S(){f.clear(),_().finally((function(){l.syncFiles()}))}function E(e,r){t.values.driveSync&&n.cancel({target:"drive",fileId:r})}return l.requestSyncLocal=function(e){if(!m())return i.when();var t=d.get(e)||function(e,t){e={id:t,deferred:i.defer(),isDone:!1},d.set(t,e);var n=e.deferred.promise;return n.then((function(){e.isDone=!0})),n.catch((function(){d.delete(t)})),e}(t,e);return t.timestamp=Date.now(),v(e),t.deferred.promise},l.storeAutoSharedFile=s.wrap((function*(e){var t=yield c.getFileDescriptor(e);yield c.updateLocalInfo(e,{autoShare:null}),t.autoShare=null,v(e)})),l.syncFile=v,l.areAllLocalFilesSynced=b,l.install=s.wrap((function*(){e.$on("uploader:complete",p),e.$on("bgFiles:localFileCreated",g),e.$on("bgFiles:fileRemoved",E),e.$on("bgFiles:syncSettingChanged",y),e.$on("bgSyncStatus:syncComplete",w),e.$on("event:signInChanged",S),yield t.loadedPromise,l.syncFiles()})),l}])},KGdM:function(e,t){angular.module("w69b.chromeSystem",["w69b.promiseTool"]).factory("chromeSystem",["promiseTool",function(e){var t=window.chrome&&window.chrome.system,n={};return t?(t.cpu&&(n.cpu={getInfo:e.wrapChromeError(t.cpu.getInfo,t.cpu)}),t.memory&&(n.memory={getInfo:e.wrapChromeError(t.memory.getInfo,t.memory)}),n):n}])},LHv7:function(e,t){angular.module("castifyExt.setupService",["castifyExt.appOptions","w69b.webrtc","cf2.chromeStorageService","w69b.spawn","cf2.connectedAppsService","cf2.userAccount","castifyExt.castifyAuth","castifyExt.optionalPermissions"]).factory("setupService",["webrtc","spawn","cf2ChromeStorageService","appOptions","$log","optionalPermissions","userAccount","$http","castifyConfig","cf2ConnectedAppsService","castifyAuth",function(e,t,n,r,o,i,a,c,s,u,l){var d={};const f=s.API_URL+"/survey_questions";return d.setSetupComplete=function(e=!0){return n.sync.setSingle("setupService:welcomeShown",e)},d.getSetupComplete=function(){return n.sync.getSingle("setupService:welcomeShown",!1)},d.getDriveSyncEnabled=t.wrap((function*(){return yield r.loadedPromise,r.values.driveSync})),d.getSetupState=function({withCam:n}){return t((function*(){let[r,o,c,s,u,f]=yield Promise.all([a.getAccount(),l.getAuthToken().catch(()=>!1),i.hasLiteTabPermissions(),d.getDriveSyncEnabled(),d.getSetupComplete(),n?t((function*(){var t=e.hasVideoAccess(),n=e.hasMicrophone(),r=e.hasAudioAccess();return(yield t)||!(yield n)||(yield r)})):Promise.resolve()]);return{tab:c,cam:f,signedIn:!(!r.user||!o),filledSurvey:!!r.user&&!!r.user.survey&&!!r.user.survey.user_type,driveSync:s,setupComplete:u}}))},d.isComplete=function(){return t((function*(){var[e,t]=yield Promise.all([d.getSetupState({withCam:!1}),u.hasConnectedApps()]);return o.debug("setupService.isComplete state",e,t),e.signedIn||t||e.tab||e.setupComplete}))},d.postSurvey=function(e){return a.postUpdate({survey:e})},d.fetchSurveyQuestions=function(){return c.get(f).then(e=>e.data)},d.updateStorage=function(e){r.values.driveSync=e,r.save()},d}])},MWHJ:function(e,t){angular.module("castifyExt.oauthTokenCache",["cf2.chromeStorageService"]).factory("oauthTokenCache",["cf2ChromeStorageService","$q",function(e,t){return function(n){var r=0,o={};function i(){return e.local.getSingle(n).then((function(e){return e||{}}))}function a(){return Math.floor(Date.now()-r)+12e4}return o.get=function(e){return i().then((function(n){var r=n[e];return r&&r.expiresAt>a()?t.when(r):t.reject()}))},o.put=function(t,o){return i().then((function(i){return i[t]=o,o.issuedAt&&(r=Date.now()-Number(o.issuedAt)),function(e){var t=a();angular.forEach(e,(function(n,r){(!r.expiresAt||r.expiresAt<=t)&&delete e[n]}))}(i),e.local.setSingle(n,i)}))},o.removeByToken=function(t){return i().then((function(r){return angular.forEach(r,(function(e,n){e.accessToken===t&&delete r[n]})),e.local.setSingle(n,r)}))},o.remove=function(t){return i().then((function(r){return delete r[t],e.local.setSingle(n,r)}))},o.clear=function(){return e.local.remove(n)},o.withCache=function(e,t){return o.get(e).catch((function(){return t().then((function(t){return o.put(e,t).then((function(){return t}))}))}))},o}}])},NkpF:function(e,t){angular.module("castifyExt.bgRecordingErrorHandler",["castifyExt.appOptions","castifyExt.recordTool","cf2.chromeStorageService","w69b.spawn"]).factory("bgRecordingErrorHandler",["$rootScope","appOptions","$log","cf2ChromeStorageService","chromeNotifications","recordTool","spawn","analytics",function(e,t,n,r,o,i,a,c){let s={};function u(e){r.local.setSingle("settingsChangedNotifier",e)}const l=a.wrap((function*(){if(t.values.hwEncoding){n.info("bgRecordingErrorHandler: disabling hw encoding after a incomplete recording"),t.values.hwEncoding=!1,t.save();let e=yield i.getRecordConfig();"mp4"===e.exportFormat?(e.exportFormat=i.getRecordConfigDefaults().exportFormat,delete e.nonpersistent,yield i.setRecordConfig(e),u("hw_encoding_mp4_disabled")):u("hw_encoding_disabled")}}));function d(){t.values.hwEncoding=!0,t.save(),u("hw_encoding_enabled")}function f(){t.values.hwEncoding||(n.info("bgRecordingErrorHandler: enabling hw encoding after nacl crash"),d(),o.simple.createError({priority:2,title:"Oops, the encoder crashed",message:"We've changed the encoder to prevent this from happening again"},"encoder_switched"))}function p(){t.hwEncoding||(d(),o.simple.createError({priority:1,title:"Oops, ran out of memory",message:"Try to close some tabs/apps an try recording again."},"out_of_memory"))}return s.install=function(){e.$on("recorder:incomplete_recording_found",l),e.$on("recorder:encoder_crash",f),e.$on("recorder:out_of_memory",p)},s}])},NqIN:function(e,t){angular.module("w69b.asyncResponse",[]).factory("asyncResponse",["$q",function(e){return{createSender:function(t){var n={},r=0,o={};return n.sendWithResponse=function(n,i){var a=++r,c=e.defer();return o[a]=c,t({type:n,data:i,msgId:a}),c.promise},n.send=function(e,n){t({type:e,data:n})},n.handleResult=function(e){if(e&&"result"===e.type){var t=o[e.msgId];return delete o[e.msgId],e.hasOwnProperty("error")||e.isError?t.reject(e.error):t.resolve(e.data),!0}return!1},n},createRespond:function(t){return function(n,r){e.when(n).then((function(e){t({type:"result",msgId:r.msgId,data:e})}),(function(e){t({type:"result",msgId:r.msgId,error:e,isError:!0})}))}}}}])},PdQI:function(e,t){angular.module("castifyExt.connect.appRecorder",["castifyExt.bgRecord","castifyExt.recordTool","w69b.spawn"]).factory("appRecorder",["bgRecordService","recordTool","$q","$rootScope","spawn",function(e,t,n,r,o){return function(i){var a=n.defer(),c={};c.appId=i.id,c.ended=a.promise;var s=null;function u(){a.resolve()}function l(e,t,n){return angular.isNumber(e)&&e>=t&&e<=n}var d,f=o.wrap((function*(n){!function(e){e.recordConfig=e.recordConfig||{};var t,n=e.recordConfig;if(!angular.isObject(n))throw new Error("invalid recordConfig");if(n.audio=n.audio||{},!angular.isObject(n.audio))throw new Error("invalid recordConfig.audio");if(n.captureSource=n.captureSource||"desktop",!["desktop","screen","tab","tab_picker"].includes(n.captureSource))throw new Error("invalid captureSource");if(n.maxResolution=n.maxResolution||null,n.maxResolution){if(t=n.maxResolution,!(angular.isObject(t)&&l(t.width,64,4096)&&l(t.height,64,4096)))throw new Error("invalid maxResolution");n.maxResolution={width:n.maxResolution.width,height:n.maxResolution.height}}if(n.maxFps=n.maxFps||null,n.maxFps&&!l(n.maxFps,1,60))throw new Error("invalid maxFps");if(n.startDelay=n.startDelay||0,n.audibleCountdown=!angular.isDefined(n.audibleCountdown)||!!n.audibleCountdown,n.visualCountdown=!angular.isDefined(n.visualCountdown)||!!n.visualCountdown,n.embedWebcam=!!n.embedWebcam,n.startDelay&&!l(n.startDelay,0,10))throw new Error("invalid startDelay");if(!e.shareUrl&&!i.shareUrl)throw new Error("shareUrl required");if(e.shareUrl&&!/https?:\/\//.test(e.shareUrl))throw new Error("invalid shareUrl")}(n=n||{});let r=n.recordConfig;var o=t.canCaptureSystemAudio(),a=n.payload,c=yield t.getRecordConfig(),s={};if(["tab","tab_picker"].includes(r.captureSource)&&(o=!0),["tab","desktop","tab_picker"].includes(r.captureSource)&&angular.isObject(r.draw)){var u=r.draw;s.draw={showToolbox:!!u.showToolbox},[null,"pointer"].includes(u.tool)&&(s.draw.tool=u.tool)}return angular.extend(s,{captureSource:r.captureSource,tabId:n.tabId,startDelay:r.startDelay,audibleCountdown:r.audibleCountdown,visualCountdown:r.visualCountdown,targetFPS:r.maxFps,exportFormat:r.exportFormat,maxResolution:r.maxResolution,limitResolution:!0,audio:{mic:!!r.audio.mic,micSourceId:r.audio.micSourceId||c.audio.micSourceId,system:o&&r.audio.system},autoShareApp:{id:i.id},connectMeta:{appId:i.id,shareUrl:n.shareUrl,payload:a}}),i.isWhitelisted&&angular.extend(s,{embedWebcam:r.embedWebcam,camPosition:r.camPosition||"bottomRight",camSourceId:r.camSourceId||c.camSourceId}),e.start(s)}));return c.start=function(e){var t=n.when(f(e));s=t.finally((function(){s=null})),t.catch(u);var o=r.$on("recorder:stopped",(function(){u(),o()}));return t},c.pause=function(){return e.pause()},c.resume=function(){return e.resume()},c.restart=function(){return e.restart()},c.stop=function(){return e.stop()},c.getState=function(){return e.getRecorderState().state},c.getTime=function(){return e.getRecorderState().time},c.cancelPendingStart=function(){if(s&&e.cancelPendingStart()){var t=s.then((function(){return!1}),(function(){return!0}));return s=null,t}return n.when(!1)},(d=[]).push(r.$watch(c.getState,(function(e,t){e!==t&&c.onStateChanged&&c.onStateChanged(e)}))),d.push(r.$watch(c.getTime,(function(e,t){e!==t&&c.onTimeChanged&&c.onTimeChanged(e)}))),c.ended.then((function(){d.forEach((function(e){e()}))})),c}}])},QP76:function(e,t){angular.module("castifyExt.chromeEventPublisher",[]).run(["chromeRuntime","$rootScope",function(e,t){e.onMessage.addListener((function(e){angular.isObject(e)&&angular.isString(e.type)&&0===e.type.lastIndexOf("event:",0)&&t.$broadcast(e.type,e.data),t.$$phase||t.$digest()}))}])},RnoO:function(e,t){angular.module("w69b.filereader",[]).factory("filereader",["$q",function(e){return{readAsArrayBuffer:function(t,n,r){let o=e.defer(),i=t;(n||r)&&(i=t.slice(n,r));let a=new FileReader;return a.onloadend=function(){a.onloadend=null,a.error?o.reject(a.error):o.resolve(a.result)},a.readAsArrayBuffer(i),o.promise},readAsText:function(t){let n=e.defer(),r=new FileReader;return r.onload=()=>{r.error?n.reject(r.error):n.resolve(r.result)},r.readAsText(t),n.promise}}}])},Ryvw:function(e,t,n){const{Subject:r}=n("LcNk");angular.module("castifyExt.offline",[]).factory("onlineState",["$rootScope","$window","$http","$timeout","$log",function(e,t,n,o,i){var a={},c=null,s=!0,u=null,l=!1,d=new r;function f(){if(c)return c;var e=Math.random().toString(36).substr(2,36);return(c=n.get("https://api.screencastify.com/images/cleardot.gif?"+e,{responseType:"arraybuffer",timeout:1e4}).then((function(){return c=null,i.debug("checkNetwork result is online"),!0}),(function(){return i.debug("checkNetwork result is offline"),c=null,!1}))).then(p),c}function p(t){d.next(t),s!==t&&(i.debug("verified network state is ",t),s=t,e.$broadcast("onlineState:changed",t)),!t&&a.isNavigatorOnline()&&function(e){function t(){return(u=o(angular.noop,1e4)).then(n)}function n(){return f().then((function(e){if(!e&&a.isNavigatorOnline()&&l)return t()}))}l||(l=!0,t().finally((function(){l=!1})))}()}return a.check=function(){return f()},a.isOnline=function(){return s},a.onIsOnline=()=>d.asObservable(),a.isNavigatorOnline=function(){return!1!==t.navigator.onLine},t.addEventListener("online",(function(){a.check()})),t.addEventListener("offline",(function(){p(!1),o.cancel(u),l=!1})),a}])},Sewt:function(e,t){angular.module("castifyEdit.fixWebmJob",["w69b.asyncResponse","w69b.spawn","w69b.filesHelper"]).factory("startFixWebmJob",["asyncResponse","spawn","filesHelper","$q",function(e,t,n,r){var o,i="_tmp/edited.webm";function a(e){this.config=e,this.progress=0}var c=a.prototype;return c.start=function(){return this.promise=this._doStart(),this.promise},c._doStart=t.wrap((function*(){var t=this.config;o=new Worker("/components/castifyMediawriter/dist/mediawriter.worker.min.js"),this._cancelDeferred=r.defer(),yield n.getDirByPath("_tmp",{create:!0});var a=e.createSender(e=>o.postMessage(e));o.addEventListener("message",(function(e){var t=e.data;a.handleResult(t)||"progress"===t.type&&(this.progress=t.data)}).bind(this)),a.send("init",{path:i,fsType:"PERSISTENT"});let c=!1,s=a.sendWithResponse("readChromeFile",{path:t.inPath,fsType:"PERSISTENT"});return yield r.race([this._cancelDeferred.promise.then(()=>c=!0),s]),o.terminate(),o=null,this._cancelDeferred=null,c||(yield n.moveFileByPath(i,t.outPath),yield n.removeByPath(t.inPath)),{fileId:this.config.fileId,isFixJob:!0}})),c.cancel=t.wrap((function*(){if(!o||!this._cancelDeferred)return!1;o.terminate();let e=this.config;return yield n.removeByPath(i).catch(()=>null),yield n.moveFileByPath(e.inPath,e.outPath),this._cancelDeferred.resolve(),!0})),c.getProgress=function(){return this.progress},function(e){var t=new a(e);return t.start(),Promise.resolve(t)}}])},U5Ke:function(e,t){angular.module("castifyExt.upload.uploadBase",["castifyExt.bgFiles","w69b.filesHelper"]).factory("UploadBase",["$q","$log","bgFiles","filesHelper",function(e,t,n,r){function o(e){this.config=e,this.minStartTime=0,this.numErrors=0}o.uploaderClasses_={},o.register_=function(e,t){o.uploaderClasses_[e]=t},o.create=function(e){e.uploader=e.uploader||e.target;var t=o.uploaderClasses_[e.uploader];if(!t)throw new Error("unknown uploader type"+e.uploader);return new t(e)},o.CancelledError={reason:"cancelled",isCancelled:!0};var i=o.prototype;return o.unserialize=function(e){var t=e[0],n=e[1],r=o.uploaderClasses_[t];if(!r)throw new Error("unknown uploader type "+t);return r.fromObject(n)},i.serialize=function(){return[this.config.uploader,this.toObject()]},i.fromObject=function(e){throw new Error},i.toObject=function(){throw new Error},i.start=function(){},i.cancel=function(){return!1},i.pause=function(){return this.cancel()},i.onProgress=function(){},i.onComplete=function(){},i.onError=function(e){},i.handleComplete_=function(e){t.debug("upload complete",e),this.responseData=e},i.handleError_=function(t){return e.reject(t)},i.handleProgress_=function(e){return e},i.loadFile_=function(){var t=this.config,i=r.getFileByPath(n.idToLocalFilename(t.fileId));return e.all({file:i,fileDesc:n.getFileDescriptor(t.fileId)}).catch((function(n){return e.reject(t.isSyncUpload?o.CancelledError:n)}))},i.toString=function(){var e=this.config;return"Upload of file "+e.fileId+" to "+e.uploader},o}])},UmrE:function(e,t){angular.module("castifyExt.syncAuthTool",["castifyExt.castifyAuth","w69b.chromeRuntime","castifyExt.appOptions","castifyExt.driveUtils","w69b.spawn"]).factory("syncAuthTool",["castifyAuth","spawn","$q","$log","appOptions","chromeRuntime","$rootScope","driveUtils",function(e,t,n,r,o,i,a,c){var s={};return s.broadcastIfSyncError=t.wrap((function*(e){return"not_signed_in"===e?(r.debug("syncAuthTool: sync enabled but not signed in"),a.$broadcast("event:syncAuthError"),i.sendMessage({type:"event:syncAuthError"}).catch(angular.identity),n.reject(e)):(o.values.driveSync&&s.checkSetup().catch((function(t){switch(t){case"token":r.debug("syncAuthTool: sync enabled but we do not have a valid token"),a.$broadcast("event:syncAuthError"),i.sendMessage({type:"event:syncAuthError"}).catch(angular.identity);break;case"forbidden":r.debug("syncAuthTool: detected drive-forbidden error",e),a.$broadcast("event:syncForbiddenError");break;default:r.warn("syncAuthTool: unhandled sync error detected",e)}})),n.reject(e))})),s.hasValidAuthToken=function(){return e.getAuthToken({interactive:!1,validate:!0})},s.isRateLimitError=function(e){return c.isRateLimitError(e)},s.checkSetup=function(){return s.hasValidAuthToken().catch((function(){return n.reject("token")})).then((function(){return c.getDriveUploadParentId().catch((function(e){return c.isGoogleAppsForbiddenError(e)?n.reject("forbidden"):n.reject("unknown")}))})).then((function(){return!0}))},s}])},V0Mt:function(e,t){angular.module("castifyExt.upload.googleUpload",["castifyExt.upload.uploadBase","castifyExt.driveUtils","w69b.googledrive","w69b.googleUploader","castifyExt.bgFiles","w69b.spawn","w69b.chromeAnalytics"]).run(["UploadBase","driveUtils","googledrive","googleUploader","bgFiles","$q","$log","spawn","analytics",function(e,t,n,r,o,i,a,c,s){function u(e){if(angular.isObject(e)&&angular.isNumber(e.status)){var t=e.status;if(t<=0||t>=500&&t<600||e.config&&!1===e.config.authAutoRetry&&401===t)return!0;var n=l.getErrorReason(e);if(["userRateLimitExceeded"].includes(n))return!0}return!1}function l(t,n){e.call(this,t),this.uploadUrl=n,this.cancelled=!1}(l.prototype=Object.create(e.prototype)).constructor=e;var d=l.prototype;function f(){l.apply(this,arguments)}d.handleProgress_=function(e){e.uploadUrl?this.uploadUrl=e.uploadUrl:(this.loadedBytes_=e.loaded,this.progress=e.loaded/e.total)},d.handleError_=function(t){return t===e.CancelledError||this.cancelled?i.reject(e.CancelledError):(a.debug("googleUploader: handling error",t),i.reject({isTransient:u(t),reason:l.getErrorReason(t)}))},d.resumeUpload_=function(e){return this.uploader_=r.resumeUpload(e,this.uploadUrl),this.uploader_.promise},d.start=function(){this.cancelled=!1;var t=this;this.loadFile_().then((function(n){return t.totalBytes_=n.file.size,t.cancelled?i.reject(e.CancelledError):t.uploadUrl?t.resumeUpload_(n.file,n.fileDesc):t.startUpload_(n.file,n.fileDesc)})).then(this.handleComplete_.bind(this),this.handleError_.bind(this),this.handleProgress_.bind(this)).then((function(e){t.onComplete(e)}),(function(e){t.onError(e)}),(function(e){t.onProgress(e)}))},l.getErrorReason=function(e){return angular.isString(e)?e:e&&e.message?e.message:e&&e.data&&e.data.error&&e.data.error.errors&&e.data.error.errors[0]&&e.data.error.errors[0].reason?e.data.error.errors[0].reason:"unknown"},d.toObject=function(){return{config:this.config,uploadUrl:this.uploadUrl}},d.cancel=function(){return!!this.cancelled||(this.loadedBytes_&&this.totalBytes_-this.loadedBytes_<512e3?(a.debug("googleUploader: refusing to cancel almost complete upload"),!1):(this.cancelled=!0,this.uploader_&&this.uploader_.cancel(),!0))},(f.prototype=Object.create(l.prototype)).constructor=l,e.register_("drive",f),(d=f.prototype).trackAnalytics_=function(){if(!this.startTime)return;let e=Date.now()-this.startTime;const t=e/1e3;s.tracker.sendTiming("drive_upload","speed_seconds_per_second",Math.round(this.fileDuration/t*1e3)),s.tracker.sendTiming("drive_upload","duration_second",Math.round(e)),s.tracker.sendTiming("drive_upload","speed_bytes_per_second",Math.round(this.fileSize/t*1e3))},d.handleComplete_=c.wrap((function*(e){l.prototype.handleComplete_.call(this,e),this.trackAnalytics_(),this.openLink=e.alternateLink,yield this.setDrivePrivacy(this.config.privacy,!0),yield o.updateLocalInfo(this.config.fileId,{driveInfo:e})})),f.doesFileExistInParent=function(e,t){return n.getFile(e).then((function(e){return e.parents&&e.parents.some((function(e){return e.id===t}))&&(!e.labels||!e.labels.trashed)}),(function(e){return 404!=e.status&&i.reject(e)}))},d.startUpload_=function(a,c){var s,u=this.config,l=this,d=u.title;/\.webm$/i.test(d)||(d+=".webm");var p={duration:c.duration,width:c.width,height:c.height,uuid:c.id,recordingDate:c.createdAt.getTime(),isScreencastifySyncFile:!0};function h(){return l.cancelled?i.reject(e.CancelledError):(l.startTime=Date.now(),l.fileDuration=1e3*c.duration,l.fileSize=c.size,r.generateId().then(e=>{const t={id:e,title:d,description:u.description||"",mimeType:"video/webm",properties:f.toDrivePropertyList_(p),parents:[{id:s}]};return o.updateLocalInfo(c.id,{driveFileId:e,tmpDrivePrivacy:"private"}),l.uploader_=r.driveUpload(a,t),l.uploader_.promise}))}return t.getDriveUploadParentId().then((function(t){if(l.cancelled)return i.reject(e.CancelledError);if(s=t,c.driveInfo&&c.driveInfo.id){var r=c.driveInfo.id;return f.doesFileExistInParent(r,s).then((function(t){return t?function(t){return l.cancelled?i.reject(e.CancelledError):n.patchFile(t,{properties:f.toDrivePropertyList_(p)})}(r):h()}))}return h()}))},d.setDrivePrivacy=function(n,r){if(this.cancelled)return i.reject(e.CancelledError);const a=o.getFileDescriptor(this.config.fileId).then(e=>{if(r)return t.setSimplePrivacy(e.driveFileId,n,this.config.domain);this.config.privacy=n,o.updateLocalInfo(this.config.fileId,{tmpDrivePrivacy:n})});return i.when(a)},f.toDrivePropertyList_=function(e){var t=[];return angular.forEach(e,(function(e,n){t.push({key:n,value:e,visibility:"PRIVATE"})})),t},d.toObject=function(){return{config:this.config,uploadUrl:this.uploadUrl}},f.fromObject=function(e){return new f(e.config,e.uploadUrl)}}])},WNYX:function(e,t){angular.module("w69b.chromePermissions",["w69b.promiseTool"]).factory("chromePermissions",["promiseTool",function(e){var t=window.chrome&&window.chrome.permissions,n={};return t?(n.contains=e.wrapChromeError(t.contains,t),n.request=e.wrapChromeError(t.request,t),n.remove=e.wrapChromeError(t.remove,t),n.getAll=e.wrapChromeError(t.getAll,t),n):n}])},YGdR:function(e,t){angular.module("castifyExt.videoPreviewRenderer",["castifyExt.bgFiles","w69b.filesHelper","w69b.promiseTool","w69b.spawn"]).factory("videoPreviewRenderer",["bgFiles","filesHelper","$q","promiseTool","spawn",function(e,t,n,r,o){var i={width:640,height:360},a={renderPreview:function(a){return r.withTimeout(o.wrap((function*(){var r,o=a+".png",c={};let s=yield t.getFileEntryByPath(e.idToLocalFilename(a)),u=yield async function(e){var t=document.createElement("video");return t.src=e,t.crossOrigin="anonymous",await new Promise((e,n)=>{function r(){i(),e(t)}function o(){i(),n(new Error("failed to load video"))}function i(){t.removeEventListener("canplay",r),t.removeEventListener("error",o)}t.addEventListener("canplay",r),t.addEventListener("error",o)}),await new Promise(e=>{t.addEventListener("seeked",e),t.currentTime=.01}),t}(s.toURL());var l,d,f,p={width:u.videoWidth,height:u.videoHeight};c.size=p,c.duration=u.duration,l=p,d=i,f=Math.max(d.width/l.width,d.height/l.height),r={width:l.width*f,height:l.height*f};let h=yield function(e,t){var r=document.createElement("canvas");r.width=t.width,r.height=t.height;var o=r.getContext("2d");return o.drawImage(e,0,0,t.width,t.height),o.fillStyle="red",o.fillText("hello",10,10),function(e){var t=e.toDataURL(),r="data:image/png;base64,";if(0!==t.lastIndexOf(r,0))throw Error();var o=t.substring(r.length);return o=new Uint8Array(function(e){for(var t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length)),r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n}(o)),n.when(new Blob([o],{type:"image/png"}))}(r)}(u,r),g=yield(m=o,t.getFileEntryByPath("_previewImages/"+m,{create:!0},{create:!0}));var m;let b=yield t.createWriter(g);yield t.writeFile(b,h);var v={path:"_previewImages/"+o,size:r,url:g.toURL()};return yield e.updateLocalInfo(a,{previewImages:[v],videoInfo:c}),g})),3e3)}};return a}])},Z0Xy:function(e,t){angular.module("castifyExt.audioContextPool",[]).factory("audioContextPool",["$window",function(e){var t=[];return{acquire:function(){return t.length?t.pop():new e.AudioContext({latencyHint:"playback"})},release:function(e){t.push(e)}}}])},ZugE:function(e,t){angular.module("castifyExt.resizeTab",["w69b.chromeTabs","w69b.chromeWindows"]).factory("resizeTab",["chromeTabs","chromeWindows","$q",function(e,t,n){return function(r,o,i,a){function c(){return e.get(r).then((function(e){return s=e}))}var s,u=0,l=0;function d(){return t.get(s.windowId).then((function(e){return"normal"!==e.state&&!1===a?n.reject():t.update(s.windowId,{width:o+(e.width-s.width)+u,height:i+(e.height-s.height)+l,state:"normal"})}))}function f(e){return e.width!=o||e.height!=i?(u+=o-e.width,l+=i-e.height,d().then(c)):e}return c().then(d).then(c).then(f).then(f).catch((function(){return s}))}}])},c4q8:function(e,t){angular.module("w69b.chromeRuntime",["w69b.promiseTool"]).factory("chromeRuntime",["promiseTool",function(e){var t={};return t.sendMessage=e.wrapChromeError(chrome.runtime.sendMessage,chrome.runtime),t.getBackgroundPage=e.wrapChromeError(chrome.runtime.getBackgroundPage,chrome.runtime),t.connect=chrome.runtime.connect.bind(chrome.runtime),t.getManifest=chrome.runtime.getManifest.bind(chrome.runtime),t.id=chrome.runtime.id,chrome.runtime.getPlatformInfo&&(t.getPlatformInfo=e.wrapChromeError(chrome.runtime.getPlatformInfo,chrome.runtime)),t.setUninstallURL=e.wrapChromeError(chrome.runtime.setUninstallURL,chrome.runtime),["onMessage","onMessageExternal","onConnect","onConnectExternal","onInstalled","onSuspend"].forEach((function(e){t[e]={addListener:function(t){chrome.runtime[e].addListener(t)},removeListener:function(t){chrome.runtime[e].removeListener(t)}}})),t}])},cgCA:function(e,t){angular.module("w69b.promiseTool",[]).factory("promiseTool",["$q","$timeout",function(e,t){return{wrapChromeError:function(t,n){return function(){var r=Array.prototype.slice.call(arguments,0),o=e.defer();return r.push((function(e){chrome.runtime.lastError?o.reject(chrome.runtime.lastError):o.resolve(e)})),t.apply(n,r),o.promise}},wrapCallbacks:function(t,n){return function(){var r=Array.prototype.slice.call(arguments,0),o=e.defer();return r.push(o.resolve.bind(o)),r.push(o.reject.bind(o)),t.apply(n,r),o.promise}},serializer:function(){var t=null,n=function(n){var r=e.defer();return(t||e.when()).then((function(){(n.call()||e.when()).then(e=>r.resolve(e),e=>r.reject(e))})),(t=r.promise.catch(()=>null)).then((function(){t=null})),r.promise};return n.wrap=function(e){return function(){return n(e.bind(this,...arguments))}},n},withTimeout:function(n,r,o){o||(o=angular.noop);var i=e.defer(),a=t((function(){var e=o();angular.isDefined(e)?i.resolve(e):i.reject("timeout"),i=null}),r);function c(){t.cancel(a),a=null}return n().then((function(){c(),i&&i.resolve.apply(i,arguments)}),(function(){c(),i&&i.reject.apply(i,arguments)})),i.promise}}}])},d7dg:function(e,t){angular.module("w69b.ui.bytesFilter",[]).filter("bytes",["$injector",function(e){var t;return function(n,r){if(!angular.isNumber(n))return"-";if(angular.isUndefined(r)&&(r=1),n<=0)return"0 B";var o=Math.floor(Math.log(n)/Math.log(1024));return function(n,r){return t||(t=e.get("$filter")("number")),t(n,r)}(n/Math.pow(1024,Math.floor(o)),r)+" "+["B","KB","MB","GB","TB","PB"][o]}}])},dE4o:function(e,t){angular.module("castifyExt.simplePortService",["w69b.chromeRuntime"]).factory("simplePortService",["chromeRuntime",function(e){return function(t){var n=new Set,r={handlers:{}};function o(e){e.name===t&&(n.add(e),e.onDisconnect.addListener((function(){n.delete(e)})),e.onMessage.addListener((function(e){r.handlers.hasOwnProperty(e.type)&&r.handlers[e.type](e.data)})))}return r.postMessage=function(e,t){for(var r of n)r.postMessage({type:e,data:t})},r.install=function(){e.onConnect.addListener(o)},r}}])},e9m0:function(e,t){angular.module("castifyExt.syncNotifications",["castifyExt.bgSyncStatus","w69b.throttle","w69b.chromeNotifications","cf2.inAppTabService","castifyExt.appOptions","w69b.promiseTool","cf2.supportArticlesService"]).factory("syncNotifications",["$rootScope","bgSyncStatus","throttle","chromeNotifications","$q","cf2InAppTabService","appOptions","promiseTool","cf2SupportArticlesService",function(e,t,n,r,o,i,a,c,s){var u={},l=null,d=c.serializer();function f(e,t,{isError:n}={}){d((function(){e="sync_state_"+e;var i,a=!l;return l&&l!==e?(i=r.clear(l),a=!0):i=o.when(),t=angular.extend({type:"basic",priority:0,eventTime:Date.now(),isClickable:!1,title:"Saving on Drive",iconUrl:"images/icon128.png"},t),l=e,i.then(a?function(){return n?r.simple.createError(t,e):r.simple.create(t,e)}:function(){return r.update(e,t)})}))}function p(){d((function(){if(l){var e=r.clear(l);return l=null,e}}))}var h={uploading:function(e){a.values.notifySyncProgress&&f("progress",{type:"progress",priority:0,message:"Your recording(s) are being saved "+e.numCompleteFiles+" / "+e.numTotalFiles,progress:Math.floor(100*e.progress)})},waiting:function(e){a.values.notifySyncProgress&&f("waiting",{priority:0,message:e.numTotalFiles+" recording(s) are waiting to get saved on Drive."})},offline:function(e){f("offline",{title:"You are offline",priority:1,message:e.numTotalFiles+" recording(s) are not saved on Drive yet."})},error:function(e){"token"===e.errorReason?f("auth",{priority:2,title:"Not signed In",message:"Screencastify cannot save to Drive.",buttons:[{title:"Sign In"}]},{isError:!0}):"forbidden"===e.errorReason?f("forbidden",{priority:2,title:"G Suite setup required",message:"Drive API/Apps are disabled for your domain.",buttons:[{title:"Help"}]},{isError:!0}):"quotaExceeded"===e.errorReason?f("quota_exceeded",{priority:2,title:"Out of Drive storage space",message:"You have reached your storage limit on Drive. Screencastify cannot store save to Drive anymore.",buttons:[{title:"Help"}]},{isError:!0}):f("error",{priority:2,title:"Failed to save recordings on Drive.",message:"We failed to save "+e.numTotalFiles>0?e.numTotalFiles:"some recording(s) on Drive. Please contact support if this problem persists.",buttons:[{title:"Retry"}]},{isError:!0})},synced:p,disabled:p};function g(e,n){function r(t,r){return e==="sync_state_"+t&&n===(r||0)}r("error")?t.retry():r("auth")?i.create("#/setup"):r("forbidden")?s.openArticle("drive_apps"):r("quotaExceeded")&&s.openArticle("quotaExceeded")}function m(){var e=t.getState(),n=h[e.type];n&&n(e)}return u.install=function(){t.install();var o=n(m,1e3,!1);e.$watchCollection(t.getState,(function(){o()})),r.onButtonClicked.addListener(g)},u}])},fNYK:function(e,t){angular.module("castifyExt.switchTab",["w69b.spawn","w69b.chromeCommands","w69b.chromeNotifications"]).factory("switchTab",["$log","chromeCommands","chromeNotifications","spawn","cf2BgCastifyDrawService",function(e,t,n,r,o){const i={chromeNotify:r=>{e.debug("switchTab: draw lost focus"),t.getAll().then((function(e){for(let t=0;t<e.length;++t)if("focus-tab"==e[t].name)return e[t];return null})).then((function(e){var t="Screencastify is recording a tab in the background. ";"webrtc"!==r.encoder&&(t+="Use the extension icon to switch the record focus to your current tab.",e&&e.shortcut&&(t+=" You can also use the keyboard shortcut "+e.shortcut+".")),n.simple.create({priority:2,title:"Recording a background tab",message:t},"active_tab")}))}};return i.loadAdditionalDraw=r.wrap((function*(t,n){e.debug("switchTab: load new draw");try{yield o.loadInTab(t,n)}catch(r){e.info("switchTab: failed to load additoinal draw for tab %s",t,r)}})),i}])},gCzY:function(e,t){angular.module("castifyExt.requestMicPermission",[]).factory("requestMicPermission",["$window","$q","$interval",function(e,t,n){return function(){var r=t.defer(),o=e.open("mic.html","mic",""),i=!1;o.clGotStream=function(){i=!0,r.resolve()};var a=n((function(){o.closed&&!i&&r.reject("closed mic permission window without granting permission")}),200);return r.promise.finally((function(){n.cancel(a)})),r.promise}}])},gfU1:function(e,t){angular.module("castifyExt.audioStreamMixer",["castifyExt.audioContextPool"]).factory("audioStreamMixer",["audioContextPool",function(e){return function(){var t=e.acquire(),n=t.createMediaStreamDestination(),r={},o={},i={addStream:function(e,i){var a=t.createMediaStreamSource(i),c=t.createGain();o[e]=a,r[e]=c,a.connect(c),c.connect(n)},replaceStream:function(e,n){var a=o[e];a||i.addStream(e,n),a.disconnect(),t.createMediaStreamSource(n).connect(r[e])},setGain:function(e,t){r[e].gain.value=t}};return i.outStream=n.stream,i.dispose=function(){i.outStream.getTracks().forEach((function(e){e.stop()})),n.disconnect(),angular.forEach(r,(function(e){e.disconnect()})),angular.forEach(o,(function(e){e.disconnect()})),e.release(t)},i}}])},gutk:function(e,t){angular.module("w69b.chromeAlarms",["w69b.promiseTool"]).factory("chromeAlarms",["promiseTool",function(e){var t={};return t.create=chrome.alarms.create.bind(chrome.alarms),["get","getAll","clear","clearAll"].forEach((function(n){t[n]=e.wrapChromeError(chrome.alarms[n],chrome.alarms)})),t.onAlarm=chrome.alarms.onAlarm,t}])},iNku:function(e,t){angular.module("castifyExt.deadAudioStreamChecker",["castifyExt.audioContextPool","w69b.webrtc"]).factory("deadAudioStreamChecker",["audioContextPool","$timeout","$q","webrtc","$log",function(e,t,n,r,o){let i={getUserMedia:async function(e){let t=await r.getUserMedia(e);if(e.audio&&e.audio.mandatory&&e.audio.mandatory.sourceId){let n=await i.hasAudioData(t);o.debug("deadAudioStreamChecker: stream hasAudio=",n),n||(function(e){e.getTracks().forEach((function(e){e.stop()}))}(t),o.debug("deadAudioStreamChecker: re-requesting stream"),t=await r.getUserMedia(e))}return t},hasAudioData:async function(r,o=1e3){let i=e.acquire(),a=i.createScriptProcessor(2048,2,1),c=i.createMediaStreamSource(r),s=new Promise(e=>{a.onaudioprocess=t=>{t.inputBuffer.getChannelData(0).some(e=>0!==e)&&e(!0)}});c.connect(a),a.connect(i.destination);try{let r=t(o).then(()=>!1);return await n.race([s,r])}finally{c.disconnect(),a.disconnect(),e.release(i)}}};return i}])},iTUk:function(e,t){angular.module("w69b.structs.CircularBuffer",[]).factory("CircularBuffer",(function(){var e=function(e){this.maxSize_=e||100,this.buff_=[]},t=e.prototype;return t.nextPtr_=0,t.add=function(e){this.buff_[this.nextPtr_]=e,this.nextPtr_=(this.nextPtr_+1)%this.maxSize_},t.get=function(e){return e=this.normalizeIndex_(e),this.buff_[e]},t.set=function(e,t){e=this.normalizeIndex_(e),this.buff_[e]=t},t.getCount=function(){return this.buff_.length},t.isEmpty=function(){return 0===this.buff_.length},t.clear=function(){this.buff_.length=0,this.nextPtr_=0},t.getValues=function(){return this.getNewestValues(this.getCount())},t.getNewestValues=function(e){for(var t=this.getCount(),n=[],r=this.getCount()-e;r<t;r++)n.push(this.get(r));return n},t.getKeys=function(){for(var e=[],t=this.getCount(),n=0;n<t;n++)e[n]=n;return e},t.containsKey=function(e){return e<this.getCount()},t.containsValue=function(e){for(var t=this.getCount(),n=0;n<t;n++)if(this.get(n)==e)return!0;return!1},t.getLast=function(){return 0===this.getCount()?null:this.get(this.getCount()-1)},t.normalizeIndex_=function(e){if(e>=this.buff_.length)throw Error("Out of bounds exception");return this.buff_.length<this.maxSize_?e:(this.nextPtr_+Number(e))%this.maxSize_},e}))},ihUj:function(e,t){angular.module("castifyExt.bgLicensing",["castifyExt.castifyAuth","cf2.chromeStorageService","w69b.chromeRuntime","w69b.spawn","w69b.promiseTool","cf2.connectedAppsService"]).factory("bgLicensing",["castifyAuth","$http","chromeRuntime","cf2ChromeStorageService","$q","$log","promiseTool","spawn","cf2ConnectedAppsService",function(e,t,n,r,o,i,a,c,s){function u(){return s.getConnectedAppInfo().then((function(e){var t=Date.now();return e.some((function(e){return e.isPaidInstall&&(!e.userExpiryDate||e.userExpiryDate>=t)}))?{access:"full",type:"app",maxAgeSecs:3600}:null}))}function l(e){function t(){return e&&("tester"===e.access||"full"==e.access)}var n,r=0;return e&&(r=Date.now()+1e3*e.maxAgeSecs),{validTill:r,type:(n="trial",e&&(n=e.access,e.type&&(n+="_"+e.type)),n),branding:!(e&&!e.branding||t()),isTester:!(!e||"tester"!==e.access),isPaid:!(!e||"full"!==e.access),limitLength:!t(),maxLength:t()?Number.MAX_SAFE_INTEGER:600}}return{getLicense:function(){var s=e.getAuthToken({interactive:void 0}).then((function(){return o.all([r.sync.getSingle("cws_license").then((function(e){return angular.isDefined(e)?e:o.reject()})).catch((function(){return c((function*(){var e,r="https://www.googleapis.com/chromewebstore/v1.1/userlicenses/"+n.id,o=yield(e=window.chrome.identity,a.wrapChromeError(e.getAuthToken,e)({interactive:!1,scopes:["email","https://www.googleapis.com/auth/chromewebstore.readonly"]})),i=(yield t.get(r,{headers:{Authorization:"Bearer "+o}})).data;return!(!i.result||!i.createdTime)&&new Date(Number(i.createdTime))<1413892757176})).then((function(e){return r.sync.setSingle("cws_license",e),e}))})).catch((function(){return!1})),u()]).then((function(e){return e[1]||(e[0]?{access:"tester",maxAgeSecs:2}:null)}))}),u).then((function(e){return e})).then(l);return s.catch((function(e){i.debug("local update failed",e)})),s}}}])},jHUz:function(e,t){angular.module("castifyExt.localFileDb",["cf2.chromeStorageService","w69b.filesHelper","w69b.promiseTool"]).factory("localFileDb",["$q","cf2ChromeStorageService","filesHelper","promiseTool","$log",function(e,t,n,r,o){var i={},a=t.local;function c(e){return"filedb_"+e}function s(e){var t=c(e);return a.getSingle(t,{})}function u(e){angular.extend(this,e)}var l=u.prototype;u.createFromIdOrFileEntry=function(t){let r,o;return(angular.isString(t)?n.getFileEntryByPath(i.idToFilename(t)):e.when(t)).then((function(t){return r=t,o=i.filenameToId(t.name),e.all({metadata:n.getMetadata(r),info:s(o)}).then((function(e){var t=r.toURL(),n={id:o,uuid:o,url:t,mimeType:"video/webm",createdAt:e.metadata.modificationTime,title:e.info.title,size:e.metadata.size};if(e.info.videoInfo){var i=e.info.videoInfo;angular.extend(n,{duration:i.duration,width:i.size.width,height:i.size.height})}if(e.info.previewImages&&(n.thumbnailUrl=e.info.previewImages[0].url),e.info.driveInfo&&(n.driveInfo=e.info.driveInfo),e.info.youtubeInfo){var a=e.info.youtubeInfo;n.youtubeInfo={id:a.id,channelId:a.channelId}}return e.info.driveFileId&&(n.driveFileId=e.info.driveFileId),e.info.tmpDrivePrivacy&&(n.tmpDrivePrivacy=e.info.tmpDrivePrivacy),e.info.trimHint&&(n.trimHint=e.info.trimHint),e.info.autoShare&&(n.autoShare=e.info.autoShare),new u(n)}))}))},l.rename=function(e){return i.updateInfo(this.id,{title:e})},l.remove=function(){var t=this.id;return e.all({result:n.removeByPath(i.idToFilename(t)),info:s(t)}).then((function(t){if(t.info.previewImages)return e.all(t.info.previewImages.map((function(e){return n.removeByPath(e.path)})))})).then((function(){return a.remove(c(t))}))},l.updateYoutubeInfo=function(e){return i.updateInfo(this.id,{youtubeInfo:e})},i.listFiles=function(){return n.listByPath("/").then((function(t){var n=[];return t.forEach((function(e){e.isFile&&"."!==e.name[0]&&n.push(u.createFromIdOrFileEntry(e))})),e.all(n).then((function(e){var t={};return e.forEach((function(e){t[e.id]=e})),t}))}))},i.filenameToId=function(e){if(/\.webm/i.test(e))return e.slice(0,-5);throw new Error("invalid filename: "+e)},i.idToFilename=function(e){return e+".webm"},i.getFileDescriptor=function(e){return u.createFromIdOrFileEntry(e)};let d=r.serializer();return i.updateInfo=d.wrap((function(t,n,r){var i=c(t);return(r?e.when(n):a.get(i).then((function(e){return function(e,t){const n=!!e.driveInfo,{videoInfo:r,debugged:i,recordingDuration:a}=t||{},c=r&&r.duration;c&&a&&Math.abs(c-a)>4&&n&&!i&&(e.debugged=!0,o.error("localFileDb: mismatch file length",{...e,...t}))}(n,e[i]),angular.extend(e[i]||{},n)}))).then((function(e){var t={};return t[i]=e,a.set(t),e}))})),i}])},k4Xy:function(e,t){angular.module("castifyExt.bgSyncStatus",["castifyExt.bgFiles","castifyExt.bgUpload","castifyExt.syncAuthTool","castifyExt.bgSyncManager","w69b.throttle","w69b.chromeRuntime","w69b.spawn"]).factory("bgSyncStatus",["bgFiles","bgUploadService","$rootScope","$log","throttle","syncAuthTool","chromeRuntime","bgSyncManager","spawn",function(e,t,n,r,o,i,a,c,s){var u={},l=null,d={type:"unknown"},f={},p=new Map,h=[];function g(e){if("syncStatus"==e.name){h.push(e),m(),e.onDisconnect.addListener((function(){var t=h.indexOf(e);t>=0&&h.splice(t,1)}));var t={retry:u.retry};e.onMessage.addListener((function(e){t.hasOwnProperty(e.type)&&t[e.type](e.data)}))}}function m(){var e;e=d,h.forEach((function(t){t.postMessage({type:"stateUpdate",data:e})}))}function b(e){v({type:"synced",numTotalFiles:e}),m()}function v(e){e.type!==d.type&&(r.debug("syncStatus: changing state to ",e),"synced"===e.type&&"unknown"!==d.type&&n.$broadcast("bgSyncStatus:syncComplete")),d=e,"uploading"!==e.type&&(f={})}function y(e){"offline"!==d.type&&v({type:"offline"}),d.numTotalFiles=e,m()}function w(){c.areAllLocalFilesSynced().catch(()=>!1).then((function(e){e?(r.debug("syncStatus: treating auth error with no local files as synced"),b(0)):(v({type:"error",errorReason:"token"}),m())}))}function _(){v({type:"error",errorReason:"forbidden"}),m()}function S(){var e=null;for(let t of p.values())t&&(e=t);v({type:"error",numTotalFiles:p.size,errorReason:e}),m()}function E(){t.isOnline()?i.checkSetup().then(S,(function(e){"token"===e?w():"forbidden"===e?_():S()})):y(0)}var I=s.wrap((function*(){p.size>0?E():(yield c.areAllLocalFilesSynced().catch(()=>!1))?b(0):e.listFiles().then((function(e){if(l){var n={},r=!1,o=0;angular.forEach(e,(function(e){var i;e.autoShare||(e.isSynced?f.hasOwnProperty(e.id)&&(f[e.id]=1):(n[e.id]=(i=t.getTargetFileState(e.id,"drive"))&&i.config.isSyncUpload?i:null,r=!0),++o)})),angular.forEach(f,(function(t,n){e[n]||delete f[n]})),r?function(e){var n=0,r=0;angular.forEach(e,(function(e,t){f[t]=e&&e.progress||f[t]||0,e?"uploading"===e.state?++n:"queued"===e.state&&++r:r++})),n?function(){"uploading"!==d.type&&v({type:"uploading"});var e=0,t=0,n=0;angular.forEach(f,(function(r){e+=r,++t,r>=1&&++n})),d.progress=e/t,d.numTotalFiles=t,d.numCompleteFiles=n,m()}():r&&(t.hasRecentlyRanOutOfDriveSpace()?(v({type:"error",errorReason:"quotaExceeded"}),m()):t.isOnline()?function(e){"waiting"!==d.type&&v({type:"waiting"}),d.numTotalFiles=e,m()}(r):y(r))}(n):b(o)}}),(function(e){r.debug("syncStatus list err",e),i.isRateLimitError(e)||E()}))}));function O(e,t){var n=t.config,o=t.error;n.isSyncUpload&&(r.debug("sync error detected",o),p.has(n.fileId)&&p.delete(n.fileId),p.set(n.fileId,o&&o.reason),I())}function C(){return"error"==d.type}function j(){C()||w()}function A(){C()||_()}function T(){p.clear(),I()}return u.retry=function(){t.clearOutOfSpaceErrors(),p.clear(),c.syncFiles()},u.getState=function(){return d},u.install=function(){n.$watch(e.isSyncEnabled,(function(r){r?function(){v({type:"unknown"}),m(),l=n.$new(!0);var r=o(I,300,!0);l.$watchGroup([e.getListVersionId,t.getWatcherStateId,t.isOnline],(function(){r()})),l.$on("uploader:failed",O),l.$on("event:syncAuthError",j),l.$on("event:syncForbiddenError",A),l.$on("event:userAccountChanged",T)}():(l&&l.$destroy(),l=null,v({type:"disabled"}),m())})),a.onConnect.addListener(g)},u}])},kEoX:function(e,t){angular.module("w69b.streamedVideo",[]).factory("streamedVideo",["$q",function(e){return function(){var t,n,r,o=document.createElement("video"),i={onEnded:null};function a(){i.onEnded&&i.onEnded()}return i.stop=function(){n&&(o.pause(),o.src="",window.URL.revokeObjectURL(t),n.removeEventListener("ended",a),n.stop(),n=null,r=!1)},i.load=function(c){if(n)throw new Error;n=c;var s=e.defer();return c.addEventListener("ended",a),t=window.URL.createObjectURL(c),o.addEventListener("canplay",(function e(){o.removeEventListener("canplay",e),o.play(),0===o.videoHeight||0===o.videoWidth?(i.stop(),s.reject("loading video failed")):(r=!0,s.resolve())})),o.addEventListener("error",(function e(){o.removeEventListener("error",e),i.stop(),s.reject(o.error)})),o.src=t,o.volume=0,s.promise},i.isLoaded=function(){return r},i.getVideoElement=function(){return o},i}}])},kwgm:function(e,t){angular.module("w69b.chromeCapture",["w69b.promiseTool","w69b.webrtc"]).factory("chromeCapture",["promiseTool","webrtc","$q",function(e,t,n){var r={tabCapture:function(){return chrome.tabCapture?e.wrapChromeError(chrome.tabCapture.capture,chrome.tabCapture).apply(null,arguments):n.reject("tabCapture permission missing")}};return chrome.desktopCapture&&(r.chooseDesktopMedia=function(){e.wrapChromeError(chrome.desktopCapture.chooseDesktopMedia,chrome.desktopCapture);var t=Array.prototype.slice.call(arguments,0),r=n.defer();t.push((function(e){chrome.runtime.lastError?r.reject(chrome.runtime.lastError):r.resolve(e)}));var o=chrome.desktopCapture.chooseDesktopMedia.apply(chrome.desktopCapture,t);function i(e){chrome.desktopCapture.cancelChooseDesktopMedia(o),r.reject(e||"cancelled")}return{promise:r.promise,cancel:i}}),r.desktopCapture=function(e){return t.getUserMedia({audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:1920,maxHeight:1200}}})},r}])},"mV/w":function(e,t){angular.module("castifyExt.bgFiles",["castifyExt.localFileDb","castifyExt.driveFileDb","w69b.chromeRuntime","castifyExt.appOptions","castifyExt.syncAuthTool","castifyExt.offline","w69b.spawn","cf2.bgUsageStatsService"]).factory("bgFiles",["localFileDb","driveFileDb","$q","$rootScope","chromeRuntime","appOptions","$log","syncAuthTool","spawn","$timeout",function(e,t,n,r,o,i,a,c,s,u){let l,d={},f={},p=[],h=0,g=0,m=["id","size","width","height","duration","title","thumbnailUrl","createdAt","url","driveInfo","youtubeInfo","urlRequiresAccessToken","autoShare","mimeType"],b=m.concat(["isSynced","isLocal","driveFileId","tmpDrivePrivacy","trimHint"]);function v(e,t){this.$localDesc=e,this.$driveDesc=t,this.ownProperties_={}}let y=v.prototype;function w(e){this.port=e}function _(e){return c.broadcastIfSyncError(e)}function S(){return i.values.driveSync}function E(e){let t={};return b.forEach((function(n){let r=e[n];angular.isDefined(r)&&(r instanceof Date&&(r=r.getTime()),t[n]=r)})),t}function I(e){let t={};return angular.forEach(e,(function(e,n){t[n]=E(e)})),t}function O(){h++,f.listFiles().then((function(e){C("filesUpdate",{full:I(e)})}))}function C(e,t){p.forEach((function(n){n.subscribed&&n.postMessage(e,t)}))}function j(e){h++;let t=d[e],n={};t?(n.add={},n.add[e]=E(t)):n.remove=[e],C("filesUpdate",n)}function A(e){if("files"!=e.name)return;let t=new w(e);p.push(t),e.onDisconnect.addListener((function(){let e=p.indexOf(t);e>=0&&p.splice(e,1)}));let n={remove:f.remove,reload:function(e){f.reload(e).then((function(){t.postMessage("reloadSuccess",e)}),(function(){t.postMessage("reloadError",e)}))},refreshAll:f.refreshAll,rename:function(e){f.rename(e.id,e.title)},removeAll:f.removeAll,subscribe:function(){t.subscribed=!0,t.postFiles()}};e.onMessage.addListener((function(e){n.hasOwnProperty(e.type)&&n[e.type](e.data)}))}y.preferDriveDelegate_=function(){return this.$driveDesc?this.$driveDesc:this.$localDesc},y.preferLocalDelegate_=function(){return this.$localDesc?this.$localDesc:this.$driveDesc},y.getDelegate_=function(e){return this.ownProperties_.hasOwnProperty(e)?this.ownProperties_:"thumbnailUrl"===e?this.preferLocalDelegate_():this.preferDriveDelegate_()},y.callOnBoth_=function(e,t){t=Array.prototype.slice.call(arguments,1);let r,o=this;return r=o.$driveDesc?o.$driveDesc[e].apply(o.$driveDesc,t).catch(_):n.when(),r.then((function(){if(o.$localDesc)return o.$localDesc[e].apply(o.$localDesc,t)}))},y.reload=function(){let r=[],o=this;o.$driveDesc&&r.push(t.getFileDescriptor(o.id).then((function(e){o.$driveDesc=e}))),o.$localDesc&&r.push(e.getFileDescriptor(o.id).then((function(e){o.$localDesc=e})));let i=n.all(r).then((function(){o.ownProperties_={}}));return i.finally((function(){j(o.id)})),i},y.rename=function(e){let t=this,n=t.title;t.title=e;let r=t.callOnBoth_("rename",e);return r.catch((function(){t.title=n})),r.finally((function(){j(t.id)})),r},y.remove=function(){a.debug("bgFiles.remove",this.id);let e=this,t=e.callOnBoth_("remove");return t.then((function(){delete d[e.id],r.$broadcast("bgFiles:fileRemoved",e.id)})),t.finally((function(){j(e.id)})),t},y.updateYoutubeInfo=function(e){let t=this,n=t.youtubeInfo;t.youtubeInfo=e;let r=t.callOnBoth_("updateYoutubeInfo",e);r.catch((function(){t.youtubeInfo=n})),r.finally((function(){j(t.id)}))},m.forEach((function(e){Object.defineProperty(y,e,{get:function(){let t=this.getDelegate_(e);return t?t[e]:null},set:function(t){this.ownProperties_[e]=t}})})),Object.defineProperty(y,"isSynced",{get:function(){return!!this.$driveDesc}}),Object.defineProperty(y,"isLocal",{get:function(){return!!this.$localDesc}}),Object.defineProperty(y,"driveFileId",{get:function(){return this.$driveDesc&&this.$driveDesc.driveInfo&&this.$driveDesc.driveInfo.id||this.$localDesc&&this.$localDesc.driveFileId}}),Object.defineProperty(y,"tmpDrivePrivacy",{get:function(){return this.$localDesc&&this.$localDesc.tmpDrivePrivacy||"private"}}),Object.defineProperty(y,"trimHint",{get:function(){return this.$localDesc&&this.$localDesc.trimHint}}),y=w.prototype,y.postMessage=function(e,t){p.indexOf(this)<0||this.port.postMessage({type:e,data:t})},y.postFiles=function(){let e=this;f.listFiles().then((function(t){e.postMessage("filesUpdate",{full:I(t)})}),(function(t){a.warn("initial MessageClient subscribe postFiles failed",t),e.postMessage("filesUpdate",{error:!0})}))},f.getFileDescriptor=function(e){return d[e]?n.when(d[e]):f.listFiles().then((function(t){return t[e]?t[e]:n.reject(new Error("file does not exist: "+e))}))},f.listFiles=function(){if(!l){let r=i.loadedPromise.then((function(){return S()?t.listFiles():n.when({})}));l=n.all({local:e.listFiles(),drive:r}).then((function(e){return g=Date.now(),Object.keys(e.local).concat(Object.keys(e.drive)).forEach((function(t){let n=new v(e.local[t],e.drive[t]);d[n.id]=n})),d})),l.catch(_),l.catch((function(){l=null}))}return l},f.removeAll=s.wrap((function*(){let e,t=yield f.listFiles(),n=Object.keys(t);return e=S()?T(n):x(n),e.catch(O),e}));const T=s.wrap((function*(e){const t=[];for(let n=0;n<e.length;n+=7)t.push(x(e.slice(n,n+7))),n+7<e.length&&(yield u(1e3));return n.all(t)}));function x(e){return n.all(e.map(e=>f.remove(e)))}function P(e){if(404===e.status)return a.warn("tried to remove non-existent file, refreshing all files"),f.refreshAll(!0);throw e}function R(){return null}function k(e){e&&f.refreshAll()}return f.remove=function(e){return f.getFileDescriptor(e).then(e=>e.remove()).catch(P)},f.rename=function(e,t){return f.getFileDescriptor(e).then((function(e){return e.rename(t)}))},f.reload=function(e){return f.getFileDescriptor(e).then((function(e){return e.reload()}))},f.clearCache=s.wrap((function*(){h++,l=null,yield t.clearCache(),angular.copy({},d)})),f.idToLocalFilename=function(t){return e.idToFilename(t)},f.getFile=function(t){return e.getFile(t)},f.localFilenameToId=function(t){return e.filenameToId(t)},f.updateLocalInfo=function(t,n){return e.updateInfo(t,n).then((function(){f.reload(t).then((function(){j(t)})).catch(()=>null)}))},f.updateYoutubeInfo=function(e,t){return f.getFileDescriptor(e).then((function(e){return e.updateYoutubeInfo(t)}))},f.getListVersionId=function(){return h},f.isSyncEnabled=S,f.registerLocalFile=function(t){return s((function*(){let n=yield e.getFileDescriptor(t),o=yield f.getFileDescriptor(t).catch((function(){return new v(n,null)}));d[o.id]=o,j(t),r.$broadcast("bgFiles:localFileCreated",t)}))},f.refresh=function(r){if(!/^[0-9a-zA-Z-]*$/.test(r))throw new Error("invalid file id");return n.all({proxy:f.getFileDescriptor(r).catch(R),drive:t.getFileDescriptor(r).catch(R),local:e.getFileDescriptor(r).catch(R)}).then((function(e){let t=e.proxy;if(!t){if(!e.drive&&!e.local)return n.reject();t=new v(e.local,e.drive),d[t.id]=t}t.$driveDesc=e.drive,t.$localDesc=e.local,t.$driveDesc||t.$localDesc||(t.deleted=!0,delete d[r]),j(r)}))},f.refreshAll=async function(e=!1){a.debug("bgFiles: refreshAll"),(e||Date.now()-g>9e5)&&(a.debug("bgFiles:refreshAll updating cache "),await f.clearCache(),O())},f.install=function(){r.$on("onlineState:changed",k),r.$on("event:userAccountChanged",()=>f.refreshAll(!0)),i.loadedPromise.then((function(){r.$watch(S,(function(e,t){var n;t!==e&&(a.debug("bgFiles: sync setting changed to "+(n=e)+" clearing cache"),f.clearCache(),p.length&&O(),r.$broadcast("bgFiles:syncSettingChanged",n))}))})),o.onConnect.addListener(A)},f}])},mim6:function(e,t){angular.module("castifyExt.fileNameGenerator",["w69b.filesHelper","w69b.uuid"]).factory("fileNameGenerator",["uuid","filesHelper",function(e,t){return function(n,r){return n||(n=""),r||(r=""),function o(){var i=n+e()+r;return t.getFileEntryByPath(i).then((function(){return o()}),(function(){return i}))}()}}])},oRFD:function(e,t){angular.module("castifyExt.simpleBgServiceConsumer",["w69b.chromeRuntime"]).factory("simpleBgServiceConsumer",["chromeRuntime","$q",function(e,t){return function(n,r){var o={};function i(e){return e.error?t.reject(e.error):e.data}return r.forEach((function(t){o[t]=function(t){return function(){return e.sendMessage({type:"simpleService",fn:t,service:n,data:Array.prototype.concat.apply([],arguments)}).then(i)}}(t)})),o}}])},"q6u/":function(e,t){angular.module("castifyExt.deployConfig",[]).provider("deployConfig",(function(){let e={analyticsId:"UA-23874345-14",apiUrl:"https://api.screencastify.com/api",clientId:"242262968495-o42n5tqeo08dsa75p3j4dk1k61t05ln3.apps.googleusercontent.com",youtubeClientId:"242262968495-o42n5tqeo08dsa75p3j4dk1k61t05ln3.apps.googleusercontent.com",scopes:chrome.runtime.getManifest().oauth2.scopes,redirectUri:"https://www.screencastify.com/oauth2postback",editorOpenUri:"https://edit.screencastify.com/open/drive",welcomePageUri:"https://www.screencastify.com/welcome",notificationUri:"https://us-central1-castify-notifications-prod.cloudfunctions.net/api/userNotification/",env:"prod",onboardingUri:"https://app.screencastify.com/record-onboarding",enableInlinePopupSupport:!1};return{...e,$get:function(){return e}}}))},qVZV:function(e,t){angular.module("w69b.clipboard",[]).factory("clipboard",["$document",function(e){return{copy:function(t){var n=angular.element("<textarea></textarea>");n.text(t),e.find("body").append(n),n[0].select(),e[0].execCommand("copy"),n.remove()}}}])},rJTD:function(e,t){angular.module("w69b.uritool",[]).factory("uritool",(function(){var e=/\+/g;function t(t){return decodeURIComponent(t.replace(e," "))}return{parseQuery:function(e,n){var r;"?"==e[0]&&(e=e.substring(1));for(var o=/([^&=]+)=?([^&]*)/g,i={};r=o.exec(e);){var a=t(r[1]),c=t(r[2]);n&&i.hasOwnProperty(a)?i[a].push(c):i[a]=n?[c]:c}return i},parseUrl:function(e){var t=document.createElement("a");return t.href=e,{protocol:t.protocol.replace(":",""),host:t.hostname,port:t.port,query:t.search,hash:t.hash,path:t.pathname}},encodeQuery:function(e){var t=[];return angular.forEach(e,(function(e,n){angular.isArray(e)?angular.forEach(e,(function(e){t.push(encodeURIComponent(n)+(!0===e?"":"="+encodeURIComponent(e)))})):t.push(encodeURIComponent(n)+(!0===e?"":"="+encodeURIComponent(e)))})),t.length?t.join("&"):""}}}))},rsSo:function(e,t){angular.module("castifyExt.ui.audioCountdown",[]).factory("audioCountdown",["$q","$timeout",function(e,t){var n,r,o=0,i=0,a=!1,c={load:function(t){a=!0,n||(n=new Audio("components/castifyExt/ui/audio-countdown.dat"));var r=e.defer();return n.addEventListener("canplay",(function e(){n.removeEventListener("canplay",e),r.resolve()})),n.error?(a=!1,r.reject("failed to load audio countdown: "+(n.error&&n.error.code))):n.addEventListener("error",(function e(){a=!1,n.removeEventListener("error",e),r.reject("failed to load audio countdown: "+(n.error&&n.error.code))})),n.currentTime=Math.max(9.8-t,0),o=1e3*Math.max(t-9.8,0),r.promise},pause:function(){n&&a&&(r?(t.cancel(r),r=null,o-=Date.now()-i):n.pause())},start:function(){n&&a&&!n.ended&&(i=Date.now(),o?r=t((function(){r=null,n.play()}),o):n.play())},stop:function(){c.pause(),a=!1}};return c}])},sQ84:function(e,t){angular.module("w69b.filesHelper",["w69b.promiseTool"]).factory("filesHelper",["$window","promiseTool","$q",function(e,t,n){e.requestFileSystem=e.requestFileSystem||e.webkitRequestFileSystem;var r=window.PERSISTENT,o={};function i(e){var t=e.split("/");return[t.slice(0,-1).join("/"),t.slice(-1)[0]]}return["readEntries","remove","getFile","getMetadata","moveTo","file","getDirectory","createWriter"].forEach((function(e){o[e]=function(n){var r=[].slice.call(arguments,1);return t.wrapCallbacks(n[e],n).apply(null,r)}})),o.getFileSystem=function(n,o){return angular.isUndefined(n)&&(n=r),o=o||104857600,t.wrapCallbacks(e.requestFileSystem,e)(n,o)},o.getPersistentQuota=function(){var t=n.defer();return e.navigator.webkitPersistentStorage.queryUsageAndQuota((function(e,n){t.resolve({usage:e,quota:n})}),(function(e){t.reject(e)})),t.promise},chrome.system&&chrome.system.storage&&(o.getStorageInfo=t.wrapChromeError(chrome.system.storage.getInfo,chrome.system.storage)),o.getDirByPath=function(e,t){var r=e.split("/");return""===r[0]&&r.splice(0,1),o.getFileSystem().then((function(e){return function e(r,i){return i.length?o.getDirectory(r,i[0],t||{}).then((function(t){return e(t,i.slice(1))})):n.when(r)}(e.root,r)}))},o.moveFileByPath=function(e,t){var r=i(t),a=r[0],c=r[1];return n.all({file:o.getFileEntryByPath(e),targetDir:o.getDirByPath(a)}).then((function(e){return o.moveTo(e.file,e.targetDir,c)}))},o.getFileEntryByPath=function(e,t,n){var r=i(e),a=r[1];return o.getDirByPath(r[0],n).then((function(e){return o.getFile(e,a,t||{})}))},o.getFileByPath=function(e){return o.getFileEntryByPath(e).then((function(e){return o.file(e)}))},o.removeByPath=function(e){return o.getFileEntryByPath(e).then((function(e){return o.remove(e)}))},o.listByPath=function(e){return o.getDirByPath(e).then((function(e){var t=e.createReader();return o.readEntries(t)}))},o.requestPersistentQuota=function(e){return t.wrapCallbacks(navigator.webkitPersistentStorage.requestQuota,navigator.webkitPersistentStorage)(e||104857600)},o.requestTemporaryQuota=function(e){return t.wrapCallbacks(navigator.webkitTemporaryStorage.requestQuota,navigator.webkitTemporaryStorage)(e||104857600)},o.writeFile=function(e,t){var r=n.defer();return e.onwriteend=r.resolve.bind(r),e.onerror=r.reject.bind(r),e.write(t),r.promise},o.isSupported=function(){return!!window.requestFileSystem},o}])},tUCW:function(e,t){angular.module("w69b.pnaclVideoEncoder",["w69b.pnaclModule"]).factory("pnaclVideoEncoder",["pnaclModule","$q","$log","$rootScope","$timeout",function(e,t,n,r,o){return function(i,a){var c,s,u=e(i,a),l=null,d=["start","stop","pause","resume","replaceTracks"],f={};function p(){c={state:"inactive",time:0}}function h(){u.unload(),p()}function g(e){h(),l&&l.reject(e),l=null}function m(e){n.error("pnaclVideoEncoderError",e),g(e),f.onError&&f.onError(e)}function b(e){g(),f.onCrash&&f.onCrash(e)}function v(e,t){u.postMessage({type:e,data:t||{}})}function y(e,n){if(l)throw new Error("there is still a pending operation");return l=t.defer(),e&&v(e,n),l.promise}return u.onMessage=function(e){if(d.indexOf((e=e.data).type)>=0){if(!l)return;e.data?l.reject(e.data):l.resolve(),l=null}else if("error"==e.type)m(e.data),r.$$phase||r.$digest();else if("state"==e.type)c=e.data,r.$$phase||r.$digest();else if("stack_trace"==e.type)b(e.data);else{var t;e.data&&(t=e.data).trim&&(t=t.trim()),n.debug(e.type,t)}},f.onCrash=void 0,u.onCrash=b,f.stop=function(){return y("stop").then((function(){h()}))},f.load=function(){return u.load().catch((function(e){return n.warn("original pnacl.load error: ",e),t.reject("nacl_load")}))},f.getState=function(){return c.state},f.getStateObj=function(){return c},f.getFPS=function(){return c.fps},f.getCurrentTime=function(){return c.time},f.replaceTracks=function(e){return y("replaceTracks",e)},f.pause=function(){return y("pause")},f.resume=function(){return y("resume")},f.hasPendingOperation=function(){return!!l},f.start=function(e,t){if(!e)throw new Error("invalid filename");e="/html5_persistent/"+e;var n=y();return s=o((function(){m("start_timeout")}),8e3),u.load().then((function(){return v("start",angular.extend({},t,{filename:e,chromeVersion:Number((/Chrome\/(\d+)/.exec(window.navigator.userAgent)||[void 0,0])[1])})),n})).finally((function(){o.cancel(s),s=null}))},p(),f}}])},tYv9:function(e,t){angular.module("castifyExt.authConfig",["castifyExt.youtubeAuth","castifyExt.castifyAuth","w69b.chromeRuntime","w69b.googleHttpAuthInterceptor","castifyExt.youtubeAuth"]).config(["$httpProvider","youtubeAuthProvider","googleHttpAuthInterceptorProvider","deployConfigProvider",function(e,t,n,r){t.setClientId(r.youtubeClientId),e.interceptors.push("youtubeHttpAuthInterceptor"),e.interceptors.push("googleHttpAuthInterceptor"),n.enableAuthAutoRetry(!0),n.setAuthProvider("castifyAuth")}])},vEZL:function(e,t){angular.module("w69b.googleHttpAuthInterceptor",[]).provider("googleHttpAuthInterceptor",(function(){var e=0,t="googleauth";this.enableAuthAutoRetry=function(t){e=t?1:0},this.setAuthProvider=function(e){t=e},this.$get=["$q","$log","$injector",function(n,r,o){var i,a;function c(e){return(a||(a=o.get(t)),a).getAuthToken(e)}return{request:function(e){return e.googleAuth?c({scopes:e.googleAuthScopes}).then((function(t){return e.headers=angular.extend(e.headers||{},function(e){return{Authorization:"Bearer "+e}}(t)),e}),(function(e){return r.warn("googleAuthHttpInterceptor: no token, aborting request",e),n.reject(e&&"status"in e?e:"googleAuthFailed")})):e},responseError:function(t){if(401==t.status&&t.config.googleAuth&&!1!==t.config.authAutoRetry){r.debug("auth error detected",t);var a=angular.copy(t.config);if(a.authRetryCount?a.authRetryCount++:a.authRetryCount=1,a.authRetryCount<=e)return c({scopes:a.googleAuthScopes,validate:!0}).then((function(){return r.debug("googleAuthHttpInterceptor: auto-retrying with validated token"),(i||(i=o.get("$http")),i)(a)}))}return n.reject(t)}}}]}))},wFxG:function(e,t){angular.module("w69b.chromeNotifications",["w69b.promiseTool","w69b.chromeAnalytics"]).factory("chromeNotifications",["promiseTool","$log","analytics",function(e,t,n){var r={},o={};function i(e){var t=o[e];t&&t.onClicked&&t.onClicked()}function a(e,t){var n=o[e];n&&n.onButtonClicked&&n.onButtonClicked(t)}function c(e,t){var n=o[e];n&&(n.onClosed&&n.onClosed(t),delete o[e],Object.keys(o).length||(r.onClicked.removeListener(i),r.onButtonClicked.removeListener(a),r.onClosed.removeListener(c)))}return r.simple={},r.simple.defaultOptions={},r.simple.create=function(n,s){t.info(`chromeNotifications: simple message - ${n.title}: ${n.message}`);var u=e.serializer(),l={};return n=angular.extend({},r.simple.defaultOptions,n),u((function(){return r.create(s||"",n).then((function(e){l.id=e,Object.keys(o).length||(r.onClicked.addListener(i),r.onButtonClicked.addListener(a),r.onClosed.addListener(c)),o[e]=l}))})),l.clear=function(){u((function(){return r.clear(l.id)}))},l.update=function(e){u((function(){return r.update(l.id,e)}))},l.onClicked=angular.noop,l.onButtonClicked=angular.noop,l.onClosed=angular.noop,l},r.simple.createError=function(e,o){return n.trackEvent("error","chrome-notifications",`${e.title}: ${e.message}`),t.warn(`chromeNotifications: createError - ${e.title}: ${e.message}`),r.simple.create(e,o)},["clear","create","update","getAll","getPermissionLevel"].forEach((function(t){r[t]=e.wrapChromeError(chrome.notifications[t],chrome.notifications)})),["onClosed","onClicked","onButtonClicked","onPermissionLevelChanged","onShowSettings"].forEach((function(e){r[e]=chrome.notifications[e]})),r}])},werd:function(e,t){angular.module("castifyExt.bgUpload",["cf2.chromeStorageService","w69b.chromeAnalytics","w69b.chromeRuntime","castifyExt.upload.uploadBase","castifyExt.upload.googleUpload","w69b.throttle","castifyExt.offline","castifyExt.syncAuthTool","cf2.sentryErrorHandler"]).factory("bgUploadService",["analytics","cf2ChromeStorageService","chromeRuntime","$log","$rootScope","UploadBase","throttle","onlineState","syncAuthTool","$timeout","sentryErrorHandler",function(e,t,n,r,o,i,a,c,s,u,l){var d,f,p=[],h=[],g=[],m=[],b=0,v={};function y(e){if("uploader"==e.name){m.push(e),E(),e.onDisconnect.addListener((function(){var t=m.indexOf(e);t>=0&&m.splice(t,1)}));var t={upload:v.upload,cancel:v.cancel,setDrivePrivacy:v.setDrivePrivacy};e.onMessage.addListener((function(e){t.hasOwnProperty(e.type)&&t[e.type](e.data)}))}}function w(){h.length&&(r.info("onSuspend() while upload queue is not empty, preventing unloading"),n.getBackgroundPage()),S.flush()}function _(e,t){m.forEach((function(n){n.postMessage({type:e,data:t})}))}var S=a((function(){var e=p.concat(h).map((function(e){return e.serialize()}));t.local.setSingle("uploadsPending",{queued:e,recentErrors:g})}),2e3,!1),E=a((function(){if(m.length){var e={};g.forEach((function(e){t(e.config,{state:"error",error:e.error,config:e.config})})),h.forEach((function(e){t(e.config,{state:"queued",config:e.config})})),p.forEach((function(e){t(e.config,{state:"uploading",progress:e.progress})})),_("stateUpdate",e)}function t(t,n){var r=t.fileId,o=t.target;n.fileId=r,n.target=o,n.isSyncUpload=t.isSyncUpload,e[r]=e[r]||{},e[r][o]=n}}),300,!1);function I(){S(),E(),b++}function O(e,t=!0){if(delete e.onProgress,delete e.onComplete,delete e.onError,t){var n=p.indexOf(e);p.splice(n,1),U(),I()}}function C(e){var t=h.indexOf(e);h.splice(t,1)}function j(e,t){g=g.filter((function(n){return n.config.target!==t||n.config.fileId!==e}))}function A(e,t){for(j(e.fileId,e.target),g.push({config:e,error:t});g.length>5;)g.shift()}function T(e){r.debug("bgUpload: upload complete",e.toString()),O(e),o.$broadcast("uploader:complete",{config:e.config,data:e.responseData,link:e.openLink})}function x(t,n){if(r.warn("upload error",n),O(t),n===i.CancelledError)r.debug("upload was cancelled",t.toString());else if(n.isTransient)!function(e){e.numErrors++;var t=Math.min(12e4,2e3*Math.pow(2,e.numErrors-1));e.minStartTime=Date.now()+t+1e3*Math.random(),r.debug("transient upload error, re-queuing in %s: %s",t,e.toString()),L(e)}(t),c.check();else{s.broadcastIfSyncError(n).catch(()=>null);var a=t.config;o.$broadcast("uploader:failed",{config:a,error:n}),A(a,n),_("uploadFailed",{target:a.target,fileId:a.fileId,error:n,channelId:a.channelId}),e.trackEvent("bg_upload","error: "+((u=n).reason?u.reason:u.message)),u.reason&&!l.shouldIgnoreError(u.reason)&&l.handleError(new Error(u.reason))}var u;I()}function P(e){I()}function R(e){e.onComplete=T.bind(null,e),e.onError=x.bind(null,e),e.onProgress=P.bind(null,e)}function k(e){return h.filter((function(t){return t.config.fileId===e.fileId&&t.config.target===e.target}))[0]}function D(e){return p.filter((function(t){return t.config.fileId===e.fileId&&t.config.target===e.target}))[0]}function $(e){return k(e)||D(e)}function F(e){return e.isSyncUpload&&v.hasRecentlyRanOutOfDriveSpace()}function U(){function e(){if(!(p.length<5&&h.length))return!1;var e=h[0];return e.minStartTime<=Date.now()&&(!e.config.isSyncUpload||p.length<2)}if(h.sort((function(e,t){var n=e.minStartTime-t.minStartTime;if(0===n){if(e.config.isSyncUpload&&!t.config.isSyncUpload)return 1;if(t.config.isSyncUpload&&!e.config.isSyncUpload)return-1}return n})),f&&(u.cancel(f),f=null),c.isOnline()&&h.length)if(h[0].minStartTime<=Date.now()){for(;e();){var t=h.shift();F(t.config)?r.debug("discarding sync upload while out of space",t.toString()):(r.debug("starting queued upload",t.toString(),g),R(t),p.push(t),t.start())}I()}else{var n=h[0].minStartTime-Date.now();r.debug("scheduling upload queue start in "+n),f=u(U,n)}}function L(e){r.debug("queuing upload",e.toString()),h.push(e),I(),U()}function M(){for(let e of h)e.minStartTime=0}function N(e,t){if(r.debug("online state changed to ",t),t)r.debug("bg-upload: resuming..."),M(),U();else{for(var n=p.concat([]);n.length;){var o=n.pop();o.pause()&&(O(o),L(i.unserialize(o.serialize())))}M(),I()}}function B(){v.cancelAllUploads()}return v.cancelAllUploads=function(e){var t=h.filter((function(t){return!e||t.config.isSyncUpload})),n=t.length;t.forEach((function(e){r.debug("bgUpload: cancelling queued sync upload",e.toString()),C(e)})),p=p.filter((function(t){return!((!e||t.config.isSyncUpload)&&(r.debug("bgUpload: cancelling active sync upload",t.toString()),t.cancel())&&(O(t,!1),++n,1))})),n&&(r.debug("bgUpload: cancelled %s sync uploads",n),I())},v.upload=function(e){if(F(e))return r.debug("discarding new sync upload while out of space",e),void A(e,{reason:"quotaExceeded"});var t=e.fileId,n=$(e);if(n)return r.info("upload already pending "+t),void(n.config.isSyncUpload&&!e.isSyncUpload&&(r.info("marking upload as non-sync "+t),n.config.isSyncUpload=!1,I(),U()));j(e.fileId,e.target),L(i.create(e))},v.setDrivePrivacy=function(e){const t=$({...e,target:"drive"});t&&t.setDrivePrivacy(e.privacy)},v.cancel=function(e){if(!e.fileId||!e.target)throw new Error;var t=k(e);t?C(t):(t=D(e))&&t.cancel()&&O(t),t?(r.debug("cancelled upload",t.toString()),I()):r.debug("no queued or active upload found to cancel",e)},v.getTargetFileState=function(e,t){function n(n){return n.config.fileId===e&&n.config.target===t}var r=p.find(n);if(r)return{state:"uploading",config:r.config,progress:r.progress};var o=h.find(n);return o?{state:"queued",config:o.config}:null},v.isOnline=function(){return c.isOnline()},v.clearOutOfSpaceErrors=function(){g=g.filter(e=>!(e.config.isSyncUpload&&e.error&&"quotaExceeded"===e.error.reason)),I()},v.hasRecentlyRanOutOfDriveSpace=function(){return g.some(e=>e.config.isSyncUpload&&e.error&&"quotaExceeded"===e.error.reason)},v.getWatcherStateId=function(){return b},v.install=function(){return d=o.$new(!0),t.local.getSingle("uploadsPending").then((function(e){e&&(g=e.recentErrors||[],h=(e.queued||[]).filter(e=>"firebase"!==e[0]).map((function(e){return i.unserialize(e)})))})).then((function(){U(),n.onConnect.addListener(y),n.onSuspend.addListener(w),d.$on("onlineState:changed",N),o.$on("event:signInChanged",B)}))},v.uninstall=function(){n.onConnect.removeListener(y),n.onSuspend.removeListener(w),d.$destroy()},v.STORAGE_KEY="uploadsPending",v}])},xOqQ:function(e,t){angular.module("castifyExt.userNotifications",["castifyExt.simpleBgServiceConsumer","castifyExt.chromeEventPublisher"]).factory("userNotifications",["simpleBgServiceConsumer",function(e){return e("userNotifications",["loadOrFetch","seen","clicked"])}])},zn8P:function(e,t){function n(e){return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}))}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id="zn8P"}},[[0,0,3]]]);